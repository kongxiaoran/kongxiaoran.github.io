<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Spark技术详解：核心原理、架构与高级实践 | 凌霄的博客</title><meta name="keywords" content="Spark,分布式处理,内存计算"><meta name="author" content="XR"><meta name="copyright" content="XR"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Spark技术详解：核心原理、架构与高级实践"><meta name="application-name" content="Spark技术详解：核心原理、架构与高级实践"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Spark技术详解：核心原理、架构与高级实践"><meta property="og:url" content="http://example.com/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/index.html"><meta property="og:site_name" content="凌霄的博客"><meta property="og:description" content="Spark技术详解：核心原理、架构与高级实践一、引言：Spark的定位与价值Apache Spark是一个统一的分布式计算引擎，旨在提供高效、易用的大数据处理能力。与Hadoop MapReduce相比，Spark通过内存计算和DAG执行引擎实现了10-100倍的性能提升，同时支持批处理、流处理、交"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="XR"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="Spark技术详解：核心原理、架构与高级实践一、引言：Spark的定位与价值Apache Spark是一个统一的分布式计算引擎，旨在提供高效、易用的大数据处理能力。与Hadoop MapReduce相比，Spark通过内存计算和DAG执行引擎实现了10-100倍的性能提升，同时支持批处理、流处理、交"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: XR","link":"链接: ","source":"来源: 凌霄的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '凌霄的博客',
  title: 'Spark技术详解：核心原理、架构与高级实践',
  postAI: '',
  pageFillDescription: 'Spark技术详解：核心原理、架构与高级实践, 一、引言：Spark的定位与价值, 1.1 Spark与Hadoop的关系, 1.2 Spark核心优势, 二、Spark核心架构, 2.1 集群架构, 核心组件说明, 2.2 应用执行流程, 2.3 核心配置参数, 三、Spark编程模型, 3.1 RDD：弹性分布式数据集, RDD核心特性, RDD操作类型, RDD依赖关系, 3.2 DataFrame与Dataset, DataFrame, Dataset, 三者对比, 四、Spark执行原理, 4.1 DAG调度器（DAG Scheduler）, 4.2 Task调度器（Task Scheduler）, 数据本地性级别, 4.3 任务执行流程, 4.4 Shuffle机制, Shuffle过程, Shuffle优化, 五、Spark SQL与优化器, 5.1 Catalyst优化器, 优化阶段, 5.2 Tungsten执行引擎, 5.3 自适应查询执行（AQE）, 六、Spark Streaming与实时处理, 6.1 两种流处理模型, DStream（Spark Streaming）, Structured Streaming, 6.2 Structured Streaming核心概念, 6.3 处理语义保证, 七、Spark内存管理, 7.1 内存区域划分, 7.2 内存动态调整, 7.3 内存优化策略, 八、Spark性能调优, 8.1 数据倾斜处理, 检测数据倾斜, 解决策略, 8.2 序列化优化, 8.3 JVM调优, 8.4 其他优化技巧, 九、Spark集群部署与管理, 9.1 部署模式, Standalone模式, YARN模式, Kubernetes模式, 9.2 集群配置最佳实践, 9.3 监控与调试, 十、Spark生态系统, 10.1 核心组件, 10.2 生态扩展, 十一、实际应用场景与最佳实践, 11.1 典型应用场景, 11.2 最佳实践案例, 案例1：大数据ETL优化, 案例2：实时推荐系统, 案例3：机器学习模型训练, 十二、总结与展望, 12.1 Spark发展趋势, 12.2 结语技术详解核心原理架构与高级实践一引言的定位与价值是一个统一的分布式计算引擎旨在提供高效易用的大数据处理能力与相比通过内存计算和执行引擎实现了倍的性能提升同时支持批处理流处理交互式查询和机器学习等多种计算范式与的关系并非的替代品而是对生态的补充和增强存储层可直接访问等存储系统资源管理可运行在或自身的集群管理器上计算模型提供更丰富的和更高效的执行引擎核心优势内存计算中间结果存储在内存中避免磁盘开销惰性计算仅在需要结果时才执行计算优化执行计划引擎基于有向无环图的执行计划减少操作统一平台单一引擎支持批处理流处理机器学习和图计算多语言支持提供和二核心架构集群架构采用主从架构主要由以下组件构成客户端提交应用应用主控节点申请资源集群管理器分配资源工作节点分配资源工作节点分配资源工作节点发送任务发送任务发送任务存储数据内存磁盘缓存存储数据内存磁盘缓存存储数据内存磁盘缓存数据数据核心组件说明负责应用程序的整体控制流维护应用的元数据和执行状态生成并优化执行计划调度任务到执行在工作节点上运行的进程执行分配的任务存储计算过程中的数据内存或磁盘通过管理数据缓存负责集群资源管理和分配支持多种模式不参与具体计算仅提供资源隔离和调度应用执行流程提交应用客户端通过提交应用初始化集群管理器启动进程资源申请向集群管理器申请资源启动集群管理器在工作节点上启动任务调度将应用分解为任务并分配给执行任务执行任务并缓存中间结果结果返回任务完成后结果返回给或写入外部存储应用结束所有任务完成释放资源核心配置参数参数类别关键参数说明默认值资源配置内存大小每个内存大小每个的核心数实例数执行优化默认并行度所有核心总数分区数用于执行和存储的内存比例容错配置任务最大失败次数最大连续尝试次数三编程模型弹性分布式数据集是的核心抽象表示一个不可变可分区支持并行操作的分布式数据集核心特性不可变性一旦创建无法修改只能通过转换操作生成新分区机制数据分布在多个分区中每个分区可在不同节点上处理依赖关系记录之间的依赖关系支持容错恢复惰性计算转换操作惰性执行行动操作触发计算持久化支持将缓存到内存或磁盘加速重复访问分区器控制键值对的分区方式优化数据本地性操作类型操作类型特点示例转换操作惰性执行返回新行动操作立即执行返回结果或写入外部系统持久化操作缓存到内存磁盘依赖关系之间存在两种依赖关系直接影响故障恢复和执行优化窄依赖子的每个分区依赖父的少数分区无需可在单个节点完成计算示例宽依赖子的每个分区依赖父的多个分区需要涉及跨节点数据传输示例窄依赖宽依赖与引入引入提供了比更高层次的抽象和优化分布式的命名列数据集合类似关系型数据库表提供结构化支持查询内部使用优化器生成高效执行计划比节省内存因为采用列式存储和编码结合的结构化优势和的类型安全特性在编译时进行类型检查减少运行时错误支持表达式和关系型操作针对语言提供类型安全通过动态包装实现三者对比特性数据表示无类型对象集合命名列的分布式数据集强类型的对象集合类型安全是编译时否是编译时优化支持有限完全支持优化完全支持优化风格函数式函数式函数式面向对象序列化序列化二进制格式二进制格式内存效率低高高适用场景复杂数据处理非结构化数据结构化数据查询结构化数据需要类型安全四执行原理调度器使用调度器将作业分解为并基于依赖关系构建执行计划作业提交操作触发作业提交构建根据依赖关系构建图划分以宽依赖为边界划分每个包含多个任务集生成为每个创建任务调度将提交给调度器窄依赖窄依赖宽依赖窄依赖宽依赖调度器调度器负责将分配到执行并考虑数据本地性数据本地性级别数据在同一进程中最佳性能数据在同一节点上不同进程数据在同一机架的不同节点上数据在任意位置调度器优先选择高级别本地性若无法满足则降级并可配置等待超时时间任务执行流程任务序列化序列化并发送到任务反序列化反序列化数据本地化尝试获取本地数据否则远程拉取任务执行执行计算逻辑结果返回将结果返回给或写入外部存储状态更新向汇报任务状态机制是宽依赖中数据重新分区的过程是性能的关键瓶颈过程阶段任务处理数据并生成中间结果按分区器对中间结果进行分区和排序将中间结果写入本地磁盘阶段任务从节点拉取属于自己的分区数据合并排序拉取的数据执行聚合操作优化合并输出文件减少磁盘使用堆外内存避免问题优化排序引擎的堆外排序管理器默认替代五与优化器优化器是的核心优化器基于规则和成本的优化框架未解析的逻辑计划解析后的逻辑计划优化后的逻辑计划物理计划选择最佳计划执行优化阶段逻辑优化谓词下推列裁剪常量折叠连接重排序物理优化选择最佳连接策略等确定分区方式和并行度代码生成执行引擎是的内存管理和执行优化引擎主要优化内存管理使用自定义内存管理器减少对象开销二进制处理使用二进制格式存储数据避免对象头和引用开销代码生成使用将多个算子合并为单个函数消除虚函数调用和中间对象向量化执行批量处理数据利用缓存和指令自适应查询执行引入的自适应查询执行在运行时动态优化执行计划动态合并分区合并小数据分区减少任务数量动态调整连接策略根据运行时数据大小选择最佳连接方式动态优化倾斜连接检测并处理数据倾斜六与实时处理两种流处理模型基于微批处理的流处理模型将流数据分割为小批量数据进行处理延迟通常在秒级与类似易于使用基于的流处理模型提供流即表的抽象处理无限数据流支持事件时间和水印支持语义延迟可低至毫秒级模式核心概念输入表无限增长的输入数据结果表查询结果不断更新的表输出模式仅输出新添加到结果表的行仅输出结果表中更新的行输出结果表的所有行水印处理迟到数据的机制定义数据的最大延迟时间处理语义保证每条数据至少处理一次可能重复每条数据精确处理一次不重复不丢失实现依赖于检查点和事务性输出七内存管理内存区域划分使用统一内存管理模型将内存划分为以下区域堆内存保留内存固定保留可用内存存储内存默认占可用内存执行内存默认占可用内存其他内存堆外内存通过配置存储内存用于缓存和广播变量执行内存用于等计算堆外内存绕过直接管理的内存避免开销内存动态调整存储内存和执行内存之间可以动态调整当一方内存不足时可以借用另一方的空闲内存执行内存优先存储内存被借用后可被驱逐可通过调整基础比例内存优化策略使用堆外内存减少压力序列化缓存调整内存比例根据应用类型调整存储和执行内存比例控制缓存大小避免缓存过多数据导致使用序列化比序列化更紧凑高效八性能调优数据倾斜处理数据倾斜是作业性能的常见瓶颈表现为少数任务执行时间过长检测数据倾斜的页面查看任务执行时间分布查看分布日志中的长尾任务警告解决策略预处理数据过滤异常值拆分热点调整并行度增加分区数设置合理的默认并行度使用特殊算子替代自定义聚合逻辑替代加盐对热点添加随机前缀两次聚合局部聚合全局聚合广播连接小表广播到所有节点避免控制自动广播阈值序列化优化使用序列化优化对象结构避免使用复杂嵌套对象控制序列化缓冲区大小调优设置合理的内存大小避免过大堆内存导致延迟调整新生代大小通常为堆内存的到选择合适的算法适合大内存场景监控情况其他优化技巧避免使用将分布式数据拉取到本地使用替代减少创建对象开销合理使用持久化避免重复计算使用和优化分区避免全广播大变量减少数据传输九集群部署与管理部署模式支持多种部署模式适应不同的集群环境模式自带的集群管理器简单易用无需依赖其他组件支持自动故障转移模式集成资源管理器共享集群资源与共存支持两种模式在客户端运行在集群中运行模式容器化部署适合云环境动态扩缩容资源利用率高支持应用的容器化打包集群配置最佳实践内存分配避免设置过大内存建议不超过减少压力为操作系统和缓存预留内存核心配置每个核心数建议个考虑超线程物理核心数的倍网络配置使用高性能网络减少开销配置合理的网络缓冲区大小存储配置使用存储数据多个磁盘分散压力监控与调试提供应用执行的详细指标默认地址历史服务器日志管理配置日志聚合模式下使用栈集中管理日志性能分析工具性能分析工具可视化使用情况日志分析十生态系统生态系统包含多个组件提供端到端的大数据解决方案核心引擎结构化查询流处理机器学习图计算数据湖结构化流处理机器学习生命周期管理核心组件处理结构化数据支持和微批处理流数据基于的流处理支持事件时间机器学习库提供常用算法和工具图计算库支持图算法和图操作生态扩展构建在之上的数据湖解决方案支持事务与集成的流数据平台增量处理框架支持数据更新和删除开放表格式支持大型分析数据集机器学习生命周期管理工具十一实际应用场景与最佳实践典型应用场景批处理数据清洗转换和加载实时数据处理日志分析实时监控交互式数据分析查询数据探索机器学习模型训练预测和评估图计算社交网络分析路径查找最佳实践案例案例大数据优化某电商平台使用进行每日用户行为数据问题原始数据量大级包含大量小文件优化措施使用合并小文件采用压缩存储中间结果缓存频繁访问的维度表使用广播连接优化维度关联效果作业执行时间从小时减少到小时案例实时推荐系统某视频平台使用构建实时推荐系统架构关键技术事件时间窗口计算用户兴趣水印处理迟到数据状态管理保存用户偏好微批处理间隔设为秒效果推荐延迟从分钟级降至秒级用户点击率提升案例机器学习模型训练某金融公司使用构建信用评分模型数据规模千万级用户数据数百个特征优化措施使用进行特征工程采用交叉验证选择最佳参数使用管道整合特征处理和模型训练模型并行训练加速收敛效果模型训练时间减少预测准确率提升十二总结与展望作为新一代分布式计算引擎通过内存计算执行和丰富的极大提升了大数据处理效率其统一的编程模型和丰富的生态系统使其成为大数据处理的首选平台发展趋势性能持续优化进一步提升执行效率和资源利用率云原生支持更好地适应云环境支持架构流批一体统一批处理和流处理模型集成更紧密地与机器学习和深度学习集成易用性提升简化降低使用门槛结语的设计理念体现了分布式计算的核心思想通过抽象简化复杂性通过优化提升性能通过统一整合多样性深入理解的内部原理和优化技术对于构建高效可靠的大数据系统至关重要随着大数据技术的不断发展将继续在数据处理领域发挥核心作用推动数据驱动决策的广泛应用',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-24 23:57:12',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">凌霄的博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 1.05rem;">Argon2<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 1.05rem;">DNS<sup>2</sup></a><a href="/tags/DSP/" style="font-size: 1.05rem;">DSP<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 1.05rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 1.05rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 1.05rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>6</sup></a><a href="/tags/Kubernetes/" style="font-size: 1.05rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 1.05rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 1.05rem;">NAT<sup>1</sup></a><a href="/tags/RTB/" style="font-size: 1.05rem;">RTB<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 1.05rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 1.05rem;">SGX<sup>2</sup></a><a href="/tags/Spark/" style="font-size: 1.05rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 1.05rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 1.05rem;">TEE<sup>2</sup></a><a href="/tags/TME/" style="font-size: 1.05rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 1.05rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 1.05rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 1.05rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>2</sup></a><a href="/tags/%E5%B9%BF%E5%91%8A%E6%8A%95%E6%94%BE/" style="font-size: 1.05rem;">广告投放<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">隐私计算<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">31</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url">大数据</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Spark/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Spark</span></a><a class="article-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>分布式处理</span></a><a class="article-meta__tags" href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>内存计算</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Spark技术详解：核心原理、架构与高级实践</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-11-16T02:00:00.000Z" title="发表于 2023-11-16 10:00:00">2023-11-16</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-24T15:57:12.140Z" title="更新于 2025-06-24 23:57:12">2025-06-24</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Spark技术详解：核心原理、架构与高级实践"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为杭州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/"><header><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url">大数据</a><a href="/tags/Spark/" tabindex="-1" itemprop="url">Spark</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" tabindex="-1" itemprop="url">分布式处理</a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" tabindex="-1" itemprop="url">内存计算</a><h1 id="CrawlerTitle" itemprop="name headline">Spark技术详解：核心原理、架构与高级实践</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">XR</span><time itemprop="dateCreated datePublished" datetime="2023-11-16T02:00:00.000Z" title="发表于 2023-11-16 10:00:00">2023-11-16</time><time itemprop="dateCreated datePublished" datetime="2025-06-24T15:57:12.140Z" title="更新于 2025-06-24 23:57:12">2025-06-24</time></header><h1 id="Spark技术详解：核心原理、架构与高级实践"><a href="#Spark技术详解：核心原理、架构与高级实践" class="headerlink" title="Spark技术详解：核心原理、架构与高级实践"></a>Spark技术详解：核心原理、架构与高级实践</h1><h2 id="一、引言：Spark的定位与价值"><a href="#一、引言：Spark的定位与价值" class="headerlink" title="一、引言：Spark的定位与价值"></a>一、引言：Spark的定位与价值</h2><p>Apache Spark是一个统一的分布式计算引擎，旨在提供高效、易用的大数据处理能力。与Hadoop MapReduce相比，Spark通过内存计算和DAG执行引擎实现了10-100倍的性能提升，同时支持批处理、流处理、交互式查询和机器学习等多种计算范式。</p>
<h3 id="1-1-Spark与Hadoop的关系"><a href="#1-1-Spark与Hadoop的关系" class="headerlink" title="1.1 Spark与Hadoop的关系"></a>1.1 Spark与Hadoop的关系</h3><p>Spark并非Hadoop的替代品，而是对Hadoop生态的补充和增强：</p>
<ul>
<li>存储层：Spark可直接访问HDFS、HBase等Hadoop存储系统</li>
<li>资源管理：Spark可运行在YARN、Mesos或自身的Standalone集群管理器上</li>
<li>计算模型：Spark提供更丰富的API和更高效的执行引擎</li>
</ul>
<h3 id="1-2-Spark核心优势"><a href="#1-2-Spark核心优势" class="headerlink" title="1.2 Spark核心优势"></a>1.2 Spark核心优势</h3><ul>
<li><strong>内存计算</strong>：中间结果存储在内存中，避免磁盘IO开销</li>
<li><strong>惰性计算</strong>：仅在需要结果时才执行计算，优化执行计划</li>
<li><strong>DAG引擎</strong>：基于有向无环图的执行计划，减少Shuffle操作</li>
<li><strong>统一平台</strong>：单一引擎支持批处理、流处理、SQL、机器学习和图计算</li>
<li><strong>多语言支持</strong>：提供Scala、Java、Python、R和SQL API</li>
</ul>
<h2 id="二、Spark核心架构"><a href="#二、Spark核心架构" class="headerlink" title="二、Spark核心架构"></a>二、Spark核心架构</h2><h3 id="2-1-集群架构"><a href="#2-1-集群架构" class="headerlink" title="2.1 集群架构"></a>2.1 集群架构</h3><p>Spark采用主从架构，主要由以下组件构成：</p>
<pre class="mermaid">%%{init: {"securityLevel": "loose"}}%%
graph TD
    Client[客户端] -->|提交应用| Driver[Driver<br/>(应用主控节点)]
    Driver -->|申请资源| ClusterManager[集群管理器<br/>(YARN/Mesos/Standalone)]
    ClusterManager -->|分配资源| Executor1[Executor<br/>(工作节点1)]
    ClusterManager -->|分配资源| Executor2[Executor<br/>(工作节点2)]
    ClusterManager -->|分配资源| Executor3[Executor<br/>(工作节点3)]
    Driver -->|发送任务| Executor1
    Driver -->|发送任务| Executor2
    Driver -->|发送任务| Executor3
    Executor1 -->|存储数据| Cache1[内存/磁盘缓存]
    Executor2 -->|存储数据| Cache2[内存/磁盘缓存]
    Executor3 -->|存储数据| Cache3[内存/磁盘缓存]
    Executor1 <-->|数据 shuffle| Executor2
    Executor2 <-->|数据 shuffle| Executor3</pre>

<h4 id="核心组件说明"><a href="#核心组件说明" class="headerlink" title="核心组件说明"></a>核心组件说明</h4><ul>
<li><p><strong>Driver</strong>：</p>
<ul>
<li>负责应用程序的整体控制流</li>
<li>维护Spark应用的元数据和执行状态</li>
<li>生成并优化执行计划</li>
<li>调度任务到Executor执行</li>
</ul>
</li>
<li><p><strong>Executor</strong>：</p>
<ul>
<li>在工作节点上运行的进程</li>
<li>执行Driver分配的任务（Task）</li>
<li>存储计算过程中的数据（内存或磁盘）</li>
<li>通过BlockManager管理数据缓存</li>
</ul>
</li>
<li><p><strong>Cluster Manager</strong>：</p>
<ul>
<li>负责集群资源管理和分配</li>
<li>支持多种模式：YARN、Mesos、Standalone、Kubernetes</li>
<li>不参与具体计算，仅提供资源隔离和调度</li>
</ul>
</li>
</ul>
<h3 id="2-2-应用执行流程"><a href="#2-2-应用执行流程" class="headerlink" title="2.2 应用执行流程"></a>2.2 应用执行流程</h3><ol>
<li><strong>提交应用</strong>：客户端通过<code>spark-submit</code>提交应用</li>
<li><strong>初始化Driver</strong>：集群管理器启动Driver进程</li>
<li><strong>资源申请</strong>：Driver向集群管理器申请资源</li>
<li><strong>启动Executor</strong>：集群管理器在工作节点上启动Executor</li>
<li><strong>任务调度</strong>：Driver将应用分解为任务并分配给Executor</li>
<li><strong>执行任务</strong>：Executor执行任务并缓存中间结果</li>
<li><strong>结果返回</strong>：任务完成后，结果返回给Driver或写入外部存储</li>
<li><strong>应用结束</strong>：所有任务完成，释放资源</li>
</ol>
<h3 id="2-3-核心配置参数"><a href="#2-3-核心配置参数" class="headerlink" title="2.3 核心配置参数"></a>2.3 核心配置参数</h3><table>
<thead>
<tr>
<th>参数类别</th>
<th>关键参数</th>
<th>说明</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>资源配置</td>
<td><code>spark.driver.memory</code></td>
<td>Driver内存大小</td>
<td>1g</td>
</tr>
<tr>
<td></td>
<td><code>spark.executor.memory</code></td>
<td>每个Executor内存大小</td>
<td>1g</td>
</tr>
<tr>
<td></td>
<td><code>spark.executor.cores</code></td>
<td>每个Executor的CPU核心数</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td><code>spark.executor.instances</code></td>
<td>Executor实例数</td>
<td>2</td>
</tr>
<tr>
<td>执行优化</td>
<td><code>spark.default.parallelism</code></td>
<td>默认并行度</td>
<td>所有Executor核心总数</td>
</tr>
<tr>
<td></td>
<td><code>spark.sql.shuffle.partitions</code></td>
<td>SQL shuffle分区数</td>
<td>200</td>
</tr>
<tr>
<td></td>
<td><code>spark.memory.fraction</code></td>
<td>用于执行和存储的内存比例</td>
<td>0.6</td>
</tr>
<tr>
<td>容错配置</td>
<td><code>spark.task.maxFailures</code></td>
<td>任务最大失败次数</td>
<td>4</td>
</tr>
<tr>
<td></td>
<td><code>spark.stage.maxConsecutiveAttempts</code></td>
<td>Stage最大连续尝试次数</td>
<td>4</td>
</tr>
</tbody></table>
<h2 id="三、Spark编程模型"><a href="#三、Spark编程模型" class="headerlink" title="三、Spark编程模型"></a>三、Spark编程模型</h2><h3 id="3-1-RDD：弹性分布式数据集"><a href="#3-1-RDD：弹性分布式数据集" class="headerlink" title="3.1 RDD：弹性分布式数据集"></a>3.1 RDD：弹性分布式数据集</h3><p>RDD（Resilient Distributed Dataset）是Spark的核心抽象，表示一个不可变、可分区、支持并行操作的分布式数据集。</p>
<h4 id="RDD核心特性"><a href="#RDD核心特性" class="headerlink" title="RDD核心特性"></a>RDD核心特性</h4><ul>
<li><strong>不可变性</strong>：一旦创建无法修改，只能通过转换操作生成新RDD</li>
<li><strong>分区机制</strong>：数据分布在多个分区中，每个分区可在不同节点上处理</li>
<li><strong>依赖关系</strong>：记录RDD之间的依赖关系，支持容错恢复</li>
<li><strong>惰性计算</strong>：转换操作（Transformation）惰性执行，行动操作（Action）触发计算</li>
<li><strong>持久化</strong>：支持将RDD缓存到内存或磁盘，加速重复访问</li>
<li><strong>分区器</strong>：控制键值对RDD的分区方式，优化数据本地性</li>
</ul>
<h4 id="RDD操作类型"><a href="#RDD操作类型" class="headerlink" title="RDD操作类型"></a>RDD操作类型</h4><table>
<thead>
<tr>
<th>操作类型</th>
<th>特点</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>转换操作<br>（Transformation）</td>
<td>惰性执行，返回新RDD</td>
<td><code>map()</code>, <code>filter()</code>, <code>groupByKey()</code>, <code>join()</code></td>
</tr>
<tr>
<td>行动操作<br>（Action）</td>
<td>立即执行，返回结果或写入外部系统</td>
<td><code>collect()</code>, <code>count()</code>, <code>take()</code>, <code>saveAsTextFile()</code></td>
</tr>
<tr>
<td>持久化操作<br>（Persistence）</td>
<td>缓存RDD到内存&#x2F;磁盘</td>
<td><code>cache()</code>, <code>persist()</code>, <code>unpersist()</code></td>
</tr>
</tbody></table>
<h4 id="RDD依赖关系"><a href="#RDD依赖关系" class="headerlink" title="RDD依赖关系"></a>RDD依赖关系</h4><p>RDD之间存在两种依赖关系，直接影响故障恢复和执行优化：</p>
<ul>
<li><p><strong>窄依赖（Narrow Dependency）</strong>：</p>
<ul>
<li>子RDD的每个分区依赖父RDD的少数分区</li>
<li>无需Shuffle，可在单个节点完成计算</li>
<li>示例：<code>map()</code>, <code>filter()</code>, <code>union()</code></li>
</ul>
</li>
<li><p><strong>宽依赖（Wide Dependency）</strong>：</p>
<ul>
<li>子RDD的每个分区依赖父RDD的多个分区</li>
<li>需要Shuffle，涉及跨节点数据传输</li>
<li>示例：<code>groupByKey()</code>, <code>reduceByKey()</code>, <code>join()</code></li>
</ul>
</li>
</ul>
<pre class="mermaid">%%{init: {"securityLevel": "loose"}}%%
graph TD
    subgraph 窄依赖
        A[Parent RDD<br/>Partition 1] --> B[Child RDD<br/>Partition 1]
        C[Parent RDD<br/>Partition 2] --> D[Child RDD<br/>Partition 2]
    end
    subgraph 宽依赖
        E[Parent RDD<br/>Partition 1] --> G[Child RDD<br/>Partition 1]
        E --> H[Child RDD<br/>Partition 2]
        F[Parent RDD<br/>Partition 2] --> G
        F --> H
    end</pre>

<h3 id="3-2-DataFrame与Dataset"><a href="#3-2-DataFrame与Dataset" class="headerlink" title="3.2 DataFrame与Dataset"></a>3.2 DataFrame与Dataset</h3><p>Spark 1.3引入DataFrame，1.6引入Dataset，提供了比RDD更高层次的抽象和优化：</p>
<h4 id="DataFrame"><a href="#DataFrame" class="headerlink" title="DataFrame"></a>DataFrame</h4><ul>
<li>分布式的命名列数据集合，类似关系型数据库表</li>
<li>提供结构化API，支持SQL查询</li>
<li>内部使用Catalyst优化器生成高效执行计划</li>
<li>比RDD节省内存，因为采用列式存储和编码</li>
</ul>
<h4 id="Dataset"><a href="#Dataset" class="headerlink" title="Dataset"></a>Dataset</h4><ul>
<li>结合DataFrame的结构化优势和RDD的类型安全特性</li>
<li>在编译时进行类型检查，减少运行时错误</li>
<li>支持lambda表达式和关系型操作</li>
<li>针对JVM语言（Scala&#x2F;Java）提供类型安全，Python&#x2F;R通过动态包装实现</li>
</ul>
<h4 id="三者对比"><a href="#三者对比" class="headerlink" title="三者对比"></a>三者对比</h4><table>
<thead>
<tr>
<th>特性</th>
<th>RDD</th>
<th>DataFrame</th>
<th>Dataset</th>
</tr>
</thead>
<tbody><tr>
<td>数据表示</td>
<td>无类型对象集合</td>
<td>命名列的分布式数据集</td>
<td>强类型的对象集合</td>
</tr>
<tr>
<td>类型安全</td>
<td>是（编译时）</td>
<td>否</td>
<td>是（编译时）</td>
</tr>
<tr>
<td>优化支持</td>
<td>有限</td>
<td>完全支持Catalyst优化</td>
<td>完全支持Catalyst优化</td>
</tr>
<tr>
<td>API风格</td>
<td>函数式</td>
<td>SQL&#x2F;函数式</td>
<td>SQL&#x2F;函数式&#x2F;面向对象</td>
</tr>
<tr>
<td>序列化</td>
<td>Java序列化&#x2F;Kryo</td>
<td>Tungsten二进制格式</td>
<td>Tungsten二进制格式</td>
</tr>
<tr>
<td>内存效率</td>
<td>低</td>
<td>高</td>
<td>高</td>
</tr>
<tr>
<td>适用场景</td>
<td>复杂数据处理，非结构化数据</td>
<td>结构化数据，SQL查询</td>
<td>结构化数据，需要类型安全</td>
</tr>
</tbody></table>
<h2 id="四、Spark执行原理"><a href="#四、Spark执行原理" class="headerlink" title="四、Spark执行原理"></a>四、Spark执行原理</h2><h3 id="4-1-DAG调度器（DAG-Scheduler）"><a href="#4-1-DAG调度器（DAG-Scheduler）" class="headerlink" title="4.1 DAG调度器（DAG Scheduler）"></a>4.1 DAG调度器（DAG Scheduler）</h3><p>Spark使用DAG调度器将作业分解为Stage，并基于RDD依赖关系构建执行计划：</p>
<ol>
<li><strong>作业提交</strong>：Action操作触发作业提交</li>
<li><strong>DAG构建</strong>：根据RDD依赖关系构建DAG图</li>
<li><strong>Stage划分</strong>：以宽依赖为边界划分Stage，每个Stage包含多个Task</li>
<li><strong>任务集生成</strong>：为每个Stage创建TaskSet</li>
<li><strong>任务调度</strong>：将TaskSet提交给Task调度器</li>
</ol>
<pre class="mermaid">%%{init: {"securityLevel": "loose"}}%%
graph TD
    A[RDD 1] -->|map| B[RDD 2<br/>窄依赖]
    B -->|filter| C[RDD 3<br/>窄依赖]
    C -->|groupByKey| D[RDD 4<br/>宽依赖]
    D -->|mapValues| E[RDD 5<br/>窄依赖]
    E -->|reduceByKey| F[RDD 6<br/>宽依赖]
    subgraph Stage 1
        A
        B
        C
    end
    subgraph Stage 2
        D
        E
    end
    subgraph Stage 3
        F
    end</pre>

<h3 id="4-2-Task调度器（Task-Scheduler）"><a href="#4-2-Task调度器（Task-Scheduler）" class="headerlink" title="4.2 Task调度器（Task Scheduler）"></a>4.2 Task调度器（Task Scheduler）</h3><p>Task调度器负责将Task分配到Executor执行，并考虑数据本地性：</p>
<h4 id="数据本地性级别"><a href="#数据本地性级别" class="headerlink" title="数据本地性级别"></a>数据本地性级别</h4><ol>
<li><strong>PROCESS_LOCAL</strong>：数据在同一JVM进程中，最佳性能</li>
<li><strong>NODE_LOCAL</strong>：数据在同一节点上（不同进程）</li>
<li><strong>RACK_LOCAL</strong>：数据在同一机架的不同节点上</li>
<li><strong>ANY</strong>：数据在任意位置</li>
</ol>
<p>调度器优先选择高级别本地性，若无法满足则降级，并可配置等待超时时间（<code>spark.locality.wait</code>）。</p>
<h3 id="4-3-任务执行流程"><a href="#4-3-任务执行流程" class="headerlink" title="4.3 任务执行流程"></a>4.3 任务执行流程</h3><ol>
<li><strong>任务序列化</strong>：Driver序列化Task并发送到Executor</li>
<li><strong>任务反序列化</strong>：Executor反序列化Task</li>
<li><strong>数据本地化</strong>：尝试获取本地数据，否则远程拉取</li>
<li><strong>任务执行</strong>：执行计算逻辑</li>
<li><strong>结果返回</strong>：将结果返回给Driver或写入外部存储</li>
<li><strong>状态更新</strong>：向Driver汇报任务状态</li>
</ol>
<h3 id="4-4-Shuffle机制"><a href="#4-4-Shuffle机制" class="headerlink" title="4.4 Shuffle机制"></a>4.4 Shuffle机制</h3><p>Shuffle是宽依赖中数据重新分区的过程，是Spark性能的关键瓶颈：</p>
<h4 id="Shuffle过程"><a href="#Shuffle过程" class="headerlink" title="Shuffle过程"></a>Shuffle过程</h4><ol>
<li><p><strong>Map阶段</strong>：</p>
<ul>
<li>任务处理数据并生成中间结果</li>
<li>按分区器对中间结果进行分区和排序</li>
<li>将中间结果写入本地磁盘（Shuffle Write）</li>
</ul>
</li>
<li><p><strong>Reduce阶段</strong>：</p>
<ul>
<li>任务从Map节点拉取属于自己的分区数据（Shuffle Read）</li>
<li>合并排序拉取的数据</li>
<li>执行聚合操作</li>
</ul>
</li>
</ol>
<h4 id="Shuffle优化"><a href="#Shuffle优化" class="headerlink" title="Shuffle优化"></a>Shuffle优化</h4><ul>
<li><strong>合并输出文件</strong>：<code>spark.shuffle.consolidateFiles</code>，减少磁盘IO</li>
<li><strong>使用堆外内存</strong>：<code>spark.shuffle.memoryFraction</code>，避免GC问题</li>
<li><strong>优化排序</strong>：Tungsten引擎的堆外排序</li>
<li><strong>Shuffle管理器</strong>：Spark 2.x默认SortShuffleManager，替代HashShuffleManager</li>
</ul>
<h2 id="五、Spark-SQL与优化器"><a href="#五、Spark-SQL与优化器" class="headerlink" title="五、Spark SQL与优化器"></a>五、Spark SQL与优化器</h2><h3 id="5-1-Catalyst优化器"><a href="#5-1-Catalyst优化器" class="headerlink" title="5.1 Catalyst优化器"></a>5.1 Catalyst优化器</h3><p>Catalyst是Spark SQL的核心优化器，基于规则和成本的优化框架：</p>
<pre class="mermaid">%%{init: {"securityLevel": "loose"}}%%
graph LR
    A[SQL/DataSet API] --> B[未解析的逻辑计划<br/>(Unresolved Logical Plan)]
    B --> C[解析后的逻辑计划<br/>(Analyzed Logical Plan)]
    C --> D[优化后的逻辑计划<br/>(Optimized Logical Plan)]
    D --> E[物理计划<br/>(Physical Plans)]
    E --> F[选择最佳计划<br/>(Best Physical Plan)]
    F --> G[执行<br/>(Execution)]</pre>

<h4 id="优化阶段"><a href="#优化阶段" class="headerlink" title="优化阶段"></a>优化阶段</h4><ol>
<li><p><strong>逻辑优化</strong>：</p>
<ul>
<li>谓词下推（Predicate Pushdown）</li>
<li>列裁剪（Column Pruning）</li>
<li>常量折叠（Constant Folding）</li>
<li>连接重排序（Join Reordering）</li>
</ul>
</li>
<li><p><strong>物理优化</strong>：</p>
<ul>
<li>选择最佳连接策略（Broadcast Hash Join、Sort Merge Join等）</li>
<li>确定分区方式和并行度</li>
<li>代码生成（Code Generation）</li>
</ul>
</li>
</ol>
<h3 id="5-2-Tungsten执行引擎"><a href="#5-2-Tungsten执行引擎" class="headerlink" title="5.2 Tungsten执行引擎"></a>5.2 Tungsten执行引擎</h3><p>Tungsten是Spark的内存管理和执行优化引擎，主要优化：</p>
<ul>
<li><strong>内存管理</strong>：使用自定义内存管理器，减少JVM对象开销</li>
<li><strong>二进制处理</strong>：使用二进制格式存储数据，避免Java对象头和引用开销</li>
<li><strong>代码生成</strong>：使用Whole-Stage Code Generation将多个算子合并为单个函数，消除虚函数调用和中间对象</li>
<li><strong>向量化执行</strong>：批量处理数据，利用CPU缓存和SIMD指令</li>
</ul>
<h3 id="5-3-自适应查询执行（AQE）"><a href="#5-3-自适应查询执行（AQE）" class="headerlink" title="5.3 自适应查询执行（AQE）"></a>5.3 自适应查询执行（AQE）</h3><p>Spark 3.0引入的自适应查询执行，在运行时动态优化执行计划：</p>
<ul>
<li><strong>动态合并分区</strong>：合并小数据分区，减少任务数量</li>
<li><strong>动态调整连接策略</strong>：根据运行时数据大小选择最佳连接方式</li>
<li><strong>动态优化倾斜连接</strong>：检测并处理数据倾斜</li>
</ul>
<h2 id="六、Spark-Streaming与实时处理"><a href="#六、Spark-Streaming与实时处理" class="headerlink" title="六、Spark Streaming与实时处理"></a>六、Spark Streaming与实时处理</h2><h3 id="6-1-两种流处理模型"><a href="#6-1-两种流处理模型" class="headerlink" title="6.1 两种流处理模型"></a>6.1 两种流处理模型</h3><h4 id="DStream（Spark-Streaming）"><a href="#DStream（Spark-Streaming）" class="headerlink" title="DStream（Spark Streaming）"></a>DStream（Spark Streaming）</h4><ul>
<li>基于微批处理的流处理模型</li>
<li>将流数据分割为小批量数据进行处理</li>
<li>延迟通常在秒级</li>
<li>API与RDD类似，易于使用</li>
</ul>
<h4 id="Structured-Streaming"><a href="#Structured-Streaming" class="headerlink" title="Structured Streaming"></a>Structured Streaming</h4><ul>
<li>基于DataFrame&#x2F;Dataset的流处理模型</li>
<li>提供”流即表”的抽象，处理无限数据流</li>
<li>支持事件时间（Event Time）和水印（Watermark）</li>
<li>支持Exactly-Once语义</li>
<li>延迟可低至毫秒级（Continuous Processing模式）</li>
</ul>
<h3 id="6-2-Structured-Streaming核心概念"><a href="#6-2-Structured-Streaming核心概念" class="headerlink" title="6.2 Structured Streaming核心概念"></a>6.2 Structured Streaming核心概念</h3><ul>
<li><strong>输入表</strong>：无限增长的输入数据</li>
<li><strong>结果表</strong>：查询结果不断更新的表</li>
<li><strong>输出模式</strong>：<ul>
<li>Append：仅输出新添加到结果表的行</li>
<li>Update：仅输出结果表中更新的行</li>
<li>Complete：输出结果表的所有行</li>
</ul>
</li>
<li><strong>水印</strong>：处理迟到数据的机制，定义数据的最大延迟时间</li>
</ul>
<h3 id="6-3-处理语义保证"><a href="#6-3-处理语义保证" class="headerlink" title="6.3 处理语义保证"></a>6.3 处理语义保证</h3><ul>
<li><strong>At-Least-Once</strong>：每条数据至少处理一次，可能重复</li>
<li><strong>Exactly-Once</strong>：每条数据精确处理一次，不重复不丢失<ul>
<li>实现依赖于检查点（Checkpoint）和事务性输出</li>
</ul>
</li>
</ul>
<h2 id="七、Spark内存管理"><a href="#七、Spark内存管理" class="headerlink" title="七、Spark内存管理"></a>七、Spark内存管理</h2><h3 id="7-1-内存区域划分"><a href="#7-1-内存区域划分" class="headerlink" title="7.1 内存区域划分"></a>7.1 内存区域划分</h3><p>Spark使用统一内存管理模型，将Executor内存划分为以下区域：</p>
<pre class="mermaid">%%{init: {"securityLevel": "loose"}}%%
graph TD
    subgraph JVM堆内存
        subgraph 保留内存
            RM[300MB固定保留]
        end
        subgraph 可用内存
            subgraph 存储内存
                SM[Storage Memory<br/>默认占可用内存60%]
            end
            subgraph 执行内存
                EM[Execution Memory<br/>默认占可用内存60%]
            end
            Other[其他内存]
        end
    end
    subgraph 堆外内存
        OOM[Off-Heap Memory<br/>通过spark.memory.offHeap.size配置]
    end</pre>

<ul>
<li><strong>存储内存</strong>：用于缓存RDD和广播变量</li>
<li><strong>执行内存</strong>：用于Shuffle、Join、Aggregation等计算</li>
<li><strong>堆外内存</strong>：绕过JVM直接管理的内存，避免GC开销</li>
</ul>
<h3 id="7-2-内存动态调整"><a href="#7-2-内存动态调整" class="headerlink" title="7.2 内存动态调整"></a>7.2 内存动态调整</h3><p>存储内存和执行内存之间可以动态调整：</p>
<ul>
<li>当一方内存不足时，可以借用另一方的空闲内存</li>
<li>执行内存优先，存储内存被借用后可被驱逐</li>
<li>可通过<code>spark.memory.storageFraction</code>调整基础比例</li>
</ul>
<h3 id="7-3-内存优化策略"><a href="#7-3-内存优化策略" class="headerlink" title="7.3 内存优化策略"></a>7.3 内存优化策略</h3><ul>
<li><strong>使用堆外内存</strong>：减少GC压力</li>
<li><strong>序列化缓存</strong>：<code>rdd.persist(StorageLevel.MEMORY_AND_DISK_SER)</code></li>
<li><strong>调整内存比例</strong>：根据应用类型调整存储和执行内存比例</li>
<li><strong>控制缓存大小</strong>：避免缓存过多数据导致GC</li>
<li><strong>使用Kryo序列化</strong>：比Java序列化更紧凑高效</li>
</ul>
<h2 id="八、Spark性能调优"><a href="#八、Spark性能调优" class="headerlink" title="八、Spark性能调优"></a>八、Spark性能调优</h2><h3 id="8-1-数据倾斜处理"><a href="#8-1-数据倾斜处理" class="headerlink" title="8.1 数据倾斜处理"></a>8.1 数据倾斜处理</h3><p>数据倾斜是Spark作业性能的常见瓶颈，表现为少数任务执行时间过长：</p>
<h4 id="检测数据倾斜"><a href="#检测数据倾斜" class="headerlink" title="检测数据倾斜"></a>检测数据倾斜</h4><ul>
<li>Spark UI的Stage页面查看任务执行时间分布</li>
<li>查看Shuffle Read Size分布</li>
<li>日志中的长尾任务警告</li>
</ul>
<h4 id="解决策略"><a href="#解决策略" class="headerlink" title="解决策略"></a>解决策略</h4><ol>
<li><p><strong>预处理数据</strong>：</p>
<ul>
<li>过滤异常值</li>
<li>拆分热点Key</li>
</ul>
</li>
<li><p><strong>调整并行度</strong>：</p>
<ul>
<li>增加Shuffle分区数：<code>spark.sql.shuffle.partitions</code></li>
<li>设置合理的默认并行度：<code>spark.default.parallelism</code></li>
</ul>
</li>
<li><p><strong>使用特殊算子</strong>：</p>
<ul>
<li><code>reduceByKey</code>替代<code>groupByKey</code></li>
<li><code>aggregateByKey</code>自定义聚合逻辑</li>
<li><code>repartitionAndSortWithinPartitions</code>替代<code>repartition</code>+<code>sort</code></li>
</ul>
</li>
<li><p><strong>加盐（Salting）</strong>：</p>
<ul>
<li>对热点Key添加随机前缀</li>
<li>两次聚合（局部聚合+全局聚合）</li>
</ul>
</li>
<li><p><strong>广播连接（Broadcast Join）</strong>：</p>
<ul>
<li>小表广播到所有节点，避免Shuffle</li>
<li><code>spark.sql.autoBroadcastJoinThreshold</code>控制自动广播阈值</li>
</ul>
</li>
</ol>
<h3 id="8-2-序列化优化"><a href="#8-2-序列化优化" class="headerlink" title="8.2 序列化优化"></a>8.2 序列化优化</h3><ul>
<li><strong>使用Kryo序列化</strong>：<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>()</span><br><span class="line">  .set(<span class="string">&quot;spark.serializer&quot;</span>, <span class="string">&quot;org.apache.spark.serializer.KryoSerializer&quot;</span>)</span><br><span class="line">  .registerKryoClasses(<span class="type">Array</span>(classOf[<span class="type">MyClass</span>]))</span><br></pre></td></tr></table></figure></li>
<li><strong>优化对象结构</strong>：避免使用复杂嵌套对象</li>
<li><strong>控制序列化缓冲区大小</strong>：<code>spark.kryoserializer.buffer.max</code></li>
</ul>
<h3 id="8-3-JVM调优"><a href="#8-3-JVM调优" class="headerlink" title="8.3 JVM调优"></a>8.3 JVM调优</h3><ul>
<li><strong>设置合理的内存大小</strong>：避免过大堆内存导致GC延迟</li>
<li><strong>调整新生代大小</strong>：<code>-Xmn</code>，通常为堆内存的1&#x2F;4到1&#x2F;3</li>
<li><strong>选择合适的GC算法</strong>：G1GC适合大内存场景<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spark.executor.extraJavaOptions -XX:+UseG1GC -XX:MaxGCPauseMillis=200</span><br></pre></td></tr></table></figure></li>
<li><strong>监控GC情况</strong>：<code>-verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps</code></li>
</ul>
<h3 id="8-4-其他优化技巧"><a href="#8-4-其他优化技巧" class="headerlink" title="8.4 其他优化技巧"></a>8.4 其他优化技巧</h3><ul>
<li>**避免使用<code>collect()</code>**：将分布式数据拉取到本地</li>
<li>**使用<code>foreachPartition</code>替代<code>foreach</code>**：减少创建对象开销</li>
<li><strong>合理使用持久化</strong>：避免重复计算</li>
<li><strong>使用<code>repartition</code>和<code>coalesce</code>优化分区</strong>：<code>coalesce</code>避免全Shuffle</li>
<li><strong>广播大变量</strong>：<code>spark.broadcast()</code>减少数据传输</li>
</ul>
<h2 id="九、Spark集群部署与管理"><a href="#九、Spark集群部署与管理" class="headerlink" title="九、Spark集群部署与管理"></a>九、Spark集群部署与管理</h2><h3 id="9-1-部署模式"><a href="#9-1-部署模式" class="headerlink" title="9.1 部署模式"></a>9.1 部署模式</h3><p>Spark支持多种部署模式，适应不同的集群环境：</p>
<h4 id="Standalone模式"><a href="#Standalone模式" class="headerlink" title="Standalone模式"></a>Standalone模式</h4><ul>
<li>Spark自带的集群管理器</li>
<li>简单易用，无需依赖其他组件</li>
<li>支持自动故障转移（Spark 1.2+）</li>
</ul>
<h4 id="YARN模式"><a href="#YARN模式" class="headerlink" title="YARN模式"></a>YARN模式</h4><ul>
<li>集成Hadoop YARN资源管理器</li>
<li>共享集群资源，与MapReduce共存</li>
<li>支持两种模式：<ul>
<li>YARN Client：Driver在客户端运行</li>
<li>YARN Cluster：Driver在集群中运行</li>
</ul>
</li>
</ul>
<h4 id="Kubernetes模式"><a href="#Kubernetes模式" class="headerlink" title="Kubernetes模式"></a>Kubernetes模式</h4><ul>
<li>容器化部署，适合云环境</li>
<li>动态扩缩容，资源利用率高</li>
<li>支持Spark应用的容器化打包</li>
</ul>
<h3 id="9-2-集群配置最佳实践"><a href="#9-2-集群配置最佳实践" class="headerlink" title="9.2 集群配置最佳实践"></a>9.2 集群配置最佳实践</h3><ul>
<li><p><strong>Executor内存分配</strong>：</p>
<ul>
<li>避免设置过大内存（建议不超过32GB），减少GC压力</li>
<li>为操作系统和缓存预留10-20%内存</li>
</ul>
</li>
<li><p><strong>CPU核心配置</strong>：</p>
<ul>
<li>每个Executor核心数建议2-5个</li>
<li>考虑超线程，物理核心数的1-2倍</li>
</ul>
</li>
<li><p><strong>网络配置</strong>：</p>
<ul>
<li>使用高性能网络（10Gbps+）减少Shuffle开销</li>
<li>配置合理的网络缓冲区大小</li>
</ul>
</li>
<li><p><strong>存储配置</strong>：</p>
<ul>
<li>使用SSD存储Shuffle数据</li>
<li>多个磁盘分散IO压力</li>
</ul>
</li>
</ul>
<h3 id="9-3-监控与调试"><a href="#9-3-监控与调试" class="headerlink" title="9.3 监控与调试"></a>9.3 监控与调试</h3><ul>
<li><p><strong>Spark UI</strong>：提供应用执行的详细指标</p>
<ul>
<li>默认地址：http:&#x2F;&#x2F;<driver-node>:4040</li>
<li>历史服务器：Spark History Server</li>
</ul>
</li>
<li><p><strong>日志管理</strong>：</p>
<ul>
<li>配置日志聚合（YARN模式下<code>yarn.log-aggregation-enable</code>）</li>
<li>使用ELK栈集中管理日志</li>
</ul>
</li>
<li><p><strong>性能分析工具</strong>：</p>
<ul>
<li>Sparklens：Spark性能分析工具</li>
<li>Flame Graph：可视化CPU使用情况</li>
<li>GC日志分析：GCEasy、GCViewer</li>
</ul>
</li>
</ul>
<h2 id="十、Spark生态系统"><a href="#十、Spark生态系统" class="headerlink" title="十、Spark生态系统"></a>十、Spark生态系统</h2><p>Spark生态系统包含多个组件，提供端到端的大数据解决方案：</p>
<pre class="mermaid">%%{init: {"securityLevel": "loose"}}%%
graph LR
    SparkCore[Spark Core<br/>核心引擎] --> SparkSQL[Spark SQL<br/>结构化查询]
    SparkCore --> SparkStreaming[Spark Streaming<br/>流处理]
    SparkCore --> MLlib[MLlib<br/>机器学习]
    SparkCore --> GraphX[GraphX<br/>图计算]
    SparkSQL --> DeltaLake[Delta Lake<br/>数据湖]
    SparkStreaming --> StructuredStreaming[Structured Streaming<br/>结构化流处理]
    MLlib --> MLflow[MLflow<br/>机器学习生命周期管理]</pre>

<h3 id="10-1-核心组件"><a href="#10-1-核心组件" class="headerlink" title="10.1 核心组件"></a>10.1 核心组件</h3><ul>
<li><strong>Spark SQL</strong>：处理结构化数据，支持SQL和DataFrame API</li>
<li><strong>Spark Streaming</strong>：微批处理流数据</li>
<li><strong>Structured Streaming</strong>：基于DataFrame的流处理，支持事件时间</li>
<li><strong>MLlib</strong>：机器学习库，提供常用算法和工具</li>
<li><strong>GraphX</strong>：图计算库，支持图算法和图操作</li>
</ul>
<h3 id="10-2-生态扩展"><a href="#10-2-生态扩展" class="headerlink" title="10.2 生态扩展"></a>10.2 生态扩展</h3><ul>
<li><strong>Delta Lake</strong>：构建在Spark之上的数据湖解决方案，支持ACID事务</li>
<li><strong>Kafka</strong>：与Spark Streaming&#x2F;Structured Streaming集成的流数据平台</li>
<li><strong>Hudi</strong>：增量处理框架，支持数据更新和删除</li>
<li><strong>Iceberg</strong>：开放表格式，支持大型分析数据集</li>
<li><strong>MLflow</strong>：机器学习生命周期管理工具</li>
</ul>
<h2 id="十一、实际应用场景与最佳实践"><a href="#十一、实际应用场景与最佳实践" class="headerlink" title="十一、实际应用场景与最佳实践"></a>十一、实际应用场景与最佳实践</h2><h3 id="11-1-典型应用场景"><a href="#11-1-典型应用场景" class="headerlink" title="11.1 典型应用场景"></a>11.1 典型应用场景</h3><ul>
<li><strong>批处理ETL</strong>：数据清洗、转换和加载</li>
<li><strong>实时数据处理</strong>：日志分析、实时监控</li>
<li><strong>交互式数据分析</strong>：Ad-hoc查询、数据探索</li>
<li><strong>机器学习</strong>：模型训练、预测和评估</li>
<li><strong>图计算</strong>：社交网络分析、路径查找</li>
</ul>
<h3 id="11-2-最佳实践案例"><a href="#11-2-最佳实践案例" class="headerlink" title="11.2 最佳实践案例"></a>11.2 最佳实践案例</h3><h4 id="案例1：大数据ETL优化"><a href="#案例1：大数据ETL优化" class="headerlink" title="案例1：大数据ETL优化"></a>案例1：大数据ETL优化</h4><p>某电商平台使用Spark进行每日用户行为数据ETL：</p>
<ul>
<li><strong>问题</strong>：原始数据量大（TB级），包含大量小文件</li>
<li><strong>优化措施</strong>：<ol>
<li>使用<code>coalesce</code>合并小文件</li>
<li>采用Snappy压缩存储中间结果</li>
<li>缓存频繁访问的维度表</li>
<li>使用广播连接优化维度关联</li>
</ol>
</li>
<li><strong>效果</strong>：ETL作业执行时间从4小时减少到1.5小时</li>
</ul>
<h4 id="案例2：实时推荐系统"><a href="#案例2：实时推荐系统" class="headerlink" title="案例2：实时推荐系统"></a>案例2：实时推荐系统</h4><p>某视频平台使用Structured Streaming构建实时推荐系统：</p>
<ul>
<li><strong>架构</strong>：Kafka + Spark Structured Streaming + Redis</li>
<li><strong>关键技术</strong>：<ol>
<li>事件时间窗口计算用户兴趣</li>
<li>水印处理迟到数据</li>
<li>状态管理保存用户偏好</li>
<li>微批处理间隔设为5秒</li>
</ol>
</li>
<li><strong>效果</strong>：推荐延迟从分钟级降至秒级，用户点击率提升15%</li>
</ul>
<h4 id="案例3：机器学习模型训练"><a href="#案例3：机器学习模型训练" class="headerlink" title="案例3：机器学习模型训练"></a>案例3：机器学习模型训练</h4><p>某金融公司使用MLlib构建信用评分模型：</p>
<ul>
<li><strong>数据规模</strong>：千万级用户数据，数百个特征</li>
<li><strong>优化措施</strong>：<ol>
<li>使用DataFrame API进行特征工程</li>
<li>采用交叉验证选择最佳参数</li>
<li>使用管道（Pipeline）整合特征处理和模型训练</li>
<li>模型并行训练加速收敛</li>
</ol>
</li>
<li><strong>效果</strong>：模型训练时间减少40%，预测准确率提升3%</li>
</ul>
<h2 id="十二、总结与展望"><a href="#十二、总结与展望" class="headerlink" title="十二、总结与展望"></a>十二、总结与展望</h2><p>Spark作为新一代分布式计算引擎，通过内存计算、DAG执行和丰富的API，极大提升了大数据处理效率。其统一的编程模型和丰富的生态系统，使其成为大数据处理的首选平台。</p>
<h3 id="12-1-Spark发展趋势"><a href="#12-1-Spark发展趋势" class="headerlink" title="12.1 Spark发展趋势"></a>12.1 Spark发展趋势</h3><ul>
<li><strong>性能持续优化</strong>：进一步提升执行效率和资源利用率</li>
<li><strong>云原生支持</strong>：更好地适应云环境，支持Serverless架构</li>
<li><strong>流批一体</strong>：统一批处理和流处理模型</li>
<li><strong>AI集成</strong>：更紧密地与机器学习和深度学习集成</li>
<li><strong>易用性提升</strong>：简化API，降低使用门槛</li>
</ul>
<h3 id="12-2-结语"><a href="#12-2-结语" class="headerlink" title="12.2 结语"></a>12.2 结语</h3><p>Spark的设计理念体现了分布式计算的核心思想：通过抽象简化复杂性，通过优化提升性能，通过统一整合多样性。深入理解Spark的内部原理和优化技术，对于构建高效、可靠的大数据系统至关重要。随着大数据技术的不断发展，Spark将继续在数据处理领域发挥核心作用，推动数据驱动决策的广泛应用。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">XR</div><div class="post-copyright__author_desc">一片叶、一朵云</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/')">Spark技术详解：核心原理、架构与高级实践</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Spark技术详解：核心原理、架构与高级实践&amp;url=http://example.com/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">凌霄的博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Spark/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Spark<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>分布式处理<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>内存计算<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250624000019253.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2024/12/22/mac%E5%AE%89%E8%A3%85%20picgo%20%E6%8A%A5%E9%94%99%20%E6%96%87%E4%BB%B6%E6%8D%9F%E5%9D%8F/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350521.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">mac安装 picgo 报错 文件损坏</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/18/hadoop-ecosystem-explained/" title="Hadoop生态：YARN、HDFS、Hive、Spark、HBase是如何协同工作的？"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250619194740317.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-18</div><div class="title">Hadoop生态：YARN、HDFS、Hive、Spark、HBase是如何协同工作的？</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">XR</h1><div class="author-info__desc">一片叶、一朵云</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/kongxiaoran" target="_blank" title="Github"></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.</span> <span class="toc-text">Spark技术详解：核心原理、架构与高级实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E5%BC%95%E8%A8%80%EF%BC%9ASpark%E7%9A%84%E5%AE%9A%E4%BD%8D%E4%B8%8E%E4%BB%B7%E5%80%BC"><span class="toc-number">1.1.</span> <span class="toc-text">一、引言：Spark的定位与价值</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Spark%E4%B8%8EHadoop%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 Spark与Hadoop的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Spark%E6%A0%B8%E5%BF%83%E4%BC%98%E5%8A%BF"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 Spark核心优势</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Spark%E6%A0%B8%E5%BF%83%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">二、Spark核心架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 集群架构</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">核心组件说明</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%BA%94%E7%94%A8%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 应用执行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E6%A0%B8%E5%BF%83%E9%85%8D%E7%BD%AE%E5%8F%82%E6%95%B0"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 核心配置参数</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81Spark%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">三、Spark编程模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-RDD%EF%BC%9A%E5%BC%B9%E6%80%A7%E5%88%86%E5%B8%83%E5%BC%8F%E6%95%B0%E6%8D%AE%E9%9B%86"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 RDD：弹性分布式数据集</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">RDD核心特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD%E6%93%8D%E4%BD%9C%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">RDD操作类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#RDD%E4%BE%9D%E8%B5%96%E5%85%B3%E7%B3%BB"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">RDD依赖关系</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-DataFrame%E4%B8%8EDataset"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 DataFrame与Dataset</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DataFrame"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">DataFrame</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Dataset"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">Dataset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E8%80%85%E5%AF%B9%E6%AF%94"><span class="toc-number">1.3.2.3.</span> <span class="toc-text">三者对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81Spark%E6%89%A7%E8%A1%8C%E5%8E%9F%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">四、Spark执行原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-DAG%E8%B0%83%E5%BA%A6%E5%99%A8%EF%BC%88DAG-Scheduler%EF%BC%89"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 DAG调度器（DAG Scheduler）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-Task%E8%B0%83%E5%BA%A6%E5%99%A8%EF%BC%88Task-Scheduler%EF%BC%89"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 Task调度器（Task Scheduler）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%9C%AC%E5%9C%B0%E6%80%A7%E7%BA%A7%E5%88%AB"><span class="toc-number">1.4.2.1.</span> <span class="toc-text">数据本地性级别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E4%BB%BB%E5%8A%A1%E6%89%A7%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.3.</span> <span class="toc-text">4.3 任务执行流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-Shuffle%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.4.</span> <span class="toc-text">4.4 Shuffle机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Shuffle%E8%BF%87%E7%A8%8B"><span class="toc-number">1.4.4.1.</span> <span class="toc-text">Shuffle过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Shuffle%E4%BC%98%E5%8C%96"><span class="toc-number">1.4.4.2.</span> <span class="toc-text">Shuffle优化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81Spark-SQL%E4%B8%8E%E4%BC%98%E5%8C%96%E5%99%A8"><span class="toc-number">1.5.</span> <span class="toc-text">五、Spark SQL与优化器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-Catalyst%E4%BC%98%E5%8C%96%E5%99%A8"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 Catalyst优化器</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8C%96%E9%98%B6%E6%AE%B5"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">优化阶段</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-Tungsten%E6%89%A7%E8%A1%8C%E5%BC%95%E6%93%8E"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 Tungsten执行引擎</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-%E8%87%AA%E9%80%82%E5%BA%94%E6%9F%A5%E8%AF%A2%E6%89%A7%E8%A1%8C%EF%BC%88AQE%EF%BC%89"><span class="toc-number">1.5.3.</span> <span class="toc-text">5.3 自适应查询执行（AQE）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81Spark-Streaming%E4%B8%8E%E5%AE%9E%E6%97%B6%E5%A4%84%E7%90%86"><span class="toc-number">1.6.</span> <span class="toc-text">六、Spark Streaming与实时处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E4%B8%A4%E7%A7%8D%E6%B5%81%E5%A4%84%E7%90%86%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 两种流处理模型</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#DStream%EF%BC%88Spark-Streaming%EF%BC%89"><span class="toc-number">1.6.1.1.</span> <span class="toc-text">DStream（Spark Streaming）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Structured-Streaming"><span class="toc-number">1.6.1.2.</span> <span class="toc-text">Structured Streaming</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Structured-Streaming%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 Structured Streaming核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E5%A4%84%E7%90%86%E8%AF%AD%E4%B9%89%E4%BF%9D%E8%AF%81"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 处理语义保证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81Spark%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86"><span class="toc-number">1.7.</span> <span class="toc-text">七、Spark内存管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%86%85%E5%AD%98%E5%8C%BA%E5%9F%9F%E5%88%92%E5%88%86"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 内存区域划分</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%86%85%E5%AD%98%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 内存动态调整</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E5%86%85%E5%AD%98%E4%BC%98%E5%8C%96%E7%AD%96%E7%95%A5"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 内存优化策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81Spark%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"><span class="toc-number">1.8.</span> <span class="toc-text">八、Spark性能调优</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E5%A4%84%E7%90%86"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1 数据倾斜处理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A3%80%E6%B5%8B%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">检测数据倾斜</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%A7%A3%E5%86%B3%E7%AD%96%E7%95%A5"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">解决策略</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E5%BA%8F%E5%88%97%E5%8C%96%E4%BC%98%E5%8C%96"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2 序列化优化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-JVM%E8%B0%83%E4%BC%98"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3 JVM调优</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-%E5%85%B6%E4%BB%96%E4%BC%98%E5%8C%96%E6%8A%80%E5%B7%A7"><span class="toc-number">1.8.4.</span> <span class="toc-text">8.4 其他优化技巧</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81Spark%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%AE%A1%E7%90%86"><span class="toc-number">1.9.</span> <span class="toc-text">九、Spark集群部署与管理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E9%83%A8%E7%BD%B2%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.9.1.</span> <span class="toc-text">9.1 部署模式</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Standalone%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">Standalone模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#YARN%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">YARN模式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Kubernetes%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">Kubernetes模式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.9.2.</span> <span class="toc-text">9.2 集群配置最佳实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E7%9B%91%E6%8E%A7%E4%B8%8E%E8%B0%83%E8%AF%95"><span class="toc-number">1.9.3.</span> <span class="toc-text">9.3 监控与调试</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81Spark%E7%94%9F%E6%80%81%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.10.</span> <span class="toc-text">十、Spark生态系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.10.1.</span> <span class="toc-text">10.1 核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E7%94%9F%E6%80%81%E6%89%A9%E5%B1%95"><span class="toc-number">1.10.2.</span> <span class="toc-text">10.2 生态扩展</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E4%B8%8E%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.11.</span> <span class="toc-text">十一、实际应用场景与最佳实践</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#11-1-%E5%85%B8%E5%9E%8B%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.11.1.</span> <span class="toc-text">11.1 典型应用场景</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11-2-%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5%E6%A1%88%E4%BE%8B"><span class="toc-number">1.11.2.</span> <span class="toc-text">11.2 最佳实践案例</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B1%EF%BC%9A%E5%A4%A7%E6%95%B0%E6%8D%AEETL%E4%BC%98%E5%8C%96"><span class="toc-number">1.11.2.1.</span> <span class="toc-text">案例1：大数据ETL优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B2%EF%BC%9A%E5%AE%9E%E6%97%B6%E6%8E%A8%E8%8D%90%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.11.2.2.</span> <span class="toc-text">案例2：实时推荐系统</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B3%EF%BC%9A%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E6%A8%A1%E5%9E%8B%E8%AE%AD%E7%BB%83"><span class="toc-number">1.11.2.3.</span> <span class="toc-text">案例3：机器学习模型训练</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E6%80%BB%E7%BB%93%E4%B8%8E%E5%B1%95%E6%9C%9B"><span class="toc-number">1.12.</span> <span class="toc-text">十二、总结与展望</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#12-1-Spark%E5%8F%91%E5%B1%95%E8%B6%8B%E5%8A%BF"><span class="toc-number">1.12.1.</span> <span class="toc-text">12.1 Spark发展趋势</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12-2-%E7%BB%93%E8%AF%AD"><span class="toc-number">1.12.2.</span> <span class="toc-text">12.2 结语</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/01/%E4%BD%BF%E7%94%A8Jenv%E7%AE%A1%E7%90%86%E5%A4%9A%E7%89%88%E6%9C%ACJDK%E7%8E%AF%E5%A2%83/" title="使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250624000019253.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践"/></a><div class="content"><a class="title" href="/2025/07/01/%E4%BD%BF%E7%94%A8Jenv%E7%AE%A1%E7%90%86%E5%A4%9A%E7%89%88%E6%9C%ACJDK%E7%8E%AF%E5%A2%83/" title="使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践">使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践</a><time datetime="2025-06-30T16:00:00.000Z" title="发表于 2025-07-01 00:00:00">2025-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/27/DNS%E8%A7%A3%E9%94%81%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%8E%9F%E7%90%86%E3%80%81%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" title="DNS解锁技术原理、实现"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618094256140.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DNS解锁技术原理、实现"/></a><div class="content"><a class="title" href="/2025/06/27/DNS%E8%A7%A3%E9%94%81%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%8E%9F%E7%90%86%E3%80%81%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" title="DNS解锁技术原理、实现">DNS解锁技术原理、实现</a><time datetime="2025-06-27T02:00:00.000Z" title="发表于 2025-06-27 10:00:00">2025-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/27/%E7%A8%8B%E5%BA%8F%E5%8C%96%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E6%8A%95%E6%94%BE%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/" title="程序化广告数据处理与投放技术架构与业务模式"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625170909952.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="程序化广告数据处理与投放技术架构与业务模式"/></a><div class="content"><a class="title" href="/2025/06/27/%E7%A8%8B%E5%BA%8F%E5%8C%96%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E6%8A%95%E6%94%BE%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/" title="程序化广告数据处理与投放技术架构与业务模式">程序化广告数据处理与投放技术架构与业务模式</a><time datetime="2025-06-26T16:00:00.000Z" title="发表于 2025-06-27 00:00:00">2025-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/26/confidential_computing_implementation_guide/" title="机密计算环境实施：从硬件选型到应用部署"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625095124143.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机密计算环境实施：从硬件选型到应用部署"/></a><div class="content"><a class="title" href="/2025/06/26/confidential_computing_implementation_guide/" title="机密计算环境实施：从硬件选型到应用部署">机密计算环境实施：从硬件选型到应用部署</a><time datetime="2025-06-25T16:00:00.000Z" title="发表于 2025-06-26 00:00:00">2025-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/25/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/" title="HDFS技术详解：架构、存储与数据安全机制"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618094256140.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HDFS技术详解：架构、存储与数据安全机制"/></a><div class="content"><a class="title" href="/2025/06/25/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/" title="HDFS技术详解：架构、存储与数据安全机制">HDFS技术详解：架构、存储与数据安全机制</a><time datetime="2025-06-25T02:00:00.000Z" title="发表于 2025-06-25 10:00:00">2025-06-25</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="XR" target="_blank">XR</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">4</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 0.88rem;">Argon2<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>2</sup></a><a href="/tags/DSP/" style="font-size: 0.88rem;">DSP<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 0.88rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 0.88rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 0.88rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>6</sup></a><a href="/tags/Kubernetes/" style="font-size: 0.88rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 0.88rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 0.88rem;">NAT<sup>1</sup></a><a href="/tags/RTB/" style="font-size: 0.88rem;">RTB<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 0.88rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 0.88rem;">SGX<sup>2</sup></a><a href="/tags/Spark/" style="font-size: 0.88rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 0.88rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 0.88rem;">TEE<sup>2</sup></a><a href="/tags/TME/" style="font-size: 0.88rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 0.88rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 0.88rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 0.88rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>2</sup></a><a href="/tags/%E5%B9%BF%E5%91%8A%E6%8A%95%E6%94%BE/" style="font-size: 0.88rem;">广告投放<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">隐私计算<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/26/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 XR 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
      appKey: 'MR93sqmbPdh7Zm1bZzjXNvlm',
      avatar: 'mp',
      serverURLs: 'https://cbsqtaqs.api.lncldglobal.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://cbsqtaqs.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
        "X-LC-Key": 'MR93sqmbPdh7Zm1bZzjXNvlm',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>