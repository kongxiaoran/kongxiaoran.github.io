<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>HDFS技术详解：架构、存储与数据安全机制 | 凌霄的博客</title><meta name="keywords" content="分布式存储,HDFS"><meta name="author" content="XR"><meta name="copyright" content="XR"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="HDFS技术详解：架构、存储与数据安全机制"><meta name="application-name" content="HDFS技术详解：架构、存储与数据安全机制"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="HDFS技术详解：架构、存储与数据安全机制"><meta property="og:url" content="http://example.com/2023/11/15/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/index.html"><meta property="og:site_name" content="凌霄的博客"><meta property="og:description" content="HDFS技术详解：架构、存储与数据安全机制一、整体架构HDFS采用主从（Master&amp;#x2F;Slave）架构模式，由以下核心组件构成： 1.1 核心组件 NameNode：集群的管理者，负责：  管理文件系统命名空间 维护文件与数据块的映射关系 记录数据块的副本信息 处理客户端的元数据操作请求"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta property="article:author" content="XR"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg"><meta name="description" content="HDFS技术详解：架构、存储与数据安全机制一、整体架构HDFS采用主从（Master&amp;#x2F;Slave）架构模式，由以下核心组件构成： 1.1 核心组件 NameNode：集群的管理者，负责：  管理文件系统命名空间 维护文件与数据块的映射关系 记录数据块的副本信息 处理客户端的元数据操作请求"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2023/11/15/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: XR","link":"链接: ","source":"来源: 凌霄的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '凌霄的博客',
  title: 'HDFS技术详解：架构、存储与数据安全机制',
  postAI: '',
  pageFillDescription: 'HDFS技术详解：架构、存储与数据安全机制, 一、整体架构, 1.1 核心组件, 1.2 架构图, 二、文件存储结构, 2.1 数据块（Block）, 2.2 副本放置策略, 2.3 存储结构图, 三、数据模型, 3.1 命名空间, 3.2 元数据, 3.3 数据模型特点, 四、数据写入流程, 4.1 详细步骤, 4.2 写入流程图, 五、数据读取流程, 5.1 详细步骤, 5.2 读取流程图, 六、数据防丢失机制, 6.1 副本机制, 6.2 心跳检测, 6.3 数据完整性校验, 6.4 安全模式, 6.5 元数据备份, 七、磁盘损坏应对措施, 7.1 坏块检测与处理, 7.2 数据均衡, 7.3 节点退役, 7.4 灾难恢复, 八、HDFS高级特性与优化, 8.1 HDFS联邦（Federation）, 核心组件, 架构优势, 8.2 HDFS高可用（HA）实现, 核心组件, 故障转移流程, 8.3 纠删码（Erasure Coding）, 实现原理, 优缺点对比, 8.4 HDFS缓存机制, 核心概念, 工作流程, 8.5 HDFS安全机制, 8.5.1 身份认证, 8.5.2 授权控制, 8.5.3 数据保护, 九、HDFS性能优化, 9.1 关键配置优化, NameNode优化, DataNode优化, 客户端优化, 9.2 块大小与副本策略优化, 块大小选择, 副本策略调整, 9.3 小文件问题解决方案, 合并小文件, 联邦与命名空间隔离, 缓存小文件元数据, 十、总结技术详解架构存储与数据安全机制一整体架构采用主从架构模式由以下核心组件构成核心组件集群的管理者负责管理文件系统命名空间维护文件与数据块的映射关系记录数据块的副本信息处理客户端的元数据操作请求数据存储节点负责存储实际的数据块执行数据块的读写操作定期向发送心跳和块报告辅助节点负责定期合并的编辑日志和镜像文件减轻的负担但不提供故障转移能力架构图客户端元数据操作数据读写数据读写数据读写心跳检测心跳检测心跳检测合并日志副本复制副本复制二文件存储结构数据块默认块大小可通过配置大文件会被分割成多个块小文件不会占用整个块空间每个块会存储多个副本默认个可通过配置副本放置策略第一个副本放置在客户端所在节点如果客户端不在集群内则随机选择第二个副本放置在与第一个副本不同的机架上第三个副本放置在与第二个副本相同机架的不同节点上更多副本随机分配存储结构图大文件数据块数据块数据块副本副本不同机架副本同机架副本副本不同机架副本同机架三数据模型命名空间层次化文件系统结构与文件系统类似支持目录和文件的创建删除重命名等操作通过标识文件元数据内存元数据内存中维护的文件系统树及文件目录元数据持久化元数据文件系统元数据的快照记录文件系统的所有修改操作数据模型特点一次写入多次读取不支持随机写入支持追加写入文件一旦创建写入并关闭后不能修改四数据写入流程详细步骤客户端请求创建文件客户端调用方法检查权限路径是否存在等返回对象客户端写入数据客户端将数据分成数据包默认客户端创建和负责将数据包发送到构建数据管道选择合适的组成管道例如数据传输客户端将数据包写入管道的第一个每个接收数据包后存储并转发给下一个最后一个返回确认信息完成写入所有数据写入完成后客户端调用方法提交文件创建操作写入流程图请求创建文件返回请求数据块存储位置返回建立数据管道确认管道确认管道管道确认管道确认管道建立完成写入数据包发送数据包转发数据包转发数据包完成写入关闭文件确认关闭五数据读取流程详细步骤客户端请求读取文件客户端调用方法返回文件的数据块信息及对应位置选择最优客户端根据网络拓扑选择最近的优先读取本地节点数据其次同机架节点最后跨机架节点读取数据客户端创建对象按顺序读取数据块若某故障自动切换到其他副本数据校验读取数据时验证校验和若校验失败读取其他副本并标记坏块组装文件客户端将读取的数据块组装成完整文件读取流程图请求读取文件元数据返回数据块及副本位置请求读取数据块最近节点返回数据块请求读取数据块最近节点返回数据块数据块读取失败请求读取数据块返回数据块组装数据块为完整文件六数据防丢失机制副本机制默认副本策略确保数据冗余可针对重要文件设置更高的副本数副本分布在不同机架提高容错性心跳检测每秒向发送心跳若分钟未收到心跳标记为死亡自动复制死亡节点上的数据块到其他节点数据完整性校验每个数据块都有对应的校验和写入时计算校验和并存储读取时重新计算并比对校验和校验失败时读取其他副本并标记坏块安全模式启动时自动进入安全模式接收所有的块报告当最小副本条件满足时自动退出安全模式可手动进入或退出安全模式元数据备份和定期备份支持配置多个元数据存储目录可配置自动备份到远程存储七磁盘损坏应对措施坏块检测与处理定期扫描磁盘上的数据块发现坏块后向报告安排从其他副本复制数据达到最小副本数后标记坏块为可删除数据均衡工具自动平衡集群数据分布避免个别节点存储压力过大可手动触发或配置定期执行节点退役支持平滑退役管理员可将节点加入退役列表自动迁移数据到其他节点数据迁移完成后节点可安全下线灾难恢复利用的元数据备份配置高可用使用共享编辑日志配置自动故障转移八高级特性与优化联邦联邦通过引入多个独立的解决了单的扩展性瓶颈每个管理文件系统命名空间的一部分彼此独立且不共享状态核心组件多个独立的命名空间每个管理一部分文件系统每个命名空间关联一组数据块池包含该命名空间下文件的所有数据块标识整个集群的唯一所有共享此架构优势命名空间水平扩展支持更多文件和更大存储容量性能隔离不同业务可使用不同命名空间故障隔离单个故障不影响其他命名空间可独立升级各个客户端挂载表命名空间挂载表命名空间挂载表命名空间块池集群块池集群块池集群共享存储高可用实现通过主备机制解决单点故障问题避免了无法提供故障转移的局限核心组件处理所有客户端请求同步的元数据随时准备接管集群通常个节点存储的共享存储故障检测器监控健康状态故障转移流程定期向发送健康检查节点故障时释放锁节点的获取锁通过机制确保节点完全下线节点升级为开始处理客户端请求客户端自动路由故障时切换写入集群节点读取选举与健康监控隔离机制防止脑裂接管服务纠删码引入纠删码机制在提供同等容错能力的同时大幅降低存储开销适用于冷数据存储实现原理使用码将个数据块编码为个校验块任意个块可恢复原始数据默认配置个数据块个校验块相比副本节省存储空间支持按目录配置通过设置默认策略优缺点对比特性纠删码副本机制存储开销容错能力最多个块丢失最多个副本丢失读写性能写性能较低读性能接近读写性能均衡适用场景冷数据归档数据热数据频繁访问数据缓存机制提供集中式缓存管理允许将频繁访问的数据块缓存在指定的内存中提高读取性能核心概念缓存池管理员创建的资源分配单元包含缓存空间配额和权限控制缓存指令指定要缓存的路径和缓存副本数缓存块被缓存的数据块保留在内存中工作流程管理员创建缓存池并分配资源用户提交缓存指令指定要缓存的文件目录选择合适的缓存数据块将数据块加载到内存并向确认客户端读取时优先选择缓存副本安全机制身份认证认证默认的强认证机制通过票据验证用户身份简单认证适用于测试环境基于主机名或用户名的信任机制允许应用程序代表用户访问避免重复认证授权控制风格权限基于用户组和其他用户的读写执行权限访问控制列表更细粒度的权限控制支持为特定用户组设置权限权限检查所有元数据操作需通过权限验证权限检查数据块访问需验证块所有权数据保护传输加密使用加密节点间数据传输存储加密透明数据加密保护磁盘上的数据数据脱敏通过加密区实现敏感数据隔离九性能优化关键配置优化优化处理请求的线程数建议设置为集群规模的倍单个目录最大文件数默认配置多个存储目录最好包含提高元数据可靠性优化处理的线程数建议数据传输线程数建议平衡数据时的带宽限制默认客户端优化启用短路读取绕过直接读取本地数据写入失败时替换策略文件缓冲区大小建议块大小与副本策略优化块大小选择大文件如日志视频减少块数量和元数据开销小文件如文档图片提高并行处理效率计算密集型作业较小块大小增加并行度密集型作业较大块大小减少寻址开销副本策略调整热数据个副本提高可用性温数据个副本平衡可用性和存储成本冷数据个副本纠删码降低存储成本本地性优化根据计算节点位置调整副本分布小文件问题解决方案对大量小文件处理效率低下可通过以下方案优化合并小文件使用将多个小文件打包成一个归档文件应用层预处理合并小文件后写入联邦与命名空间隔离将不同类型小文件分布到不同命名空间减轻单个的内存压力缓存小文件元数据配置增加元数据缓存减少磁盘十总结通过精心设计的分布式架构副本机制和数据校验等技术在大规模集群环境下提供了高吞吐量和高可靠性的数据存储服务其核心设计思想是通过牺牲部分硬件成本和延迟换取系统的可扩展性和容错性非常适合存储海量数据并进行批处理分析理解的内部工作原理对于优化大数据处理性能保障数据安全以及解决实际生产环境中的问题具有重要意义',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-19 22:56:48',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">凌霄的博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 1.05rem;">Argon2<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 1.05rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 1.05rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 1.05rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>5</sup></a><a href="/tags/Kubernetes/" style="font-size: 1.05rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 1.05rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 1.05rem;">NAT<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 1.05rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 1.05rem;">SGX<sup>1</sup></a><a href="/tags/Spark/" style="font-size: 1.05rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 1.05rem;">TDX<sup>1</sup></a><a href="/tags/TEE/" style="font-size: 1.05rem;">TEE<sup>1</sup></a><a href="/tags/TME/" style="font-size: 1.05rem;">TME<sup>1</sup></a><a href="/tags/YARN/" style="font-size: 1.05rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 1.05rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 1.05rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">隐私计算<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">27</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url">大数据</a><i class="anzhiyufont anzhiyu-icon-angle-right post-meta-separator"></i><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop/" itemprop="url">Hadoop</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>分布式存储</span></a><a class="article-meta__tags" href="/tags/HDFS/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>HDFS</span></a></span></div></div><h1 class="post-title" itemprop="name headline">HDFS技术详解：架构、存储与数据安全机制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2023-11-15T02:00:00.000Z" title="发表于 2023-11-15 10:00:00">2023-11-15</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-19T14:56:48.543Z" title="更新于 2025-06-19 22:56:48">2025-06-19</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="HDFS技术详解：架构、存储与数据安全机制"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为杭州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src=""></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2023/11/15/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/"><header><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/" itemprop="url">大数据</a><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/Hadoop/" itemprop="url">Hadoop</a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" tabindex="-1" itemprop="url">分布式存储</a><a href="/tags/HDFS/" tabindex="-1" itemprop="url">HDFS</a><h1 id="CrawlerTitle" itemprop="name headline">HDFS技术详解：架构、存储与数据安全机制</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">XR</span><time itemprop="dateCreated datePublished" datetime="2023-11-15T02:00:00.000Z" title="发表于 2023-11-15 10:00:00">2023-11-15</time><time itemprop="dateCreated datePublished" datetime="2025-06-19T14:56:48.543Z" title="更新于 2025-06-19 22:56:48">2025-06-19</time></header><h1 id="HDFS技术详解：架构、存储与数据安全机制"><a href="#HDFS技术详解：架构、存储与数据安全机制" class="headerlink" title="HDFS技术详解：架构、存储与数据安全机制"></a>HDFS技术详解：架构、存储与数据安全机制</h1><h2 id="一、整体架构"><a href="#一、整体架构" class="headerlink" title="一、整体架构"></a>一、整体架构</h2><p>HDFS采用主从（Master&#x2F;Slave）架构模式，由以下核心组件构成：</p>
<h3 id="1-1-核心组件"><a href="#1-1-核心组件" class="headerlink" title="1.1 核心组件"></a>1.1 核心组件</h3><ul>
<li><p><strong>NameNode</strong>：集群的管理者，负责：</p>
<ul>
<li>管理文件系统命名空间</li>
<li>维护文件与数据块的映射关系</li>
<li>记录数据块的副本信息</li>
<li>处理客户端的元数据操作请求</li>
</ul>
</li>
<li><p><strong>DataNode</strong>：数据存储节点，负责：</p>
<ul>
<li>存储实际的数据块</li>
<li>执行数据块的读写操作</li>
<li>定期向NameNode发送心跳和块报告</li>
</ul>
</li>
<li><p><strong>Secondary NameNode</strong>：辅助节点，负责：</p>
<ul>
<li>定期合并NameNode的编辑日志（EditLog）和镜像文件（FSImage）</li>
<li>减轻NameNode的负担，但不提供故障转移能力</li>
</ul>
</li>
</ul>
<h3 id="1-2-架构图"><a href="#1-2-架构图" class="headerlink" title="1.2 架构图"></a>1.2 架构图</h3><pre class="mermaid">graph TD
    Client[客户端] -->|元数据操作| NameNode
    Client -->|数据读写| DataNode1
    Client -->|数据读写| DataNode2
    Client -->|数据读写| DataNode3
    NameNode -->|心跳检测| DataNode1
    NameNode -->|心跳检测| DataNode2
    NameNode -->|心跳检测| DataNode3
    SecondaryNameNode -->|合并日志| NameNode
    DataNode1 <-->|副本复制| DataNode2
    DataNode2 <-->|副本复制| DataNode3</pre>

<h2 id="二、文件存储结构"><a href="#二、文件存储结构" class="headerlink" title="二、文件存储结构"></a>二、文件存储结构</h2><h3 id="2-1-数据块（Block）"><a href="#2-1-数据块（Block）" class="headerlink" title="2.1 数据块（Block）"></a>2.1 数据块（Block）</h3><ul>
<li>默认块大小：128MB（可通过<code>dfs.blocksize</code>配置）</li>
<li>大文件会被分割成多个块，小文件不会占用整个块空间</li>
<li>每个块会存储多个副本，默认3个（可通过<code>dfs.replication</code>配置）</li>
</ul>
<h3 id="2-2-副本放置策略"><a href="#2-2-副本放置策略" class="headerlink" title="2.2 副本放置策略"></a>2.2 副本放置策略</h3><ul>
<li>第一个副本：放置在客户端所在节点（如果客户端不在集群内，则随机选择）</li>
<li>第二个副本：放置在与第一个副本不同的机架上</li>
<li>第三个副本：放置在与第二个副本相同机架的不同节点上</li>
<li>更多副本：随机分配</li>
</ul>
<h3 id="2-3-存储结构图"><a href="#2-3-存储结构图" class="headerlink" title="2.3 存储结构图"></a>2.3 存储结构图</h3><pre class="mermaid">graph LR
    File[大文件] --> Block1[数据块1
128MB]
    File --> Block2[数据块2
128MB]
    File --> Block3[数据块3
64MB]
    Block1 --> DN1[副本1
DataNode A]
    Block1 --> DN2[副本2
DataNode B
不同机架]
    Block1 --> DN3[副本3
DataNode C
同机架B]
    Block2 --> DN4[副本1
DataNode B]
    Block2 --> DN5[副本2
DataNode C
不同机架]
    Block2 --> DN6[副本3
DataNode D
同机架C]</pre>

<h2 id="三、数据模型"><a href="#三、数据模型" class="headerlink" title="三、数据模型"></a>三、数据模型</h2><h3 id="3-1-命名空间"><a href="#3-1-命名空间" class="headerlink" title="3.1 命名空间"></a>3.1 命名空间</h3><ul>
<li>层次化文件系统结构，与Linux文件系统类似</li>
<li>支持目录和文件的创建、删除、重命名等操作</li>
<li>通过URI标识文件：<code>hdfs://namenode:port/path/to/file</code></li>
</ul>
<h3 id="3-2-元数据"><a href="#3-2-元数据" class="headerlink" title="3.2 元数据"></a>3.2 元数据</h3><ul>
<li><strong>内存元数据</strong>：NameNode内存中维护的文件系统树及文件&#x2F;目录元数据</li>
<li><strong>持久化元数据</strong>：<ul>
<li>FSImage：文件系统元数据的快照</li>
<li>EditLog：记录文件系统的所有修改操作</li>
</ul>
</li>
</ul>
<h3 id="3-3-数据模型特点"><a href="#3-3-数据模型特点" class="headerlink" title="3.3 数据模型特点"></a>3.3 数据模型特点</h3><ul>
<li>一次写入，多次读取（不支持随机写入）</li>
<li>支持追加写入</li>
<li>文件一旦创建、写入并关闭后，不能修改</li>
</ul>
<h2 id="四、数据写入流程"><a href="#四、数据写入流程" class="headerlink" title="四、数据写入流程"></a>四、数据写入流程</h2><h3 id="4-1-详细步骤"><a href="#4-1-详细步骤" class="headerlink" title="4.1 详细步骤"></a>4.1 详细步骤</h3><ol>
<li><p><strong>客户端请求创建文件</strong></p>
<ul>
<li>客户端调用<code>DistributedFileSystem.create()</code>方法</li>
<li>NameNode检查权限、路径是否存在等</li>
<li>NameNode返回FSDataOutputStream对象</li>
</ul>
</li>
<li><p><strong>客户端写入数据</strong></p>
<ul>
<li>客户端将数据分成数据包（Packet，默认64KB）</li>
<li>客户端创建DataStreamer和ResponseProcessor</li>
<li>DataStreamer负责将数据包发送到DataNode</li>
</ul>
</li>
<li><p><strong>构建数据管道</strong></p>
<ul>
<li>NameNode选择合适的DataNode组成管道</li>
<li>例如：DataNode1 -&gt; DataNode2 -&gt; DataNode3</li>
</ul>
</li>
<li><p><strong>数据传输</strong></p>
<ul>
<li>客户端将数据包写入管道的第一个DataNode</li>
<li>每个DataNode接收数据包后存储，并转发给下一个DataNode</li>
<li>最后一个DataNode返回确认信息</li>
</ul>
</li>
<li><p><strong>完成写入</strong></p>
<ul>
<li>所有数据写入完成后，客户端调用<code>close()</code>方法</li>
<li>NameNode提交文件创建操作</li>
</ul>
</li>
</ol>
<h3 id="4-2-写入流程图"><a href="#4-2-写入流程图" class="headerlink" title="4.2 写入流程图"></a>4.2 写入流程图</h3><pre class="mermaid">sequenceDiagram
    participant Client
    participant NameNode
    participant DN1
    participant DN2
    participant DN3

    Client->>NameNode: 请求创建文件
    NameNode-->>Client: 返回FSDataOutputStream
    Client->>NameNode: 请求数据块存储位置
    NameNode-->>Client: 返回DN1, DN2, DN3
    Client->>DN1: 建立数据管道(DN1->DN2->DN3)
    DN1->>DN2: 确认管道
    DN2->>DN3: 确认管道
    DN3-->>DN2: 管道确认
    DN2-->>DN1: 管道确认
    DN1-->>Client: 管道建立完成
    loop 写入数据包
        Client->>DN1: 发送数据包
        DN1->>DN2: 转发数据包
        DN2->>DN3: 转发数据包
        DN3-->>DN2: ACK
        DN2-->>DN1: ACK
        DN1-->>Client: ACK
    end
    Client->>NameNode: 完成写入，关闭文件
    NameNode-->>Client: 确认关闭</pre>

<h2 id="五、数据读取流程"><a href="#五、数据读取流程" class="headerlink" title="五、数据读取流程"></a>五、数据读取流程</h2><h3 id="5-1-详细步骤"><a href="#5-1-详细步骤" class="headerlink" title="5.1 详细步骤"></a>5.1 详细步骤</h3><ol>
<li><p><strong>客户端请求读取文件</strong></p>
<ul>
<li>客户端调用<code>DistributedFileSystem.open()</code>方法</li>
<li>NameNode返回文件的数据块信息及对应DataNode位置</li>
</ul>
</li>
<li><p><strong>选择最优DataNode</strong></p>
<ul>
<li>客户端根据网络拓扑选择最近的DataNode</li>
<li>优先读取本地节点数据，其次同机架节点，最后跨机架节点</li>
</ul>
</li>
<li><p><strong>读取数据</strong></p>
<ul>
<li>客户端创建FSDataInputStream对象</li>
<li>按顺序读取数据块</li>
<li>若某DataNode故障，自动切换到其他副本</li>
</ul>
</li>
<li><p><strong>数据校验</strong></p>
<ul>
<li>读取数据时验证校验和</li>
<li>若校验失败，读取其他副本并标记坏块</li>
</ul>
</li>
<li><p><strong>组装文件</strong></p>
<ul>
<li>客户端将读取的数据块组装成完整文件</li>
</ul>
</li>
</ol>
<h3 id="5-2-读取流程图"><a href="#5-2-读取流程图" class="headerlink" title="5.2 读取流程图"></a>5.2 读取流程图</h3><pre class="mermaid">sequenceDiagram
    participant Client
    participant NameNode
    participant DN1
    participant DN2
    participant DN3

    Client->>NameNode: 请求读取文件元数据
    NameNode-->>Client: 返回数据块及副本位置
    Client->>DN1: 请求读取数据块1(最近节点)
    DN1-->>Client: 返回数据块1
    Client->>DN2: 请求读取数据块2(最近节点)
    DN2-->>Client: 返回数据块2
    alt 数据块3读取失败
        Client->>DN3: 请求读取数据块3
        DN3-->>Client: 返回数据块3
    end
    Client->>Client: 组装数据块为完整文件</pre>

<h2 id="六、数据防丢失机制"><a href="#六、数据防丢失机制" class="headerlink" title="六、数据防丢失机制"></a>六、数据防丢失机制</h2><h3 id="6-1-副本机制"><a href="#6-1-副本机制" class="headerlink" title="6.1 副本机制"></a>6.1 副本机制</h3><ul>
<li>默认3副本策略，确保数据冗余</li>
<li>可针对重要文件设置更高的副本数</li>
<li>副本分布在不同机架，提高容错性</li>
</ul>
<h3 id="6-2-心跳检测"><a href="#6-2-心跳检测" class="headerlink" title="6.2 心跳检测"></a>6.2 心跳检测</h3><ul>
<li>DataNode每3秒向NameNode发送心跳</li>
<li>NameNode若10分钟未收到心跳，标记DataNode为死亡</li>
<li>自动复制死亡节点上的数据块到其他节点</li>
</ul>
<h3 id="6-3-数据完整性校验"><a href="#6-3-数据完整性校验" class="headerlink" title="6.3 数据完整性校验"></a>6.3 数据完整性校验</h3><ul>
<li>每个数据块都有对应的校验和（Checksum）</li>
<li>写入时计算校验和并存储</li>
<li>读取时重新计算并比对校验和</li>
<li>校验失败时读取其他副本，并标记坏块</li>
</ul>
<h3 id="6-4-安全模式"><a href="#6-4-安全模式" class="headerlink" title="6.4 安全模式"></a>6.4 安全模式</h3><ul>
<li>启动时自动进入安全模式</li>
<li>NameNode接收所有DataNode的块报告</li>
<li>当最小副本条件满足时，自动退出安全模式</li>
<li>可手动进入或退出安全模式</li>
</ul>
<h3 id="6-5-元数据备份"><a href="#6-5-元数据备份" class="headerlink" title="6.5 元数据备份"></a>6.5 元数据备份</h3><ul>
<li>FSImage和EditLog定期备份</li>
<li>支持配置多个元数据存储目录</li>
<li>可配置自动备份到远程存储</li>
</ul>
<h2 id="七、磁盘损坏应对措施"><a href="#七、磁盘损坏应对措施" class="headerlink" title="七、磁盘损坏应对措施"></a>七、磁盘损坏应对措施</h2><h3 id="7-1-坏块检测与处理"><a href="#7-1-坏块检测与处理" class="headerlink" title="7.1 坏块检测与处理"></a>7.1 坏块检测与处理</h3><ul>
<li>DataNode定期扫描磁盘上的数据块</li>
<li>发现坏块后向NameNode报告</li>
<li>NameNode安排从其他副本复制数据</li>
<li>达到最小副本数后，标记坏块为可删除</li>
</ul>
<h3 id="7-2-数据均衡"><a href="#7-2-数据均衡" class="headerlink" title="7.2 数据均衡"></a>7.2 数据均衡</h3><ul>
<li>HDFS Balancer工具自动平衡集群数据分布</li>
<li>避免个别节点存储压力过大</li>
<li>可手动触发或配置定期执行</li>
</ul>
<h3 id="7-3-节点退役"><a href="#7-3-节点退役" class="headerlink" title="7.3 节点退役"></a>7.3 节点退役</h3><ul>
<li>支持DataNode平滑退役</li>
<li>管理员可将节点加入退役列表</li>
<li>NameNode自动迁移数据到其他节点</li>
<li>数据迁移完成后，节点可安全下线</li>
</ul>
<h3 id="7-4-灾难恢复"><a href="#7-4-灾难恢复" class="headerlink" title="7.4 灾难恢复"></a>7.4 灾难恢复</h3><ul>
<li>利用Secondary NameNode的元数据备份</li>
<li>配置NameNode高可用（HA）</li>
<li>使用QJM（Quorum Journal Manager）共享编辑日志</li>
<li>配置自动故障转移</li>
</ul>
<h2 id="八、HDFS高级特性与优化"><a href="#八、HDFS高级特性与优化" class="headerlink" title="八、HDFS高级特性与优化"></a>八、HDFS高级特性与优化</h2><h3 id="8-1-HDFS联邦（Federation）"><a href="#8-1-HDFS联邦（Federation）" class="headerlink" title="8.1 HDFS联邦（Federation）"></a>8.1 HDFS联邦（Federation）</h3><p>HDFS联邦通过引入多个独立的NameNode&#x2F;Namespace解决了单NameNode的扩展性瓶颈，每个NameNode管理文件系统命名空间的一部分，彼此独立且不共享状态。</p>
<h4 id="核心组件"><a href="#核心组件" class="headerlink" title="核心组件"></a>核心组件</h4><ul>
<li><strong>NameNode&#x2F;Namespace</strong>：多个独立的命名空间，每个管理一部分文件系统</li>
<li><strong>Block Pool</strong>：每个命名空间关联一组数据块池，包含该命名空间下文件的所有数据块</li>
<li><strong>ClusterID</strong>：标识整个集群的唯一ID，所有NameNode共享此ID</li>
</ul>
<h4 id="架构优势"><a href="#架构优势" class="headerlink" title="架构优势"></a>架构优势</h4><ul>
<li>命名空间水平扩展，支持更多文件和更大存储容量</li>
<li>性能隔离，不同业务可使用不同命名空间</li>
<li>故障隔离，单个NameNode故障不影响其他命名空间</li>
<li>可独立升级各个NameNode</li>
</ul>
<pre class="mermaid">graph TD
    Client[客户端] -->|挂载表| NS1[命名空间1
NameNode A]
    Client -->|挂载表| NS2[命名空间2
NameNode B]
    Client -->|挂载表| NS3[命名空间3
NameNode C]
    NS1 --> BP1[块池1
DataNode集群]
    NS2 --> BP2[块池2
DataNode集群]
    NS3 --> BP3[块池3
DataNode集群]
    BP1 & BP2 & BP3 --> CommonDataNodes[共享DataNode存储]</pre>

<h3 id="8-2-HDFS高可用（HA）实现"><a href="#8-2-HDFS高可用（HA）实现" class="headerlink" title="8.2 HDFS高可用（HA）实现"></a>8.2 HDFS高可用（HA）实现</h3><p>HDFS HA通过主备NameNode机制解决单点故障问题，避免了Secondary NameNode无法提供故障转移的局限。</p>
<h4 id="核心组件-1"><a href="#核心组件-1" class="headerlink" title="核心组件"></a>核心组件</h4><ul>
<li><strong>Active NameNode</strong>：处理所有客户端请求</li>
<li><strong>Standby NameNode</strong>：同步Active的元数据，随时准备接管</li>
<li><strong>JournalNodes</strong>：集群（通常3-5个节点），存储EditLog的共享存储</li>
<li><strong>ZKFC</strong>：ZooKeeper故障检测器，监控NameNode健康状态</li>
</ul>
<h4 id="故障转移流程"><a href="#故障转移流程" class="headerlink" title="故障转移流程"></a>故障转移流程</h4><ol>
<li>ZKFC定期向NameNode发送健康检查</li>
<li>Active节点故障时，ZKFC释放ZooKeeper锁</li>
<li>Standby节点的ZKFC获取锁，通过 fencing 机制确保Active节点完全下线</li>
<li>Standby节点升级为Active，开始处理客户端请求</li>
</ol>
<pre class="mermaid">graph TD
    Client[客户端] -->|自动路由| AN[Active NameNode]
    Client -->|故障时切换| SN[Standby NameNode]
    AN -->|写入EditLog| JN[JournalNodes集群
(>=3节点)]
    SN -->|读取EditLog| JN
    AN --> ZKFC1[ZKFC]
    SN --> ZKFC2[ZKFC]
    ZKFC1 & ZKFC2 --> ZK[ZooKeeper
选举与健康监控]
    AN -->|隔离机制| Fencing[Fencing
防止脑裂]
    SN -->|接管服务| Fencing</pre>

<h3 id="8-3-纠删码（Erasure-Coding）"><a href="#8-3-纠删码（Erasure-Coding）" class="headerlink" title="8.3 纠删码（Erasure Coding）"></a>8.3 纠删码（Erasure Coding）</h3><p>Hadoop 3.0引入纠删码机制，在提供同等容错能力的同时大幅降低存储开销，适用于冷数据存储。</p>
<h4 id="实现原理"><a href="#实现原理" class="headerlink" title="实现原理"></a>实现原理</h4><ul>
<li>使用Reed-Solomon码：将n个数据块编码为m个校验块，任意n个块可恢复原始数据</li>
<li>默认配置(6,3)：6个数据块+3个校验块，相比3副本节省50%存储空间</li>
<li>支持按目录配置：通过<code>dfs.namenode.ec.system.default.policy</code>设置默认策略</li>
</ul>
<h4 id="优缺点对比"><a href="#优缺点对比" class="headerlink" title="优缺点对比"></a>优缺点对比</h4><table>
<thead>
<tr>
<th>特性</th>
<th>纠删码(6,3)</th>
<th>3副本机制</th>
</tr>
</thead>
<tbody><tr>
<td>存储开销</td>
<td>150%</td>
<td>200%</td>
</tr>
<tr>
<td>容错能力</td>
<td>最多3个块丢失</td>
<td>最多2个副本丢失</td>
</tr>
<tr>
<td>读写性能</td>
<td>写性能较低，读性能接近</td>
<td>读写性能均衡</td>
</tr>
<tr>
<td>适用场景</td>
<td>冷数据、归档数据</td>
<td>热数据、频繁访问数据</td>
</tr>
</tbody></table>
<h3 id="8-4-HDFS缓存机制"><a href="#8-4-HDFS缓存机制" class="headerlink" title="8.4 HDFS缓存机制"></a>8.4 HDFS缓存机制</h3><p>HDFS提供集中式缓存管理，允许将频繁访问的数据块缓存在指定DataNode的内存中，提高读取性能。</p>
<h4 id="核心概念"><a href="#核心概念" class="headerlink" title="核心概念"></a>核心概念</h4><ul>
<li><strong>缓存池（Cache Pool）</strong>：管理员创建的资源分配单元，包含缓存空间配额和权限控制</li>
<li><strong>缓存指令（Cache Directive）</strong>：指定要缓存的路径和缓存副本数</li>
<li><strong>缓存块（Cached Block）</strong>：被缓存的数据块，保留在DataNode内存中</li>
</ul>
<h4 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h4><ol>
<li>管理员创建缓存池并分配资源</li>
<li>用户提交缓存指令指定要缓存的文件&#x2F;目录</li>
<li>NameNode选择合适的DataNode缓存数据块</li>
<li>DataNode将数据块加载到内存并向NameNode确认</li>
<li>客户端读取时优先选择缓存副本</li>
</ol>
<h3 id="8-5-HDFS安全机制"><a href="#8-5-HDFS安全机制" class="headerlink" title="8.5 HDFS安全机制"></a>8.5 HDFS安全机制</h3><h4 id="8-5-1-身份认证"><a href="#8-5-1-身份认证" class="headerlink" title="8.5.1 身份认证"></a>8.5.1 身份认证</h4><ul>
<li><strong>Kerberos认证</strong>：HDFS默认的强认证机制，通过票据验证用户身份</li>
<li><strong>简单认证</strong>：适用于测试环境，基于主机名或用户名的信任机制</li>
<li><strong>Delegation Tokens</strong>：允许应用程序代表用户访问HDFS，避免重复认证</li>
</ul>
<h4 id="8-5-2-授权控制"><a href="#8-5-2-授权控制" class="headerlink" title="8.5.2 授权控制"></a>8.5.2 授权控制</h4><ul>
<li><strong>POSIX风格权限</strong>：基于用户、组和其他用户的读&#x2F;写&#x2F;执行权限</li>
<li><strong>ACL（访问控制列表）</strong>：更细粒度的权限控制，支持为特定用户&#x2F;组设置权限</li>
<li><strong>NameNode权限检查</strong>：所有元数据操作需通过权限验证</li>
<li><strong>DataNode权限检查</strong>：数据块访问需验证块所有权</li>
</ul>
<h4 id="8-5-3-数据保护"><a href="#8-5-3-数据保护" class="headerlink" title="8.5.3 数据保护"></a>8.5.3 数据保护</h4><ul>
<li><strong>传输加密</strong>：使用SSL&#x2F;TLS加密节点间数据传输</li>
<li><strong>存储加密</strong>：透明数据加密（TDE）保护磁盘上的数据</li>
<li><strong>数据脱敏</strong>：通过HDFS加密区（Encryption Zones）实现敏感数据隔离</li>
</ul>
<h2 id="九、HDFS性能优化"><a href="#九、HDFS性能优化" class="headerlink" title="九、HDFS性能优化"></a>九、HDFS性能优化</h2><h3 id="9-1-关键配置优化"><a href="#9-1-关键配置优化" class="headerlink" title="9.1 关键配置优化"></a>9.1 关键配置优化</h3><h4 id="NameNode优化"><a href="#NameNode优化" class="headerlink" title="NameNode优化"></a>NameNode优化</h4><ul>
<li><code>dfs.namenode.handler.count</code>：处理RPC请求的线程数，建议设置为集群规模的2-4倍</li>
<li><code>dfs.namenode.fs-limits.max-directory-items</code>：单个目录最大文件数，默认1048576</li>
<li><code>dfs.namenode.name.dir</code>：配置多个存储目录（最好包含SSD）提高元数据可靠性</li>
</ul>
<h4 id="DataNode优化"><a href="#DataNode优化" class="headerlink" title="DataNode优化"></a>DataNode优化</h4><ul>
<li><code>dfs.datanode.handler.count</code>：DataNode处理RPC的线程数，建议10-20</li>
<li><code>dfs.datanode.max.transfer.threads</code>：数据传输线程数，建议4096</li>
<li><code>dfs.datanode.balance.bandwidthPerSec</code>：平衡数据时的带宽限制，默认1048576（1MB&#x2F;s）</li>
</ul>
<h4 id="客户端优化"><a href="#客户端优化" class="headerlink" title="客户端优化"></a>客户端优化</h4><ul>
<li><code>dfs.client.read.shortcircuit</code>：启用短路读取，绕过DataNode直接读取本地数据</li>
<li><code>dfs.client.block.write.replace-datanode-on-failure.policy</code>：写入失败时替换DataNode策略</li>
<li><code>io.file.buffer.size</code>：文件缓冲区大小，建议64KB-128KB</li>
</ul>
<h3 id="9-2-块大小与副本策略优化"><a href="#9-2-块大小与副本策略优化" class="headerlink" title="9.2 块大小与副本策略优化"></a>9.2 块大小与副本策略优化</h3><h4 id="块大小选择"><a href="#块大小选择" class="headerlink" title="块大小选择"></a>块大小选择</h4><ul>
<li>大文件（如日志、视频）：256MB-512MB，减少块数量和元数据开销</li>
<li>小文件（如文档、图片）：64MB，提高并行处理效率</li>
<li>计算密集型作业：较小块大小，增加并行度</li>
<li>IO密集型作业：较大块大小，减少寻址开销</li>
</ul>
<h4 id="副本策略调整"><a href="#副本策略调整" class="headerlink" title="副本策略调整"></a>副本策略调整</h4><ul>
<li>热数据：3-5个副本，提高可用性</li>
<li>温数据：2-3个副本，平衡可用性和存储成本</li>
<li>冷数据：1个副本+纠删码，降低存储成本</li>
<li>本地性优化：根据计算节点位置调整副本分布</li>
</ul>
<h3 id="9-3-小文件问题解决方案"><a href="#9-3-小文件问题解决方案" class="headerlink" title="9.3 小文件问题解决方案"></a>9.3 小文件问题解决方案</h3><p>HDFS对大量小文件处理效率低下，可通过以下方案优化：</p>
<h4 id="合并小文件"><a href="#合并小文件" class="headerlink" title="合并小文件"></a>合并小文件</h4><ul>
<li>使用Hadoop Archive（HAR）将多个小文件打包成一个归档文件</li>
<li>应用层预处理，合并小文件后写入HDFS</li>
</ul>
<h4 id="联邦与命名空间隔离"><a href="#联邦与命名空间隔离" class="headerlink" title="联邦与命名空间隔离"></a>联邦与命名空间隔离</h4><ul>
<li>将不同类型小文件分布到不同命名空间</li>
<li>减轻单个NameNode的内存压力</li>
</ul>
<h4 id="缓存小文件元数据"><a href="#缓存小文件元数据" class="headerlink" title="缓存小文件元数据"></a>缓存小文件元数据</h4><ul>
<li>配置<code>dfs.namenode.metacache.size</code>增加元数据缓存</li>
<li>减少NameNode磁盘IO</li>
</ul>
<h2 id="十、总结"><a href="#十、总结" class="headerlink" title="十、总结"></a>十、总结</h2><p>HDFS通过精心设计的分布式架构、副本机制和数据校验等技术，在大规模集群环境下提供了高吞吐量和高可靠性的数据存储服务。其核心设计思想是通过牺牲部分硬件成本和延迟，换取系统的可扩展性和容错性，非常适合存储海量数据并进行批处理分析。</p>
<p>理解HDFS的内部工作原理，对于优化大数据处理性能、保障数据安全以及解决实际生产环境中的问题具有重要意义。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">XR</div><div class="post-copyright__author_desc">一片叶、一朵云</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2023/11/15/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2023/11/15/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/')">HDFS技术详解：架构、存储与数据安全机制</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2023/11/15/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=HDFS技术详解：架构、存储与数据安全机制&amp;url=http://example.com/2023/11/15/HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6/&amp;pic=" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">凌霄的博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>分布式存储<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/HDFS/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>HDFS<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625095124143.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="next-post pull-full"><a href="/2023/11/16/Spark%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%A0%B8%E5%BF%83%E5%8E%9F%E7%90%86%E3%80%81%E6%9E%B6%E6%9E%84%E4%B8%8E%E9%AB%98%E7%BA%A7%E5%AE%9E%E8%B7%B5/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spark技术详解：核心原理、架构与高级实践</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/16/minio-learning-guide/" title="MinIO 学习指南"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/09c33b5dbe1bd3fec63ad2e4128b55b6.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-16</div><div class="title">MinIO 学习指南</div></div></a></div><div><a href="/2025/06/18/hadoop-ecosystem-explained/" title="Hadoop生态：YARN、HDFS、Hive、Spark、HBase是如何协同工作的？"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250619194740317.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-18</div><div class="title">Hadoop生态：YARN、HDFS、Hive、Spark、HBase是如何协同工作的？</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">XR</h1><div class="author-info__desc">一片叶、一朵云</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/kongxiaoran" target="_blank" title="Github"></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HDFS%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E6%9E%B6%E6%9E%84%E3%80%81%E5%AD%98%E5%82%A8%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">1.</span> <span class="toc-text">HDFS技术详解：架构、存储与数据安全机制</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81%E6%95%B4%E4%BD%93%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.</span> <span class="toc-text">一、整体架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 核心组件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E6%9E%B6%E6%9E%84%E5%9B%BE"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 架构图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81%E6%96%87%E4%BB%B6%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">二、文件存储结构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E6%95%B0%E6%8D%AE%E5%9D%97%EF%BC%88Block%EF%BC%89"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 数据块（Block）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%89%AF%E6%9C%AC%E6%94%BE%E7%BD%AE%E7%AD%96%E7%95%A5"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 副本放置策略</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%84%E5%9B%BE"><span class="toc-number">1.2.3.</span> <span class="toc-text">2.3 存储结构图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B"><span class="toc-number">1.3.</span> <span class="toc-text">三、数据模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 命名空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 元数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-%E6%95%B0%E6%8D%AE%E6%A8%A1%E5%9E%8B%E7%89%B9%E7%82%B9"><span class="toc-number">1.3.3.</span> <span class="toc-text">3.3 数据模型特点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E5%86%99%E5%85%A5%E6%B5%81%E7%A8%8B"><span class="toc-number">1.4.</span> <span class="toc-text">四、数据写入流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 详细步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%86%99%E5%85%A5%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 写入流程图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E8%AF%BB%E5%8F%96%E6%B5%81%E7%A8%8B"><span class="toc-number">1.5.</span> <span class="toc-text">五、数据读取流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E8%AF%A6%E7%BB%86%E6%AD%A5%E9%AA%A4"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 详细步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E8%AF%BB%E5%8F%96%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 读取流程图</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%95%B0%E6%8D%AE%E9%98%B2%E4%B8%A2%E5%A4%B1%E6%9C%BA%E5%88%B6"><span class="toc-number">1.6.</span> <span class="toc-text">六、数据防丢失机制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E5%89%AF%E6%9C%AC%E6%9C%BA%E5%88%B6"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 副本机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E5%BF%83%E8%B7%B3%E6%A3%80%E6%B5%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 心跳检测</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E6%95%B0%E6%8D%AE%E5%AE%8C%E6%95%B4%E6%80%A7%E6%A0%A1%E9%AA%8C"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 数据完整性校验</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-%E5%AE%89%E5%85%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 安全模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-5-%E5%85%83%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD"><span class="toc-number">1.6.5.</span> <span class="toc-text">6.5 元数据备份</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E7%A3%81%E7%9B%98%E6%8D%9F%E5%9D%8F%E5%BA%94%E5%AF%B9%E6%8E%AA%E6%96%BD"><span class="toc-number">1.7.</span> <span class="toc-text">七、磁盘损坏应对措施</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E5%9D%8F%E5%9D%97%E6%A3%80%E6%B5%8B%E4%B8%8E%E5%A4%84%E7%90%86"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 坏块检测与处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%95%B0%E6%8D%AE%E5%9D%87%E8%A1%A1"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 数据均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E8%8A%82%E7%82%B9%E9%80%80%E5%BD%B9"><span class="toc-number">1.7.3.</span> <span class="toc-text">7.3 节点退役</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E7%81%BE%E9%9A%BE%E6%81%A2%E5%A4%8D"><span class="toc-number">1.7.4.</span> <span class="toc-text">7.4 灾难恢复</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81HDFS%E9%AB%98%E7%BA%A7%E7%89%B9%E6%80%A7%E4%B8%8E%E4%BC%98%E5%8C%96"><span class="toc-number">1.8.</span> <span class="toc-text">八、HDFS高级特性与优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-HDFS%E8%81%94%E9%82%A6%EF%BC%88Federation%EF%BC%89"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1 HDFS联邦（Federation）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">核心组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%B6%E6%9E%84%E4%BC%98%E5%8A%BF"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">架构优势</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-HDFS%E9%AB%98%E5%8F%AF%E7%94%A8%EF%BC%88HA%EF%BC%89%E5%AE%9E%E7%8E%B0"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2 HDFS高可用（HA）实现</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6-1"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">核心组件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB%E6%B5%81%E7%A8%8B"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">故障转移流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E7%BA%A0%E5%88%A0%E7%A0%81%EF%BC%88Erasure-Coding%EF%BC%89"><span class="toc-number">1.8.3.</span> <span class="toc-text">8.3 纠删码（Erasure Coding）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.8.3.1.</span> <span class="toc-text">实现原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E7%BC%BA%E7%82%B9%E5%AF%B9%E6%AF%94"><span class="toc-number">1.8.3.2.</span> <span class="toc-text">优缺点对比</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-4-HDFS%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">1.8.4.</span> <span class="toc-text">8.4 HDFS缓存机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.8.4.1.</span> <span class="toc-text">核心概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.8.4.2.</span> <span class="toc-text">工作流程</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-5-HDFS%E5%AE%89%E5%85%A8%E6%9C%BA%E5%88%B6"><span class="toc-number">1.8.5.</span> <span class="toc-text">8.5 HDFS安全机制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-1-%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81"><span class="toc-number">1.8.5.1.</span> <span class="toc-text">8.5.1 身份认证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-2-%E6%8E%88%E6%9D%83%E6%8E%A7%E5%88%B6"><span class="toc-number">1.8.5.2.</span> <span class="toc-text">8.5.2 授权控制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-5-3-%E6%95%B0%E6%8D%AE%E4%BF%9D%E6%8A%A4"><span class="toc-number">1.8.5.3.</span> <span class="toc-text">8.5.3 数据保护</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81HDFS%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.</span> <span class="toc-text">九、HDFS性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E5%85%B3%E9%94%AE%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.1.</span> <span class="toc-text">9.1 关键配置优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NameNode%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.1.1.</span> <span class="toc-text">NameNode优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#DataNode%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.1.2.</span> <span class="toc-text">DataNode优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.1.3.</span> <span class="toc-text">客户端优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E5%9D%97%E5%A4%A7%E5%B0%8F%E4%B8%8E%E5%89%AF%E6%9C%AC%E7%AD%96%E7%95%A5%E4%BC%98%E5%8C%96"><span class="toc-number">1.9.2.</span> <span class="toc-text">9.2 块大小与副本策略优化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%97%E5%A4%A7%E5%B0%8F%E9%80%89%E6%8B%A9"><span class="toc-number">1.9.2.1.</span> <span class="toc-text">块大小选择</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%AF%E6%9C%AC%E7%AD%96%E7%95%A5%E8%B0%83%E6%95%B4"><span class="toc-number">1.9.2.2.</span> <span class="toc-text">副本策略调整</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E5%B0%8F%E6%96%87%E4%BB%B6%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-number">1.9.3.</span> <span class="toc-text">9.3 小文件问题解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%88%E5%B9%B6%E5%B0%8F%E6%96%87%E4%BB%B6"><span class="toc-number">1.9.3.1.</span> <span class="toc-text">合并小文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%81%94%E9%82%A6%E4%B8%8E%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E9%9A%94%E7%A6%BB"><span class="toc-number">1.9.3.2.</span> <span class="toc-text">联邦与命名空间隔离</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%93%E5%AD%98%E5%B0%8F%E6%96%87%E4%BB%B6%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">1.9.3.3.</span> <span class="toc-text">缓存小文件元数据</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81%E6%80%BB%E7%BB%93"><span class="toc-number">1.10.</span> <span class="toc-text">十、总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/06/24/confidential_computing_overview/" title="从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625095124143.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈"/></a><div class="content"><a class="title" href="/2025/06/24/confidential_computing_overview/" title="从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈">从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈</a><time datetime="2025-06-23T16:00:00.000Z" title="发表于 2025-06-24 00:00:00">2025-06-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/24/redo%20log%E3%80%81undo%20log%20%E5%A6%82%E4%BD%95%E4%BF%9D%E9%9A%9C%20InnoDB%20%E4%BA%8B%E5%8A%A1/" title="谁来保证InnoDB的原子性、一致性与持久性的？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250607204936123.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谁来保证InnoDB的原子性、一致性与持久性的？"/></a><div class="content"><a class="title" href="/2025/06/24/redo%20log%E3%80%81undo%20log%20%E5%A6%82%E4%BD%95%E4%BF%9D%E9%9A%9C%20InnoDB%20%E4%BA%8B%E5%8A%A1/" title="谁来保证InnoDB的原子性、一致性与持久性的？">谁来保证InnoDB的原子性、一致性与持久性的？</a><time datetime="2025-06-23T16:00:00.000Z" title="发表于 2025-06-24 00:00:00">2025-06-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/23/Kubernetes%E5%88%86%E4%BA%AB/" title="Kubernetes笔记【历史学习文档】"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250623235029260.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes笔记【历史学习文档】"/></a><div class="content"><a class="title" href="/2025/06/23/Kubernetes%E5%88%86%E4%BA%AB/" title="Kubernetes笔记【历史学习文档】">Kubernetes笔记【历史学习文档】</a><time datetime="2025-06-23T14:00:00.000Z" title="发表于 2025-06-23 22:00:00">2025-06-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/22/Argon2%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/" title="Argon2密码哈希算法深度解析：原理、实现与实战应用"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250624000019253.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Argon2密码哈希算法深度解析：原理、实现与实战应用"/></a><div class="content"><a class="title" href="/2025/06/22/Argon2%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E5%8E%9F%E7%90%86%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8/" title="Argon2密码哈希算法深度解析：原理、实现与实战应用">Argon2密码哈希算法深度解析：原理、实现与实战应用</a><time datetime="2025-06-22T15:00:00.000Z" title="发表于 2025-06-22 23:00:00">2025-06-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/22/synchronized%E7%9B%91%E8%A7%86%E5%99%A8%E4%B8%8E%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81/" title="Java监视器有等待队列，为什么synchronized还是非公平锁？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618110852735.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java监视器有等待队列，为什么synchronized还是非公平锁？"/></a><div class="content"><a class="title" href="/2025/06/22/synchronized%E7%9B%91%E8%A7%86%E5%99%A8%E4%B8%8E%E9%9D%9E%E5%85%AC%E5%B9%B3%E9%94%81/" title="Java监视器有等待队列，为什么synchronized还是非公平锁？">Java监视器有等待队列，为什么synchronized还是非公平锁？</a><time datetime="2025-06-22T13:00:00.000Z" title="发表于 2025-06-22 21:00:00">2025-06-22</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="XR" target="_blank">XR</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">31</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">5</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 0.88rem;">Argon2<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 0.88rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 0.88rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 0.88rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>5</sup></a><a href="/tags/Kubernetes/" style="font-size: 0.88rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 0.88rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 0.88rem;">NAT<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 0.88rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 0.88rem;">SGX<sup>1</sup></a><a href="/tags/Spark/" style="font-size: 0.88rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 0.88rem;">TDX<sup>1</sup></a><a href="/tags/TEE/" style="font-size: 0.88rem;">TEE<sup>1</sup></a><a href="/tags/TME/" style="font-size: 0.88rem;">TME<sup>1</sup></a><a href="/tags/YARN/" style="font-size: 0.88rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 0.88rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 0.88rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">隐私计算<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/26/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 XR 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
      appKey: 'MR93sqmbPdh7Zm1bZzjXNvlm',
      avatar: 'mp',
      serverURLs: 'https://cbsqtaqs.api.lncldglobal.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://cbsqtaqs.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
        "X-LC-Key": 'MR93sqmbPdh7Zm1bZzjXNvlm',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>