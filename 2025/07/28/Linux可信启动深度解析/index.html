<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Linux可信启动深度解析：从UEFI到操作系统的完整信任链 | 凌霄的博客</title><meta name="keywords" content="Linux,可信启动,TPM,UEFI,GRUB,安全启动"><meta name="author" content="XR"><meta name="copyright" content="XR"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Linux可信启动深度解析：从UEFI到操作系统的完整信任链"><meta name="application-name" content="Linux可信启动深度解析：从UEFI到操作系统的完整信任链"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Linux可信启动深度解析：从UEFI到操作系统的完整信任链"><meta property="og:url" content="http://example.com/2025/07/28/Linux%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/index.html"><meta property="og:site_name" content="凌霄的博客"><meta property="og:description" content="深入解析Linux可信启动的完整技术栈，从UEFI固件到GRUB引导加载程序，再到Linux内核IMA机制，全面剖析静态信任根(SRTM)的实现原理与安全机制"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250801162921072.png"><meta property="article:author" content="XR"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250801162921072.png"><meta name="description" content="深入解析Linux可信启动的完整技术栈，从UEFI固件到GRUB引导加载程序，再到Linux内核IMA机制，全面剖析静态信任根(SRTM)的实现原理与安全机制"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/07/28/Linux%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: XR","link":"链接: ","source":"来源: 凌霄的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '凌霄的博客',
  title: 'Linux可信启动深度解析：从UEFI到操作系统的完整信任链',
  postAI: '',
  pageFillDescription: 'Linux 可信启动深度解析：从UEFI到操作系统的信任链, 引言, 一、 可信根基：TPM与核心概念, 1.1 什么是度量 (Measurement)？, 1.2 信任链与TPM PCR, 二、 阶段一：固件的可信启动 (UEFI), 2.1 引导的起点：从SEC到DXE的初始化, 2.2 引导设备选择 (BDS)：UEFI如何找到GRUB, 2.3 Secure Boot与度量：信任的第一次传递, 2.4 SEC阶段如何与TPM交互？, 三、 阶段二：引导加载程序的接力 (GRUB 2), 3.1 GRUB自我唤醒并延续信任链, 3.2 控制权的第二次交接 (GRUB -gt Kernel), 四、 阶段三：内核的全面守护 (IMA), 4.1 IMA简介：将信任扩展到整个文件系统, 4.2 IMA-Measure：运行时度量, 4.3 IMA-Appraise：运行时强制访问控制, 五、 总结：一条完整的静态信任根 (SRTM) 链可信启动深度解析从到操作系统的信任链引言在探讨了解学习虚拟化的安全方案如时我们经常会遇到动态信任根的概念但的有效性又依赖于一个稳固的静态信任根这条信任链构成了整个平台可信度的基石本文档的目的就是完整地系统性地梳理这条信任链我们将从上电的瞬间开始一路追踪信任的接力棒是如何从固件传递给引导加载程序并最终由内核接管将其延伸至每一个运行中的应用程序一可信根基与核心概念在深入流程之前必须先对齐几个贯穿始终的核心概念什么是度量在可信计算的语境里度量就是一个动作对一段数据比如一个文件或一段代码计算其密码学哈希值如这个哈希值就像是这段数据的数字指纹任何微小的改动都会导致指纹发生天翻地覆的变化这个动作本身不提供安全它只是提供了一种可验证的唯一的身份标识信任链与信任链的思想很简单信任是需要传递的就像接力赛第一棒运动员信任的根源必须是可信的然后他把接力棒控制权交给第二棒时必须先保证第二棒也是可信的可信平台模块就是这个过程中的公证员和记事本它内部有一组特殊的寄存器叫平台配置寄存器有一个独一无二的特性你不能直接写入一个值你只能对它执行扩展操作操作的本质是这个特性使得成为了一个完美的防篡改的启动日志任何对启动流程的偏离都会在这本只能追加不能修改的日志上留下清晰的痕迹二阶段一固件的可信启动信任链的源头始于上电后运行的第一行代码固件它的启动过程并非一个单一步骤而是遵循业界标准如的一个分阶段的初始化序列引导的起点从到的初始化的启动可以大致分为几个关键阶段每一步都为下一步构建基础上电度量代码度量核心引导加载程序可用图启动阶段总览安全阶段这是在加电后执行的第一段代码通常由处理器的微码和固件中的一小段汇编代码组成是平台的静态信任根度量的起点也被称为核心信任根度量它的核心任务非常单纯建立一个临时的运行环境通常是使用的缓存作为临时内存并找到验证启动下一阶段作为信任链的第一环它会度量阶段的代码并将结果到中前期初始化阶段的主要职责是初始化主内存一旦可用后续的复杂任务才有了运行空间它会进行最核心的平台硬件发现如芯片组并将这些信息组织成一个交接清单传递给下一阶段在交接前它会度量阶段的核心代码并继续到驱动执行环境阶段这是的主舞台阶段的核心是一个分发器它会根据依赖关系循环加载和执行一系列的驱动完成对平台上几乎所有硬件的初始化在这个阶段各种服务和协议被创建和发布比如文件系统服务块设备服务以及我们可信启动所依赖的服务协议所有被加载的驱动也都会被度量并继续到到阶段结束时系统已经是一个功能完备的小型操作系统引导设备选择如何找到阶段完成后控制权交给阶段这本质上就是我们熟知的启动管理器在执行引导加载程序之前自身也会被度量到中至此完整地记录了整个固件的启动链条读取启动变量会读取主板上非易失性存储器中存储的启动变量最重要的变量是它定义了启动项的尝试顺序如每一个启动项如都是一个详细的记录它包含了设备路径指向一个具体的物理设备如某一块硬盘的某个分区文件路径指向该设备上要执行的应用程序的路径描述一个用户可见的字符串如或定位会按照的顺序尝试加载第一个启动项例如对于它会根据设备路径找到分区一个标准的分区然后在这个分区上根据文件路径找到的核心镜像例如备用路径如果所有中的启动项都失败了或者为空会尝试一个标准的备用路径与度量信任的第一次传递在最终决定要执行某个应用程序如的那一刻和度量机制会介入完成信任的第一次传递验证在执行之前会用其内置的签名数据库中的公钥去验证这个文件的数字签名同时它会检查这个文件的签名哈希是否位于禁止签名数据库的黑名单中只有签名有效且不在黑名单中程序才被允许执行第一环度量在验证签名的同时固件也扮演了第一个度量者的角色它会度量启动过程中加载的关键组件并将哈希值扩展到中度量固件自身的核心代码启动设置等度量加载的第三方驱动或扩展度量被选中的引导加载程序如的完整镜像度量的策略和密钥状态交接控制权至此在将控制权交给之前已经完成了两件大事通过签名验证了的身份合法性并通过度量记录下了的数字指纹然后它才会真正跳转到的入口点开始执行阶段如何与交互一个关键问题是在阶段主内存都尚未初始化系统环境极其简陋它怎么可能有的驱动来操作寄存器呢答案是它没有现代意义上的驱动它拥有的是更底层的固化在自身代码中的直接操作能力的特殊身份阶段执行的代码即核心信任根度量不是一个通用的程序它是由芯片或主板制造商编写的高度特权化平台专属的一小段代码它被认为是隐式可信的是信任的绝对源头硬编码的通信能力的代码直接包含了与芯片进行最低级别通信所需要的所有指令它知道要通过哪个总线如或总线向哪个具体的端口或内存映射地址发送什么样字节序列来命令执行扩展这个动作这个最原始的驱动被硬编码在了内部设计的安全性正因为它不依赖任何外部加载的驱动所以它的行为是确定的不受外部环境影响的这恰恰是作为信任根所必需的三阶段二引导加载程序的接力现在信任链的接力棒传递到了手中自我唤醒并延续信任链的核心镜像已经在内存中运行但它非常小功能有限它需要找到自己的大部队配置文件和各种模块的自我定位与配置加载现在是醒着的它会启用自己内置的微型的文件系统驱动例如可能已经嵌入中更重要的是它会加载更强大的文件系统驱动如它根据安装时配置的前缀信息去另一个分区通常是的分区格式为等下的目录中寻找并读取它的施工图纸文件这个文件包含了所有启动菜单项和要执行的命令解析配置并度量开始逐行解析当它遇到一个被选择的启动项时它会严格按照里面的命令执行一个用于可信启动的配置片段可能如下动态加载模块让具备与交互的能力加载内核加载后命令会自动触发度量行为加载同样会被度量度量本身会度量它解析的这些命令文本并将结果扩展到中如以确保配置本身未被篡改度量内核当执行命令时首先将文件完整读入内存对其内容进行哈希计算度量然后通过将哈希值到指定的寄存器中通常也是或度量同样命令也会触发对的度量并将哈希值扩展到中硬盘内核文件内存中核心哈希计算引擎模块硬件芯片读取文件至内存对内存中的数据进行哈希准备哈希值请求扩展图度量内核的详细流程控制权的第二次交接完成所有度量后将的控制权正式交给内核的入口点信任链的接力棒至此成功传递给了操作系统四阶段三内核的全面守护当内核开始运行时信任链并没有结束而是进入了一个更精细更持续的阶段内核通过完整性度量架构来接管度量的职责简介将信任扩展到整个文件系统的目标是将信任链从启动阶段的几个关键文件延伸到系统运行过程中访问的每一个文件包括应用程序配置文件库文件等运行时度量这是最基础的功能它的工作流程如下用户应用程序内核执行系统调用执行前触发读取文件内容计算文件哈希值将哈希值到扩展成功度量完成允许执行继续执行程序图度量流程钩子在内核的关键路径如文件打开执行内存映射上设置了钩子度量每当有文件要被访问或执行时钩子被触发子系统会先计算该文件的哈希值扩展计算出的哈希值被扩展到专用的寄存器记录日志同时会将这次度量的详细信息文件名哈希值记录在内存中的一个日志里该日志可以通过查看通过这个机制任何在系统运行时被加载的文件都会留下指纹确保了系统的动态可审计性运行时强制访问控制是的进阶功能它不仅度量还会进行强制性的验证系统会预先为所有可信文件计算哈希并将这些哈希值作为扩展属性存储在文件元数据中并进行签名当启用时每次文件被度量后会检查文件是否有属性验证属性中的哈希签名是否有效比较实时计算的哈希值与属性中存储的黄金哈希值是否一致只有三者全部通过才允许访问否则直接拒绝这将可信启动从一个只记录不阻止的模型变成了一个主动防御的强制访问控制系统五总结一条完整的静态信任根链综上所述一条完整的静态信任根链条是一个分工明确层层递进的接力过程阶段负责组件核心动作主要度量目标主要影响的阶段一固件验证度量固件代码扩展引导加载程序阶段二解析配置度量命令内核阶段三内核关键路径度量应用程序库配置文件等从硬件上电到每一个应用被执行每一步的控制权交接都伴随着验证与度量确保了信任从一个绝对可信的硬件根一路传递到运行中的整个操作系统最终形成了一个坚实可审计可验证的安全基础',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-08-01 16:31:47',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">凌霄的博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 1.05rem;">Argon2<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 1.05rem;">DNS<sup>2</sup></a><a href="/tags/HBase/" style="font-size: 1.05rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 1.05rem;">HDFS<sup>4</sup></a><a href="/tags/HTTP/" style="font-size: 1.05rem;">HTTP<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>4</sup></a><a href="/tags/Hive/" style="font-size: 1.05rem;">Hive<sup>1</sup></a><a href="/tags/HyperEnclave/" style="font-size: 1.05rem;">HyperEnclave<sup>5</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>8</sup></a><a href="/tags/Kubernetes/" style="font-size: 1.05rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>5</sup></a><a href="/tags/Maven/" style="font-size: 1.05rem;">Maven<sup>1</sup></a><a href="/tags/RDD/" style="font-size: 1.05rem;">RDD<sup>2</sup></a><a href="/tags/SGX/" style="font-size: 1.05rem;">SGX<sup>2</sup></a><a href="/tags/Shuffle%E6%9C%BA%E5%88%B6/" style="font-size: 1.05rem;">Shuffle机制<sup>1</sup></a><a href="/tags/Spark/" style="font-size: 1.05rem;">Spark<sup>10</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>3</sup></a><a href="/tags/TDX/" style="font-size: 1.05rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 1.05rem;">TEE<sup>9</sup></a><a href="/tags/TME/" style="font-size: 1.05rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 1.05rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 1.05rem;">代理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">分布式计算<sup>3</sup></a><a href="/tags/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E9%99%90%E5%88%B6/" style="font-size: 1.05rem;">地理位置限制<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>6</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" style="font-size: 1.05rem;">学习路线<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 1.05rem;">密码学<sup>5</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF%E4%B8%93%E6%A0%8F/" style="font-size: 1.05rem;">技术专栏<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%AF%86%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">机密计算<sup>2</sup></a><a href="/tags/%E6%B5%81%E5%AA%92%E4%BD%93%E8%A7%A3%E9%94%81/" style="font-size: 1.05rem;">流媒体解锁<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90/" style="font-size: 1.05rem;">网络分析<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">网络安全<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">隐私计算<sup>3</sup></a><a href="/tags/%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/" style="font-size: 1.05rem;">集群架构<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">17</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">32</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" itemprop="url">隐私计算</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>可信启动</span></a><a class="article-meta__tags" href="/tags/TPM/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>TPM</span></a><a class="article-meta__tags" href="/tags/UEFI/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>UEFI</span></a><a class="article-meta__tags" href="/tags/GRUB/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>GRUB</span></a><a class="article-meta__tags" href="/tags/%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>安全启动</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Linux可信启动深度解析：从UEFI到操作系统的完整信任链</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-07-28T12:00:00.000Z" title="发表于 2025-07-28 20:00:00">2025-07-28</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-08-01T08:31:47.192Z" title="更新于 2025-08-01 16:31:47">2025-08-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Linux可信启动深度解析：从UEFI到操作系统的完整信任链"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为杭州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250801162921072.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/07/28/Linux%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/"><header><a class="post-meta-categories" href="/categories/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" itemprop="url">隐私计算</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8/" tabindex="-1" itemprop="url">可信启动</a><a href="/tags/TPM/" tabindex="-1" itemprop="url">TPM</a><a href="/tags/UEFI/" tabindex="-1" itemprop="url">UEFI</a><a href="/tags/GRUB/" tabindex="-1" itemprop="url">GRUB</a><a href="/tags/%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8/" tabindex="-1" itemprop="url">安全启动</a><h1 id="CrawlerTitle" itemprop="name headline">Linux可信启动深度解析：从UEFI到操作系统的完整信任链</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">XR</span><time itemprop="dateCreated datePublished" datetime="2025-07-28T12:00:00.000Z" title="发表于 2025-07-28 20:00:00">2025-07-28</time><time itemprop="dateCreated datePublished" datetime="2025-08-01T08:31:47.192Z" title="更新于 2025-08-01 16:31:47">2025-08-01</time></header><h1 id="Linux-可信启动深度解析：从UEFI到操作系统的信任链"><a href="#Linux-可信启动深度解析：从UEFI到操作系统的信任链" class="headerlink" title="Linux 可信启动深度解析：从UEFI到操作系统的信任链"></a>Linux 可信启动深度解析：从UEFI到操作系统的信任链</h1><p>[TOC]</p>
<h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在探讨了解学习虚拟化的安全方案（如HyperEnclave）时，我们经常会遇到动态信任根（DRTM）的概念。但DRTM的有效性，又依赖于一个稳固的静态信任根（Static Root of Trust for Measurement, SRTM）。这条SRTM信任链，构成了整个平台可信度的基石。</p>
<p>本文档的目的，就是完整地、系统性地梳理这条信任链。我们将从PC上电的瞬间开始，一路追踪信任的“接力棒”是如何从UEFI固件，传递给GRUB 2引导加载程序，并最终由Linux内核接管，将其延伸至每一个运行中的应用程序。</p>
<hr>
<h2 id="一、-可信根基：TPM与核心概念"><a href="#一、-可信根基：TPM与核心概念" class="headerlink" title="一、 可信根基：TPM与核心概念"></a>一、 可信根基：TPM与核心概念</h2><p>在深入流程之前，必须先对齐几个贯穿始终的核心概念。</p>
<h3 id="1-1-什么是“度量”-Measurement-？"><a href="#1-1-什么是“度量”-Measurement-？" class="headerlink" title="1.1 什么是“度量” (Measurement)？"></a>1.1 什么是“度量” (Measurement)？</h3><p>在可信计算的语境里，“度量”就是一个动作：<strong>对一段数据（比如一个文件或一段代码）计算其密码学哈希值（如SHA-256）</strong>。</p>
<p>这个哈希值就像是这段数据的“数字指纹”，任何微小的改动都会导致指纹发生天翻地覆的变化。这个动作本身不提供安全，它只是提供了一种<strong>可验证的、唯一的身份标识</strong>。</p>
<h3 id="1-2-信任链与TPM-PCR"><a href="#1-2-信任链与TPM-PCR" class="headerlink" title="1.2 信任链与TPM PCR"></a>1.2 信任链与TPM PCR</h3><p>“信任链”（Chain of Trust）的思想很简单：信任是需要传递的。就像接力赛，第一棒运动员（信任的根源）必须是可信的，然后他把接力棒（控制权）交给第二棒时，必须先保证第二棒也是可信的。</p>
<p>TPM（可信平台模块）就是这个过程中的“公证员”和“记事本”。它内部有一组特殊的寄存器，叫<strong>平台配置寄存器（Platform Configuration Registers, PCRs）</strong>。</p>
<p>PCR有一个独一无二的特性：<strong>你不能直接写入一个值，你只能对它执行<code>Extend</code>（扩展）操作。</strong></p>
<p><code>Extend</code>操作的本质是：<code>PCR_new_value = HASH(PCR_old_value || new_data_hash)</code></p>
<p>这个特性使得PCR成为了一个完美的、防篡改的启动日志。任何对启动流程的偏离，都会在这本“只能追加、不能修改”的日志上留下清晰的痕迹。</p>
<hr>
<h2 id="二、-阶段一：固件的可信启动-UEFI"><a href="#二、-阶段一：固件的可信启动-UEFI" class="headerlink" title="二、 阶段一：固件的可信启动 (UEFI)"></a>二、 阶段一：固件的可信启动 (UEFI)</h2><p>信任链的源头，始于PC上电后运行的第一行代码——UEFI固件。它的启动过程并非一个单一步骤，而是遵循业界标准（如PI-Spec）的一个分阶段的初始化序列。</p>
<h3 id="2-1-引导的起点：从SEC到DXE的初始化"><a href="#2-1-引导的起点：从SEC到DXE的初始化" class="headerlink" title="2.1 引导的起点：从SEC到DXE的初始化"></a>2.1 引导的起点：从SEC到DXE的初始化</h3><p>UEFI的启动可以大致分为几个关键阶段，每一步都为下一步构建基础。</p>
<div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  graph TD;
    A[&quot;上电&quot;] --&gt; B[&quot;SEC Phase (Security)&quot;];
    B --&gt;|度量PEI代码| C[&quot;PEI Phase (Pre-EFI Initialization)&quot;];
    C --&gt;|度量DXE核心| D[&quot;DXE Phase (Driver Execution Environment)&quot;];
    D --&gt; E[&quot;BDS Phase (Boot Device Selection)&quot;];
    E --&gt; F[&quot;OS引导加载程序 (GRUB 2)&quot;];
    
    subgraph &quot;CPU Cache as RAM&quot;
        B
    end
    subgraph &quot;DRAM可用&quot;
        C;D;E;F
    end
    
    classDef metric fill:#f9f,stroke:#333;
    class B,C metric;
  </pre></div>
<p><em>图1: UEFI 启动阶段总览</em></p>
<ol>
<li><p><strong>SEC (Security) Phase - 安全阶段</strong>:</p>
<ul>
<li>这是CPU在加电后执行的<strong>第一段代码</strong>，通常由处理器的微码和固件中的一小段汇编代码组成，是平台的<strong>静态信任根度量（Static Root of Trust for Measurement, SRTM）</strong>的起点，也被称为<strong>核心信任根度量（Core Root of Trust for Measurement, CRTM）</strong>。</li>
<li>它的核心任务非常单纯：建立一个临时的运行环境（通常是使用CPU的缓存作为临时内存），并找到、验证、启动下一阶段（PEI）。作为信任链的第一环，它会<strong>度量PEI阶段</strong>的代码，并将结果<code>Extend</code>到 <strong>PCR[0]</strong> 中。</li>
</ul>
</li>
<li><p><strong>PEI (Pre-EFI Initialization) Phase - EFI前期初始化阶段</strong>:</p>
<ul>
<li>PEI的主要职责是<strong>初始化主内存（DRAM）</strong>。一旦DRAM可用，后续的复杂任务才有了运行空间。</li>
<li>它会进行最核心的平台硬件发现（如CPU、芯片组），并将这些信息组织成一个“交接清单”（Hand-Off Block List, HOBs），传递给下一阶段。在交接前，它会<strong>度量DXE阶段</strong>的核心代码，并继续<code>Extend</code>到 **PCR[0]**。</li>
</ul>
</li>
<li><p><strong>DXE (Driver Execution Environment) Phase - 驱动执行环境阶段</strong>:</p>
<ul>
<li>这是UEFI的“主舞台”。DXE阶段的核心是一个<strong>分发器（Dispatcher）</strong>，它会根据依赖关系，循环加载和执行一系列的<strong>DXE驱动</strong>，完成对平台上几乎所有硬件的初始化。</li>
<li>在这个阶段，各种<strong>UEFI服务和协议</strong>被创建和发布，比如文件系统服务、块设备I&#x2F;O服务，以及我们可信启动所依赖的 <strong>TPM服务协议（EFI_TCG2_PROTOCOL）</strong>。所有被加载的DXE驱动，也都会被度量并继续<code>Extend</code>到 **PCR[0]**。到DXE阶段结束时，系统已经是一个功能完备的“小型操作系统”。</li>
</ul>
</li>
</ol>
<h3 id="2-2-引导设备选择-BDS-：UEFI如何找到GRUB"><a href="#2-2-引导设备选择-BDS-：UEFI如何找到GRUB" class="headerlink" title="2.2 引导设备选择 (BDS)：UEFI如何找到GRUB"></a>2.2 引导设备选择 (BDS)：UEFI如何找到GRUB</h3><p>DXE阶段完成后，控制权交给<strong>BDS（Boot Device Selection）</strong>阶段。这本质上就是我们熟知的<strong>UEFI启动管理器</strong>。在执行引导加载程序之前，BDS自身也会被度量到<code>PCR[0]</code>中，至此，<code>PCR[0]</code>完整地记录了整个固件的启动链条。</p>
<ol>
<li><p><strong>读取NVRAM启动变量</strong>:</p>
<ul>
<li>BDS会读取主板上非易失性存储器（NVRAM）中存储的启动变量。最重要的变量是 <code>BootOrder</code>，它定义了启动项的尝试顺序，如 <code>[Boot0001, Boot0002, Boot0000]</code>。</li>
<li>每一个启动项（如<code>Boot0001</code>）都是一个详细的记录，它包含了：<ul>
<li><strong>设备路径</strong>: 指向一个具体的物理设备（如某一块硬盘的某个分区）。</li>
<li><strong>文件路径</strong>: 指向该设备上要执行的EFI应用程序的路径。</li>
<li><strong>描述</strong>: 一个用户可见的字符串，如 “ubuntu” 或 “Windows Boot Manager”。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>定位GRUB</strong>:</p>
<ul>
<li>BDS会按照<code>BootOrder</code>的顺序，尝试加载第一个启动项。例如，对于<code>Boot0001</code> (“ubuntu”)，它会根据设备路径找到ESP分区（EFI System Partition，一个标准的FAT32分区），然后在这个分区上根据文件路径找到GRUB的核心镜像，例如 <code>\EFI\ubuntu\grubx64.efi</code>。</li>
<li><strong>备用路径(Fallback Path)</strong>: 如果所有<code>BootOrder</code>中的启动项都失败了，或者<code>BootOrder</code>为空，BDS会尝试一个标准的备用路径：<code>\EFI\BOOT\BOOTX64.EFI</code>。</li>
</ul>
</li>
</ol>
<h3 id="2-3-Secure-Boot与度量：信任的第一次传递"><a href="#2-3-Secure-Boot与度量：信任的第一次传递" class="headerlink" title="2.3 Secure Boot与度量：信任的第一次传递"></a>2.3 Secure Boot与度量：信任的第一次传递</h3><p>在BDS最终决定要执行某个EFI应用程序（如<code>grubx64.efi</code>）的那一刻，Secure Boot和TPM度量机制会介入，完成信任的第一次传递。</p>
<ol>
<li><p><strong>Secure Boot验证</strong>:</p>
<ul>
<li>在执行<code>grubx64.efi</code>之前，UEFI会用其内置的<strong>签名数据库（db）</strong>中的公钥，去验证这个文件的数字签名。</li>
<li>同时，它会检查这个文件的签名哈希是否位于<strong>禁止签名数据库（dbx）</strong>的黑名单中。</li>
<li>只有签名有效且不在黑名单中，程序才被允许执行。</li>
</ul>
</li>
<li><p><strong>第一环度量</strong>:</p>
<ul>
<li>在验证签名的同时，UEFI固件也扮演了<strong>第一个度量者</strong>的角色。它会度量启动过程中加载的关键组件，并将哈希值扩展到PCR中：<ul>
<li><strong>PCR[0]</strong>: 度量UEFI固件自身的核心代码、启动设置等。</li>
<li><strong>PCR[2]</strong>: 度量加载的第三方UEFI驱动或扩展ROM。</li>
<li><strong>PCR[4]</strong>: 度量被选中的引导加载程序（如<code>grubx64.efi</code>）的完整镜像。</li>
<li><strong>PCR[7]</strong>: 度量Secure Boot的策略和密钥状态。</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>交接控制权</strong>:</p>
<ul>
<li>至此，在将控制权交给GRUB之前，UEFI已经完成了两件大事：<strong>通过签名验证了GRUB的身份合法性</strong>，并<strong>通过度量记录下了GRUB的数字指纹</strong>。然后，它才会真正跳转到<code>grubx64.efi</code>的入口点开始执行。</li>
</ul>
</li>
</ol>
<h4 id="2-4-SEC阶段如何与TPM交互？"><a href="#2-4-SEC阶段如何与TPM交互？" class="headerlink" title="2.4 SEC阶段如何与TPM交互？"></a>2.4 SEC阶段如何与TPM交互？</h4><p>一个关键问题是：在SEC阶段，主内存（DRAM）都尚未初始化，系统环境极其简陋，它怎么可能有TPM的“驱动”来操作寄存器呢？</p>
<p>答案是：<strong>它没有现代意义上的“驱动”，它拥有的是更底层的、固化在自身代码中的“直接操作能力”。</strong></p>
<ul>
<li><strong>CRTM的特殊身份</strong>: SEC阶段执行的代码，即<strong>核心信任根度量（CRTM）</strong>，不是一个通用的程序。它是由芯片或主板制造商编写的、高度特权化、平台专属的一小段代码。它被认为是<strong>隐式可信的</strong>，是信任的绝对源头。</li>
<li><strong>硬编码的通信能力</strong>: CRTM的代码<strong>直接包含了与TPM芯片进行最低级别通信所需要的所有指令</strong>。它知道要通过哪个总线（如LPC或SPI总线）、向哪个具体的I&#x2F;O端口或内存映射地址（MMIO）发送什么样字节序列，来命令TPM执行“扩展PCR[0]”这个动作。这个最原始的“TPM驱动”被<strong>硬编码（Hard-coded）</strong>在了CRTM内部。</li>
<li><strong>设计的安全性</strong>: 正因为它不依赖任何外部加载的驱动，所以它的行为是确定的、不受外部环境影响的，这恰恰是作为信任根所必需的。</li>
</ul>
<hr>
<h2 id="三、-阶段二：引导加载程序的接力-GRUB-2"><a href="#三、-阶段二：引导加载程序的接力-GRUB-2" class="headerlink" title="三、 阶段二：引导加载程序的接力 (GRUB 2)"></a>三、 阶段二：引导加载程序的接力 (GRUB 2)</h2><p>现在，信任链的接力棒传递到了GRUB 2手中。</p>
<h3 id="3-1-GRUB自我唤醒并延续信任链"><a href="#3-1-GRUB自我唤醒并延续信任链" class="headerlink" title="3.1 GRUB自我唤醒并延续信任链"></a>3.1 GRUB自我唤醒并延续信任链</h3><p>GRUB 2的核心镜像（<code>core.img</code>）已经在内存中运行，但它非常小，功能有限。它需要找到自己的“大部队”——配置文件和各种模块。</p>
<ol>
<li><p><strong>GRUB的自我定位与配置加载</strong>:</p>
<ul>
<li>GRUB现在是“醒着”的。它会启用自己内置的、微型的文件系统驱动（例如<code>fat.mod</code>可能已经嵌入<code>core.img</code>中），更重要的是，它会加载更强大的文件系统驱动（如<code>ext4.mod</code>）。</li>
<li>它根据安装时配置的“前缀”（prefix）信息，去另一个分区（通常是Linux的<code>/boot</code>分区，格式为ext4等）下的<code>/grub/</code>目录中，寻找并读取它的“施工图纸”—— <strong><code>grub.cfg</code></strong> 文件。这个文件包含了所有启动菜单项和要执行的命令。</li>
</ul>
</li>
<li><p><strong>解析配置并度量</strong>:</p>
<ul>
<li>GRUB开始逐行解析<code>grub.cfg</code>。当它遇到一个被选择的<code>menuentry</code>（启动项）时，它会严格按照里面的命令执行。一个用于可信启动的配置片段可能如下：<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">menuentry &#x27;Arch Linux (Trusted Boot)&#x27; &#123;</span><br><span class="line">    # 1. 动态加载TPM模块，让GRUB具备与TPM交互的能力</span><br><span class="line">    insmod tpm</span><br><span class="line"></span><br><span class="line">    # 2. 加载Linux内核。加载tpm.mod后，</span><br><span class="line">    #    linux命令会自动触发度量行为</span><br><span class="line">    linux   /boot/vmlinuz-linux root=UUID=... ro quiet</span><br><span class="line"></span><br><span class="line">    # 3. 加载initramfs。同样，会被度量</span><br><span class="line">    initrd  /boot/initramfs-linux.img</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>度量<code>grub.cfg</code>本身</strong>: GRUB会度量它解析的这些命令文本，并将结果扩展到PCR中（如**PCR[8]**），以确保配置本身未被篡改。</li>
<li><strong>度量内核</strong>: 当执行<code>linux</code>命令时，GRUB首先将<code>/boot/vmlinuz-linux</code>文件完整读入内存，对其内容进行哈希计算（度量），然后通过<code>tpm.mod</code>将哈希值<code>Extend</code>到指定的PCR寄存器中（通常也是**PCR[8]<strong>或</strong>PCR[10]**）。</li>
<li><strong>度量initramfs</strong>: 同样，<code>initrd</code>命令也会触发对<code>/boot/initramfs-linux.img</code>的度量，并将哈希值扩展到PCR中。</li>
</ul>
</li>
</ol>
<div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  graph LR;
    subgraph &quot;硬盘 (Disk)&quot;
        A[&quot;&#x2F;boot&#x2F;vmlinuz (内核文件)&quot;];
    end

    subgraph &quot;GRUB 2 (内存中)&quot;
        C[&quot;GRUB 核心&quot;];
        D[&quot;哈希计算引擎&quot;];
        E[&quot;TPM 模块&quot;];
    end
    
    subgraph &quot;硬件 (Hardware)&quot;
        F[&quot;TPM 芯片&quot;];
    end

    A -- &quot;1. 读取文件至内存&quot; --&gt; C;
    C -- &quot;2. 对内存中的数据进行哈希&quot; --&gt; D;
    D -- &quot;3. 准备哈希值&quot; --&gt; E;
    E -- &quot;4. 请求扩展PCR&quot; --&gt; F;
    
    style A fill:#d3eafb,stroke:#333;
  </pre></div>
<p><em>图2：GRUB 2 度量内核的详细流程</em></p>
<h3 id="3-2-控制权的第二次交接-GRUB-Kernel"><a href="#3-2-控制权的第二次交接-GRUB-Kernel" class="headerlink" title="3.2 控制权的第二次交接 (GRUB -&gt; Kernel)"></a>3.2 控制权的第二次交接 (GRUB -&gt; Kernel)</h3><p>完成所有度量后，GRUB将CPU的控制权正式交给内核的入口点。信任链的接力棒，至此成功传递给了操作系统。</p>
<hr>
<h2 id="四、-阶段三：内核的全面守护-IMA"><a href="#四、-阶段三：内核的全面守护-IMA" class="headerlink" title="四、 阶段三：内核的全面守护 (IMA)"></a>四、 阶段三：内核的全面守护 (IMA)</h2><p>当内核开始运行时，信任链并没有结束，而是进入了一个更精细、更持续的阶段。Linux内核通过<strong>完整性度量架构（Integrity Measurement Architecture, IMA）</strong>来接管度量的职责。</p>
<h3 id="4-1-IMA简介：将信任扩展到整个文件系统"><a href="#4-1-IMA简介：将信任扩展到整个文件系统" class="headerlink" title="4.1 IMA简介：将信任扩展到整个文件系统"></a>4.1 IMA简介：将信任扩展到整个文件系统</h3><p>IMA的目标，是将信任链从启动阶段的几个关键文件，延伸到系统运行过程中访问的<strong>每一个文件</strong>（包括应用程序、配置文件、库文件等）。</p>
<h3 id="4-2-IMA-Measure：运行时度量"><a href="#4-2-IMA-Measure：运行时度量" class="headerlink" title="4.2 IMA-Measure：运行时度量"></a>4.2 IMA-Measure：运行时度量</h3><p>这是IMA最基础的功能。它的工作流程如下：</p>
<div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  sequenceDiagram
    participant User as 用户
    participant App as 应用程序
    participant Kernel as 内核
    participant IMA
    participant TPM

    User-&gt;&gt;App: 执行 &#x2F;usr&#x2F;bin&#x2F;cat
    App-&gt;&gt;Kernel: 系统调用: execve(&quot;&#x2F;usr&#x2F;bin&#x2F;cat&quot;)
    Kernel-&gt;&gt;IMA: (Hook) 执行前触发IMA
    activate IMA
    IMA-&gt;&gt;IMA: 读取 &#x2F;usr&#x2F;bin&#x2F;cat 文件内容
    IMA-&gt;&gt;IMA: 计算文件哈希值
    IMA-&gt;&gt;TPM: 将哈希值 Extend 到 PCR[10]
    TPM--&gt;&gt;IMA: 扩展成功
    deactivate IMA
    IMA--&gt;&gt;Kernel: 度量完成, 允许执行
    Kernel-&gt;&gt;App: 继续执行程序
  </pre></div>
<p><em>图2: IMA 度量流程</em></p>
<ul>
<li><strong>钩子 (Hook)</strong>: IMA在内核的关键路径（如文件打开、执行<code>execve</code>、内存映射<code>mmap</code>）上设置了钩子。</li>
<li><strong>度量</strong>: 每当有文件要被访问或执行时，钩子被触发，IMA子系统会先计算该文件的哈希值。</li>
<li><strong>扩展</strong>: 计算出的哈希值被扩展到 **PCR[10]**（IMA专用的PCR寄存器）。</li>
<li><strong>记录日志</strong>: 同时，IMA会将这次度量的详细信息（文件名、哈希值）记录在内存中的一个日志里，该日志可以通过<code>/sys/kernel/security/ima/ascii_runtime_measurements</code>查看。</li>
</ul>
<p>通过这个机制，任何在系统运行时被加载的文件，都会留下“指纹”，确保了系统的动态可审计性。</p>
<h3 id="4-3-IMA-Appraise：运行时强制访问控制"><a href="#4-3-IMA-Appraise：运行时强制访问控制" class="headerlink" title="4.3 IMA-Appraise：运行时强制访问控制"></a>4.3 IMA-Appraise：运行时强制访问控制</h3><p><code>IMA-Appraise</code>是IMA的进阶功能。它不仅度量，还会进行<strong>强制性的验证</strong>。</p>
<ul>
<li>系统会预先为所有可信文件计算哈希，并将这些哈希值作为扩展属性（<code>security.ima</code>）存储在文件元数据中，并进行签名。</li>
<li>当<code>IMA-Appraise</code>启用时，每次文件被度量后，IMA会：<ol>
<li>检查文件是否有<code>security.ima</code>属性。</li>
<li>验证属性中的哈希签名是否有效。</li>
<li>比较实时计算的哈希值与属性中存储的“黄金哈希值”是否一致。</li>
</ol>
</li>
<li><strong>只有三者全部通过，才允许访问。否则，直接拒绝！</strong> 这将可信启动从一个“只记录、不阻止”的模型，变成了一个主动防御的强制访问控制系统。</li>
</ul>
<hr>
<h2 id="五、-总结：一条完整的静态信任根-SRTM-链"><a href="#五、-总结：一条完整的静态信任根-SRTM-链" class="headerlink" title="五、 总结：一条完整的静态信任根 (SRTM) 链"></a>五、 总结：一条完整的静态信任根 (SRTM) 链</h2><p>综上所述，一条完整的Linux静态信任根链条，是一个分工明确、层层递进的接力过程：</p>
<table>
<thead>
<tr>
<th align="left">阶段</th>
<th align="left">负责组件</th>
<th align="left">核心动作</th>
<th align="left">主要度量目标</th>
<th align="left">主要影响的PCR</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><strong>阶段一</strong></td>
<td align="left"><strong>UEFI 固件</strong></td>
<td align="left">Secure Boot验证、度量</td>
<td align="left">固件代码、扩展ROM、引导加载程序</td>
<td align="left">PCR[0-7]</td>
</tr>
<tr>
<td align="left"><strong>阶段二</strong></td>
<td align="left"><strong>GRUB 2</strong></td>
<td align="left">解析配置、度量</td>
<td align="left"><code>grub.cfg</code>命令、内核、initramfs</td>
<td align="left">PCR[8-9]</td>
</tr>
<tr>
<td align="left"><strong>阶段三</strong></td>
<td align="left"><strong>Linux 内核 (IMA)</strong></td>
<td align="left">Hook关键路径、度量</td>
<td align="left">应用程序、库、配置文件等</td>
<td align="left">PCR[10]</td>
</tr>
</tbody></table>
<p>从硬件上电到每一个应用被执行，每一步的控制权交接都伴随着“验证”与“度量”，确保了信任从一个绝对可信的硬件根（TPM），一路传递到运行中的整个操作系统，最终形成了一个坚实、可审计、可验证的安全基础。 </p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">XR</div><div class="post-copyright__author_desc">一片叶、一朵云</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/07/28/Linux%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/07/28/Linux%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/')">Linux可信启动深度解析：从UEFI到操作系统的完整信任链</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/07/28/Linux%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Linux可信启动深度解析：从UEFI到操作系统的完整信任链&amp;url=http://example.com/2025/07/28/Linux%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/&amp;pic=https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250801162921072.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">凌霄的博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">5</span></a><a class="post-meta__box__tags" href="/tags/%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>可信启动<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/TPM/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>TPM<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/UEFI/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>UEFI<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/GRUB/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>GRUB<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E5%AE%89%E5%85%A8%E5%90%AF%E5%8A%A8/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>安全启动<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250804092159955.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/26/%E4%B8%80%E8%B5%B7%E6%9D%A5%E5%AD%A6Intel%20SGX/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/3aa144bd3c7f6bcc77c15cb6f271975c.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">一起来学Intel SGX</div></div></a></div><div class="next-post pull-right"><a href="/2025/08/02/%E6%95%B0%E5%AD%97%E7%AD%BE%E5%90%8D%E4%B8%8E%E6%95%B0%E5%AD%97%E8%AF%81%E4%B9%A6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250801164133928.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数字签名与数字证书深度解析</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/13/iptables-nat-dnat-snat/" title="深入理解 iptables NAT：DNAT 与 SNAT 详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-13</div><div class="title">深入理解 iptables NAT：DNAT 与 SNAT 详解</div></div></a></div><div><a href="/2025/06/13/iptables-rule-chains/" title="深入理解 iptables 规则链：原理与实践"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-13</div><div class="title">深入理解 iptables 规则链：原理与实践</div></div></a></div><div><a href="/2025/06/13/linux-network-basics/" title="Linux 网络基础概念详解：从硬件到应用"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-13</div><div class="title">Linux 网络基础概念详解：从硬件到应用</div></div></a></div><div><a href="/2025/06/13/network-interfaces-ports-nics/" title="深入理解网络接口、端口与网卡：关系与工作流程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-13</div><div class="title">深入理解网络接口、端口与网卡：关系与工作流程</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">XR</h1><div class="author-info__desc">一片叶、一朵云</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/kongxiaoran" target="_blank" title="Github"></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux-%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90%EF%BC%9A%E4%BB%8EUEFI%E5%88%B0%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%9A%84%E4%BF%A1%E4%BB%BB%E9%93%BE"><span class="toc-number">1.</span> <span class="toc-text">Linux 可信启动深度解析：从UEFI到操作系统的信任链</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%95%E8%A8%80"><span class="toc-number">1.1.</span> <span class="toc-text">引言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81-%E5%8F%AF%E4%BF%A1%E6%A0%B9%E5%9F%BA%EF%BC%9ATPM%E4%B8%8E%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-number">1.2.</span> <span class="toc-text">一、 可信根基：TPM与核心概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E2%80%9C%E5%BA%A6%E9%87%8F%E2%80%9D-Measurement-%EF%BC%9F"><span class="toc-number">1.2.1.</span> <span class="toc-text">1.1 什么是“度量” (Measurement)？</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E4%BF%A1%E4%BB%BB%E9%93%BE%E4%B8%8ETPM-PCR"><span class="toc-number">1.2.2.</span> <span class="toc-text">1.2 信任链与TPM PCR</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81-%E9%98%B6%E6%AE%B5%E4%B8%80%EF%BC%9A%E5%9B%BA%E4%BB%B6%E7%9A%84%E5%8F%AF%E4%BF%A1%E5%90%AF%E5%8A%A8-UEFI"><span class="toc-number">1.3.</span> <span class="toc-text">二、 阶段一：固件的可信启动 (UEFI)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E5%BC%95%E5%AF%BC%E7%9A%84%E8%B5%B7%E7%82%B9%EF%BC%9A%E4%BB%8ESEC%E5%88%B0DXE%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">1.3.1.</span> <span class="toc-text">2.1 引导的起点：从SEC到DXE的初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E5%BC%95%E5%AF%BC%E8%AE%BE%E5%A4%87%E9%80%89%E6%8B%A9-BDS-%EF%BC%9AUEFI%E5%A6%82%E4%BD%95%E6%89%BE%E5%88%B0GRUB"><span class="toc-number">1.3.2.</span> <span class="toc-text">2.2 引导设备选择 (BDS)：UEFI如何找到GRUB</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-Secure-Boot%E4%B8%8E%E5%BA%A6%E9%87%8F%EF%BC%9A%E4%BF%A1%E4%BB%BB%E7%9A%84%E7%AC%AC%E4%B8%80%E6%AC%A1%E4%BC%A0%E9%80%92"><span class="toc-number">1.3.3.</span> <span class="toc-text">2.3 Secure Boot与度量：信任的第一次传递</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-SEC%E9%98%B6%E6%AE%B5%E5%A6%82%E4%BD%95%E4%B8%8ETPM%E4%BA%A4%E4%BA%92%EF%BC%9F"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">2.4 SEC阶段如何与TPM交互？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81-%E9%98%B6%E6%AE%B5%E4%BA%8C%EF%BC%9A%E5%BC%95%E5%AF%BC%E5%8A%A0%E8%BD%BD%E7%A8%8B%E5%BA%8F%E7%9A%84%E6%8E%A5%E5%8A%9B-GRUB-2"><span class="toc-number">1.4.</span> <span class="toc-text">三、 阶段二：引导加载程序的接力 (GRUB 2)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-GRUB%E8%87%AA%E6%88%91%E5%94%A4%E9%86%92%E5%B9%B6%E5%BB%B6%E7%BB%AD%E4%BF%A1%E4%BB%BB%E9%93%BE"><span class="toc-number">1.4.1.</span> <span class="toc-text">3.1 GRUB自我唤醒并延续信任链</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E6%8E%A7%E5%88%B6%E6%9D%83%E7%9A%84%E7%AC%AC%E4%BA%8C%E6%AC%A1%E4%BA%A4%E6%8E%A5-GRUB-Kernel"><span class="toc-number">1.4.2.</span> <span class="toc-text">3.2 控制权的第二次交接 (GRUB -&gt; Kernel)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81-%E9%98%B6%E6%AE%B5%E4%B8%89%EF%BC%9A%E5%86%85%E6%A0%B8%E7%9A%84%E5%85%A8%E9%9D%A2%E5%AE%88%E6%8A%A4-IMA"><span class="toc-number">1.5.</span> <span class="toc-text">四、 阶段三：内核的全面守护 (IMA)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-IMA%E7%AE%80%E4%BB%8B%EF%BC%9A%E5%B0%86%E4%BF%A1%E4%BB%BB%E6%89%A9%E5%B1%95%E5%88%B0%E6%95%B4%E4%B8%AA%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="toc-number">1.5.1.</span> <span class="toc-text">4.1 IMA简介：将信任扩展到整个文件系统</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-IMA-Measure%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%97%B6%E5%BA%A6%E9%87%8F"><span class="toc-number">1.5.2.</span> <span class="toc-text">4.2 IMA-Measure：运行时度量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-IMA-Appraise%EF%BC%9A%E8%BF%90%E8%A1%8C%E6%97%B6%E5%BC%BA%E5%88%B6%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6"><span class="toc-number">1.5.3.</span> <span class="toc-text">4.3 IMA-Appraise：运行时强制访问控制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81-%E6%80%BB%E7%BB%93%EF%BC%9A%E4%B8%80%E6%9D%A1%E5%AE%8C%E6%95%B4%E7%9A%84%E9%9D%99%E6%80%81%E4%BF%A1%E4%BB%BB%E6%A0%B9-SRTM-%E9%93%BE"><span class="toc-number">1.6.</span> <span class="toc-text">五、 总结：一条完整的静态信任根 (SRTM) 链</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/09/13/%E4%B8%80%E7%AB%99%E5%BC%8F%E6%90%AD%E5%BB%BASpark-Hadoop%E9%9B%86%E7%BE%A4%E5%8F%8AZeppelin/" title="一站式搭建Spark-Hadoop集群及Zeppelin"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250804092159955.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="一站式搭建Spark-Hadoop集群及Zeppelin"/></a><div class="content"><a class="title" href="/2025/09/13/%E4%B8%80%E7%AB%99%E5%BC%8F%E6%90%AD%E5%BB%BASpark-Hadoop%E9%9B%86%E7%BE%A4%E5%8F%8AZeppelin/" title="一站式搭建Spark-Hadoop集群及Zeppelin">一站式搭建Spark-Hadoop集群及Zeppelin</a><time datetime="2025-09-13T09:00:00.000Z" title="发表于 2025-09-13 17:00:00">2025-09-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/09/11/%E6%9E%84%E5%BB%BA%E5%92%8C%E9%83%A8%E7%BD%B2Spark%E3%80%81Hadoop%E4%B8%8EZeppelin%E9%9B%86%E6%88%90%E7%8E%AF%E5%A2%83/" title="构建和部署Spark、Hadoop与Zeppelin集成环境">构建和部署Spark、Hadoop与Zeppelin集成环境</a><time datetime="2025-09-11T06:52:01.000Z" title="发表于 2025-09-11 14:52:01">2025-09-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/07/Zeppelin%20%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/" title="Zeppelin 使用体验"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250804092337513.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Zeppelin 使用体验"/></a><div class="content"><a class="title" href="/2025/09/07/Zeppelin%20%E4%BD%BF%E7%94%A8%E4%BD%93%E9%AA%8C/" title="Zeppelin 使用体验">Zeppelin 使用体验</a><time datetime="2025-09-07T14:00:00.000Z" title="发表于 2025-09-07 22:00:00">2025-09-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/30/%E5%AD%A6%E4%B9%A0Spark4.0%E6%BA%90%E7%A0%81%E3%80%901%E3%80%91%E2%80%94%E2%80%94%E4%B8%8B%E8%BD%BD%E5%B9%B6%E8%BF%90%E8%A1%8C%20spark,%E5%B9%B6%E8%BF%9B%E8%A1%8Cdebug%20/" title="学习Spark4.0源码【1】——下载并运行spark并进行debug"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250818155818848.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="学习Spark4.0源码【1】——下载并运行spark并进行debug"/></a><div class="content"><a class="title" href="/2025/08/30/%E5%AD%A6%E4%B9%A0Spark4.0%E6%BA%90%E7%A0%81%E3%80%901%E3%80%91%E2%80%94%E2%80%94%E4%B8%8B%E8%BD%BD%E5%B9%B6%E8%BF%90%E8%A1%8C%20spark,%E5%B9%B6%E8%BF%9B%E8%A1%8Cdebug%20/" title="学习Spark4.0源码【1】——下载并运行spark并进行debug">学习Spark4.0源码【1】——下载并运行spark并进行debug</a><time datetime="2025-08-30T06:00:00.000Z" title="发表于 2025-08-30 14:00:00">2025-08-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/18/HDFS-Kerberos%E8%AE%A4%E8%AF%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%96%87%E6%A1%A3/" title="HDFS Kerberos认证问题排查与解决"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250818155226461.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HDFS Kerberos认证问题排查与解决"/></a><div class="content"><a class="title" href="/2025/08/18/HDFS-Kerberos%E8%AE%A4%E8%AF%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%96%87%E6%A1%A3/" title="HDFS Kerberos认证问题排查与解决">HDFS Kerberos认证问题排查与解决</a><time datetime="2025-08-18T11:00:00.000Z" title="发表于 2025-08-18 19:00:00">2025-08-18</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="XR" target="_blank">XR</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">61</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">87</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">7</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 0.88rem;">Argon2<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>2</sup></a><a href="/tags/HBase/" style="font-size: 0.88rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 0.88rem;">HDFS<sup>4</sup></a><a href="/tags/HTTP/" style="font-size: 0.88rem;">HTTP<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>4</sup></a><a href="/tags/Hive/" style="font-size: 0.88rem;">Hive<sup>1</sup></a><a href="/tags/HyperEnclave/" style="font-size: 0.88rem;">HyperEnclave<sup>5</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>8</sup></a><a href="/tags/Kubernetes/" style="font-size: 0.88rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>5</sup></a><a href="/tags/Maven/" style="font-size: 0.88rem;">Maven<sup>1</sup></a><a href="/tags/RDD/" style="font-size: 0.88rem;">RDD<sup>2</sup></a><a href="/tags/SGX/" style="font-size: 0.88rem;">SGX<sup>2</sup></a><a href="/tags/Shuffle%E6%9C%BA%E5%88%B6/" style="font-size: 0.88rem;">Shuffle机制<sup>1</sup></a><a href="/tags/Spark/" style="font-size: 0.88rem;">Spark<sup>10</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>3</sup></a><a href="/tags/TDX/" style="font-size: 0.88rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 0.88rem;">TEE<sup>9</sup></a><a href="/tags/TME/" style="font-size: 0.88rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 0.88rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E4%BB%A3%E7%90%86/" style="font-size: 0.88rem;">代理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">分布式计算<sup>3</sup></a><a href="/tags/%E5%9C%B0%E7%90%86%E4%BD%8D%E7%BD%AE%E9%99%90%E5%88%B6/" style="font-size: 0.88rem;">地理位置限制<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>6</sup></a><a href="/tags/%E5%AD%A6%E4%B9%A0%E8%B7%AF%E7%BA%BF/" style="font-size: 0.88rem;">学习路线<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 0.88rem;">密码学<sup>5</sup></a><a href="/tags/%E6%8A%80%E6%9C%AF%E4%B8%93%E6%A0%8F/" style="font-size: 0.88rem;">技术专栏<sup>1</sup></a><a href="/tags/%E6%9C%BA%E5%AF%86%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">机密计算<sup>2</sup></a><a href="/tags/%E6%B5%81%E5%AA%92%E4%BD%93%E8%A7%A3%E9%94%81/" style="font-size: 0.88rem;">流媒体解锁<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>4</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90/" style="font-size: 0.88rem;">网络分析<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">网络安全<sup>1</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">隐私计算<sup>3</sup></a><a href="/tags/%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84/" style="font-size: 0.88rem;">集群架构<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/26/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 XR 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
      appKey: 'MR93sqmbPdh7Zm1bZzjXNvlm',
      avatar: 'mp',
      serverURLs: 'https://cbsqtaqs.api.lncldglobal.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://cbsqtaqs.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
        "X-LC-Key": 'MR93sqmbPdh7Zm1bZzjXNvlm',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>