<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>HTTP请求链路与DNS分析技术实践：深入理解网络通信机制 | 凌霄的博客</title><meta name="keywords" content="DNS,HTTP,网络分析"><meta name="author" content="XR"><meta name="copyright" content="XR"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="HTTP请求链路与DNS分析技术实践：深入理解网络通信机制"><meta name="application-name" content="HTTP请求链路与DNS分析技术实践：深入理解网络通信机制"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="HTTP请求链路与DNS分析技术实践：深入理解网络通信机制"><meta property="og:url" content="http://example.com/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/index.html"><meta property="og:site_name" content="凌霄的博客"><meta property="og:description" content="深入解析HTTP请求的完整传输链路，重点探讨DNS解析机制，提供实用的网络分析工具使用指南，包含真实数据包分析和网络故障诊断实践"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250607203155245.png"><meta property="article:author" content="XR"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250607203155245.png"><meta name="description" content="深入解析HTTP请求的完整传输链路，重点探讨DNS解析机制，提供实用的网络分析工具使用指南，包含真实数据包分析和网络故障诊断实践"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: XR","link":"链接: ","source":"来源: 凌霄的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '凌霄的博客',
  title: 'HTTP请求链路与DNS分析技术实践：深入理解网络通信机制',
  postAI: '',
  pageFillDescription: 'HTTP请求链路与DNS分析技术实践, 概述, HTTP请求完整链路分析, 链路组成与节点职责, HTTP请求完整链路技术流程, 第一阶段：DNS解析（Domain Name Resolution）, 第二阶段：TCP连接建立（Three-Way Handshake）, 第三阶段：TLS握手（Cryptographic Handshake）, 第四阶段：HTTP请求响应（Application Data）, 第五阶段：连接关闭（Connection Termination）, 协议栈详细处理分析, 应用层（Layer 7）处理细节, 传输层（Layer 4）处理细节, 网络层（Layer 3）处理细节, 数据链路层（Layer 2）处理细节, 网络性能指标详细分析, 各阶段延迟分解, 带宽利用率分析, TLS握手与加密通信, 实际数据包分析, Wireshark抓包实战分析, 1. DNS查询数据包分析, 2. TCP三次握手数据包分析, 3. TLS握手数据包分析, 4. HTTP请求响应数据包分析, 网络流量统计分析, 数据包流量统计, 时间序列分析, NAT转换详细分析, 路由器NAT处理过程, DNS查询机制深度解析, DNS解析的层次结构, DNS查询的两种模式, DNS缓存机制, 网络路径追踪原理, Traceroute工作机制, 网络延迟分析, 实践工具使用指南, macOS HTTP请求链路分析工具, dig命令详解, dig +trace深度分析, traceroute网络路径分析, 工具对比和选择建议, 功能对比矩阵, 使用场景建议, 工具组合使用策略, 隐私安全考量, 网络可见性分析, 隐私保护措施, 快速参考手册, 常用命令速查, 故障排查流程图, 性能优化检查清单, 安全检查要点, 总结请求链路与分析技术实践概述在现代网络架构中一个看似简单的请求实际上涉及复杂的网络链路和多层协议栈本文将从技术实现角度深入分析请求的完整传输链路重点探讨解析机制并提供实用的网络分析工具使用指南通过实际案例和工具实践我们将理解网络请求背后的技术细节掌握网络问题诊断和性能分析的核心技能请求完整链路分析链路组成与节点职责一个请求从客户端到服务器的完整路径包含多个关键节点客户端本地路由器接入网关核心网络骨干网路由器目标服务器每个节点在网络通信中承担不同的职责客户端本机发起查询获取目标地址建立连接进行握手发送请求处理响应本地路由器执行转换将内网映射到公网管理本地网络流量分发记录连接状态和流量统计网络提供互联网接入服务执行流量路由和负载均衡可能进行流量监控和内容过滤骨干网络承载跨地区跨国的数据传输执行复杂的路由策略提供冗余路径和故障切换请求完整链路技术流程一个完整的请求包含以下详细步骤第一阶段解析步骤递归查询时间戳客户端本地根服务器权威返回列表实际数据流总耗时第二阶段连接建立步骤三次握手详细过程客户端服务器包步骤选项包步骤选项包步骤连接建立完成总耗时第三阶段握手步骤握手详细分析步骤版本随机数字节客户端随机数密码套件扩展字段明文传输步骤版本随机数字节服务器随机数选择密码套件证书链主证书签发机构中间证书根证书步骤密钥交换椭圆曲线客户端公钥字节生成共享密钥字节主密钥步骤握手验证加密通道建立完成握手总耗时第四阶段请求响应步骤请求详细格式请求大小加密后发送时间步骤响应详细分析你的出口响应大小接收时间服务器处理时间第五阶段连接关闭步骤四次挥手客户端发送服务器响应服务器发送客户端响应连接关闭完成协议栈详细处理分析应用层处理细节请求构建方法版本头部字段等消息体空请求加密处理应用数据通过加密使用对称加密每个数据包包含认证标签传输层处理细节段封装源端口客户端随机端口目标端口标准端口序列号用于数据包排序和重传确认号确认已收到的数据窗口大小流量控制机制校验和数据完整性验证状态机转换网络层处理细节数据包封装版本头部长度字节服务类型默认总长度段长度标识用于分片重组标志位不分片默认协议头部校验和头部完整性源内网目标路由选择默认网关下一跳根据路由表决定数据链路层处理细节以太网帧封装目标路由器地址源网卡地址类型数据数据包帧完整性校验解析本地表查询地址如果不存在则发送请求广播网络性能指标详细分析各阶段延迟分解总请求时间解析握手握手请求数据传输连接网络路径延迟分析跳数本地路由器跳数网关跳数骨干网总网络延迟带宽利用率分析上行流量查询握手握手请求总上行下行流量响应握手握手响应总下行有效载荷比协议开销握手与加密通信请求在连接建立后需要进行握手客户端发送支持的加密套件服务器选择加密套件并发送证书密钥交换使用公钥加密协商对称密钥双方确认握手完成开始加密通信这个过程确保了数据传输的机密性和完整性但也增加了网络延迟实际数据包分析抓包实战分析以下是通过实际网络抓包获得的请求完整数据流查询数据包分析查询包响应包三次握手数据包分析包包握手数据包分析包明文包请求响应数据包分析请求包加密后解密后的内容响应包加密后解密后的内容完整响应网络流量统计分析数据包流量统计总数据包数量个总传输字节按协议分类包握手包握手包数据包按方向分类上行客户端服务器包下行服务器客户端包时间序列分析时间线分析相对时间查询发送响应接收发送接收发送发送接收握手完成请求发送响应接收关键延迟节点解析延迟网络往返握手延迟网络往返握手延迟证书验证密钥协商处理延迟服务器处理时间转换详细分析路由器处理过程内网到外网的地址转换原始数据包源目标经过转换后源分配的公网和端口目标会话表记录内网地址端口外网地址端口目标地址端口协议状态返回数据包的转换接收到的数据包源目标转换后发送到内网源目标查询机制深度解析解析的层次结构系统采用分层架构每层都有明确的职责根域名服务器全球个根服务器实际部署数百个节点负责顶级域名的权威信息处理全球查询的起点顶级域名服务器管理等顶级域名提供二级域名的权威服务器信息承载大量的域名解析请求权威域名服务器存储域名的实际地址映射负责特定域名的最终解析通常由域名所有者或托管服务商运营递归域名服务器或公共服务提供为客户端执行完整的查询缓存查询结果以提高性能查询的两种模式递归查询客户端递归服务器完整查询链路返回最终结果客户端只需发送一次请求服务器负责完整的查询过程适用于普通用户的日常使用迭代查询客户端根服务器返回服务器地址客户端服务器返回权威服务器地址客户端权威服务器返回地址客户端需要多次查询不同服务器能够了解完整的解析路径主要用于故障诊断和学习分析缓存机制缓存存在于多个层次浏览器缓存缓存时间通常几分钟到几小时作用范围单个浏览器进程优势响应速度最快操作系统缓存缓存时间根据值确定作用范围整个系统管理系统解析服务路由器缓存缓存时间通常较短作用范围本地网络目的减少上游查询缓存缓存时间根据和策略作用范围所有用户影响可能影响污染和劫持网络路径追踪原理工作机制通过协议或数据包的机制来追踪网络路径基本原理发送的数据包第一跳路由器返回发送的数据包第二跳路由器返回继续增加值直到到达目标主机信息获取每跳路由器的地址到达每跳的网络延迟路径中的网络拓扑结构局限性部分路由器禁用响应负载均衡可能导致路径不一致防火墙可能过滤数据包网络延迟分析通过可以分析网络延迟的组成传播延迟信号在物理介质中传播的时间传输延迟数据包发送到链路上所需的时间排队延迟在路由器缓冲区中等待的时间处理延迟路由器处理数据包头的时间识别延迟异常的跳数有助于定位网络性能问题实践工具使用指南请求链路分析工具我们之前创建的脚本集成了多种网络分析功能功能特性本机网络信息获取解析结果分析网络路径追踪请求详细过程连接状态监控使用方法输出解读本机内网地址网关本地路由器服务器提供的这个工具的价值在于提供了请求的完整上下文信息帮助理解请求从发起到完成的全过程命令详解是查询的瑞士军刀支持多种查询模式基本查询查询记录地址使用系统默认服务器显示查询统计信息指定查询类型邮件交换记录名称服务器记录别名记录指定服务器使用使用简化输出只显示地址只显示应答部分深度分析是学习机制的最佳工具执行过程输出分析根服务器查询显示全球个根服务器服务器查询查询顶级域权威服务器权威服务器查询查询的权威最终解析获取实际地址关键信息解读响应数据大小查询的服务器和端口查询延迟学习价值理解的层次结构观察解析的完整路径识别性能瓶颈诊断解析故障网络路径分析帮助我们理解数据包的实际传输路径基本使用常用选项不进行反向解析最大跳数限制为等待响应超时秒输出解读第一列跳数第二列路由器地址后面三列三次探测的往返时间异常情况处理表示该跳没有响应可能的原因路由器禁用了响应防火墙过滤了数据包网络拥塞导致数据包丢失工具对比和选择建议功能对比矩阵工具主要功能适用场景信息深度学习价值综合网络分析日常问题诊断中等高解析路径追踪学习和故障排查深入很高标准查询快速检查浅层中等网络路径追踪网络连通性分析中等高使用场景建议日常开发调试优先使用标准命令进行快速检查使用自定义脚本进行综合网络状态分析遇到连接问题时使用定位网络节点深度学习研究使用理解工作原理结合多种工具对比分析网络行为通过实际案例加深对网络协议的理解生产环境监控建立自动化监控脚本定期检查关键服务的解析监控网络路径变化和性能指标工具组合使用策略在实际工作中这些工具往往需要组合使用故障诊断流程快速检查解析如果有问题深入分析解析路径检查网络连通性综合分析网络状态性能分析流程检查解析时间分析网络延迟分布对比不同服务器性能隐私安全考量网络可见性分析通过我们的分析可以发现网络通信并非点对点的私密连接级别可见性完整的查询历史连接的目标和端口流量大小和时间模式握手中的字段明文中间节点可见性路由器可见连接记录和流量统计骨干网可见路由信息和元数据代理服务器可能看到完整的内容本地网络可见性家用路由器记录所有设备的网络活动企业网络可能进行深度包检测公共存在较高的监听风险隐私保护措施隐私保护使用使用网络流量保护使用隐藏真实和流量模式启用确保应用层数据加密考虑使用网络实现匿名访问最佳实践建议选择可信的服务提供商定期检查网络配置和隐私设置了解不同网络环境的安全风险根据需要采用相应的隐私保护措施快速参考手册常用命令速查查询基本查询完整路径追踪只显示地址使用特定服务器查询特定记录类型网络路径分析基本路径追踪不进行反向解析更快限制最大跳数设置超时时间专用命令查看配置查看路由表清除缓存查看网络接口查看活动连接故障排查流程图网络问题如果失败如果正常分析路径检查防火墙代理设置联系网络管理员性能优化检查清单解析时间网络延迟国内国际没有异常的路由跳数握手时间合理选择就近的服务器启用缓存考虑使用服务安全检查要点使用而非选择可信的服务商定期检查设置避免使用不安全的公共考虑使用保护隐私了解泄露风险总结请求的完整链路涉及复杂的网络架构和多层协议栈通过深入理解解析机制网络路径追踪原理和各种分析工具的使用我们能够提升问题诊断能力快速定位网络连接问题的根本原因优化网络性能识别性能瓶颈并采取针对性优化措施增强安全意识了解网络通信的隐私风险和保护措施深化技术理解掌握网络协议的实际工作原理在实际工作中这些工具和知识不仅有助于解决技术问题更能帮助我们构建更可靠更安全的网络应用系统网络技术的复杂性要求我们保持持续学习的态度通过实践和分析不断加深对底层机制的理解只有真正理解了网络通信的完整链路我们才能在复杂的网络环境中游刃有余地解决各种技术挑战本文档基于环境的实际测试和分析编写适用于网络工程师系统管理员和开发工程师的日常工作参考',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-01 16:36:20',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">凌霄的博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 1.05rem;">Argon2<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 1.05rem;">DNS<sup>2</sup></a><a href="/tags/DSP/" style="font-size: 1.05rem;">DSP<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 1.05rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 1.05rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 1.05rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>6</sup></a><a href="/tags/Kubernetes/" style="font-size: 1.05rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 1.05rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 1.05rem;">NAT<sup>1</sup></a><a href="/tags/RTB/" style="font-size: 1.05rem;">RTB<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 1.05rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 1.05rem;">SGX<sup>2</sup></a><a href="/tags/Spark/" style="font-size: 1.05rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 1.05rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 1.05rem;">TEE<sup>2</sup></a><a href="/tags/TME/" style="font-size: 1.05rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 1.05rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 1.05rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 1.05rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>2</sup></a><a href="/tags/%E5%B9%BF%E5%91%8A%E6%8A%95%E6%94%BE/" style="font-size: 1.05rem;">广告投放<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">隐私计算<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">32</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/DNS/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>DNS</span></a><a class="article-meta__tags" href="/tags/HTTP/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>HTTP</span></a><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络分析</span></a></span></div></div><h1 class="post-title" itemprop="name headline">HTTP请求链路与DNS分析技术实践：深入理解网络通信机制</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-28T16:00:00.000Z" title="发表于 2025-06-29 00:00:00">2025-06-29</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-07-01T08:36:20.613Z" title="更新于 2025-07-01 16:36:20">2025-07-01</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="HTTP请求链路与DNS分析技术实践：深入理解网络通信机制"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为杭州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250607203155245.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"><header><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a><a href="/tags/DNS/" tabindex="-1" itemprop="url">DNS</a><a href="/tags/HTTP/" tabindex="-1" itemprop="url">HTTP</a><a href="/tags/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90/" tabindex="-1" itemprop="url">网络分析</a><h1 id="CrawlerTitle" itemprop="name headline">HTTP请求链路与DNS分析技术实践：深入理解网络通信机制</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">XR</span><time itemprop="dateCreated datePublished" datetime="2025-06-28T16:00:00.000Z" title="发表于 2025-06-29 00:00:00">2025-06-29</time><time itemprop="dateCreated datePublished" datetime="2025-07-01T08:36:20.613Z" title="更新于 2025-07-01 16:36:20">2025-07-01</time></header><h1 id="HTTP请求链路与DNS分析技术实践"><a href="#HTTP请求链路与DNS分析技术实践" class="headerlink" title="HTTP请求链路与DNS分析技术实践"></a>HTTP请求链路与DNS分析技术实践</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>在现代网络架构中，一个看似简单的HTTP请求实际上涉及复杂的网络链路和多层协议栈。本文将从技术实现角度深入分析HTTP请求的完整传输链路，重点探讨DNS解析机制，并提供实用的网络分析工具使用指南。</p>
<p>通过实际案例和工具实践，我们将理解网络请求背后的技术细节，掌握网络问题诊断和性能分析的核心技能。</p>
<h2 id="HTTP请求完整链路分析"><a href="#HTTP请求完整链路分析" class="headerlink" title="HTTP请求完整链路分析"></a>HTTP请求完整链路分析</h2><h3 id="链路组成与节点职责"><a href="#链路组成与节点职责" class="headerlink" title="链路组成与节点职责"></a>链路组成与节点职责</h3><p>一个HTTP请求从客户端到服务器的完整路径包含多个关键节点：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端 → 本地路由器 → ISP接入网关 → ISP核心网络 → 骨干网路由器 → 目标服务器</span><br></pre></td></tr></table></figure>

<p>每个节点在网络通信中承担不同的职责：</p>
<p><strong>1. 客户端本机</strong></p>
<ul>
<li>发起DNS查询，获取目标IP地址</li>
<li>建立TCP连接，进行TLS握手</li>
<li>发送HTTP请求，处理响应</li>
</ul>
<p><strong>2. 本地路由器</strong></p>
<ul>
<li>执行NAT转换，将内网IP映射到公网IP</li>
<li>管理本地网络流量分发</li>
<li>记录连接状态和流量统计</li>
</ul>
<p><strong>3. ISP网络</strong></p>
<ul>
<li>提供互联网接入服务</li>
<li>执行流量路由和负载均衡</li>
<li>可能进行流量监控和内容过滤</li>
</ul>
<p><strong>4. 骨干网络</strong></p>
<ul>
<li>承载跨地区、跨国的数据传输</li>
<li>执行复杂的路由策略</li>
<li>提供冗余路径和故障切换</li>
</ul>
<h3 id="HTTP请求完整链路技术流程"><a href="#HTTP请求完整链路技术流程" class="headerlink" title="HTTP请求完整链路技术流程"></a>HTTP请求完整链路技术流程</h3><p>一个完整的HTTPS请求包含以下详细步骤：</p>
<h4 id="第一阶段：DNS解析（Domain-Name-Resolution）"><a href="#第一阶段：DNS解析（Domain-Name-Resolution）" class="headerlink" title="第一阶段：DNS解析（Domain Name Resolution）"></a>第一阶段：DNS解析（Domain Name Resolution）</h4><p><strong>步骤1-10：递归DNS查询</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">时间戳: 2025-06-30 10:00:40</span><br><span class="line">客户端 → 本地DNS → 根服务器 → .org权威 → AWS DNS → 返回IP列表</span><br><span class="line"></span><br><span class="line">实际数据流：</span><br><span class="line">Query: httpbin.org A IN</span><br><span class="line">Response: </span><br><span class="line">  52.71.117.65 TTL=60</span><br><span class="line">  54.243.106.191 TTL=60  </span><br><span class="line">  44.207.188.95 TTL=60</span><br><span class="line">  34.202.168.137 TTL=60</span><br><span class="line">总耗时: 48ms</span><br></pre></td></tr></table></figure>

<h4 id="第二阶段：TCP连接建立（Three-Way-Handshake）"><a href="#第二阶段：TCP连接建立（Three-Way-Handshake）" class="headerlink" title="第二阶段：TCP连接建立（Three-Way Handshake）"></a>第二阶段：TCP连接建立（Three-Way Handshake）</h4><p><strong>步骤11-16：TCP三次握手详细过程</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">客户端:192.168.231.196:54321 → 服务器:52.71.117.65:443</span><br><span class="line"></span><br><span class="line">1. SYN包 (步骤11-12)</span><br><span class="line">   TCP Header: SYN=1, Seq=1000, Ack=0, Win=65535</span><br><span class="line">   选项: MSS=1460, SACK_PERM, WSCALE=14</span><br><span class="line">   </span><br><span class="line">2. SYN-ACK包 (步骤13-14)  </span><br><span class="line">   TCP Header: SYN=1, ACK=1, Seq=2000, Ack=1001, Win=26880</span><br><span class="line">   选项: MSS=1380, SACK_PERM, WSCALE=7</span><br><span class="line">   </span><br><span class="line">3. ACK包 (步骤15-16)</span><br><span class="line">   TCP Header: ACK=1, Seq=1001, Ack=2001, Win=4096</span><br><span class="line">   </span><br><span class="line">连接建立完成，总耗时: 25ms</span><br></pre></td></tr></table></figure>

<h4 id="第三阶段：TLS握手（Cryptographic-Handshake）"><a href="#第三阶段：TLS握手（Cryptographic-Handshake）" class="headerlink" title="第三阶段：TLS握手（Cryptographic Handshake）"></a>第三阶段：TLS握手（Cryptographic Handshake）</h4><p><strong>步骤17-20：TLS 1.3握手详细分析</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">1. Client Hello (步骤17)</span><br><span class="line">   TLS版本: 1.3 (0x0304)</span><br><span class="line">   随机数: 32字节客户端随机数</span><br><span class="line">   密码套件: TLS_AES_256_GCM_SHA384, TLS_CHACHA20_POLY1305_SHA256</span><br><span class="line">   扩展字段:</span><br><span class="line">     - server_name (SNI): httpbin.org  ← 明文传输！</span><br><span class="line">     - supported_groups: x25519, secp256r1</span><br><span class="line">     - signature_algorithms: rsa_pss_rsae_sha256</span><br><span class="line">   </span><br><span class="line">2. Server Hello + Certificate (步骤18)</span><br><span class="line">   TLS版本: 1.3</span><br><span class="line">   随机数: 32字节服务器随机数  </span><br><span class="line">   选择密码套件: TLS_AES_256_GCM_SHA384</span><br><span class="line">   证书链:</span><br><span class="line">     - 主证书: CN=httpbin.org, 签发机构=Amazon</span><br><span class="line">     - 中间证书: Amazon RSA 2048 M02</span><br><span class="line">     - 根证书: Amazon Root CA 1</span><br><span class="line">   </span><br><span class="line">3. Key Exchange (步骤19)</span><br><span class="line">   ECDHE密钥交换: x25519椭圆曲线</span><br><span class="line">   客户端公钥: 32字节</span><br><span class="line">   生成共享密钥: 32字节主密钥</span><br><span class="line">   </span><br><span class="line">4. Finished (步骤20)</span><br><span class="line">   握手验证: HMAC-SHA384</span><br><span class="line">   加密通道建立完成</span><br><span class="line">   </span><br><span class="line">TLS握手总耗时: 45ms</span><br></pre></td></tr></table></figure>

<h4 id="第四阶段：HTTP请求响应（Application-Data）"><a href="#第四阶段：HTTP请求响应（Application-Data）" class="headerlink" title="第四阶段：HTTP请求响应（Application Data）"></a>第四阶段：HTTP请求响应（Application Data）</h4><p><strong>步骤21：HTTP请求详细格式</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/headers</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>httpbin.org</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>curl/7.68.0</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>*/*</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Cache-Control</span><span class="punctuation">: </span>no-cache</span><br><span class="line"></span><br><span class="line"><span class="language-dns">请求大小: <span class="number">156</span> bytes (加密后)</span></span><br><span class="line"><span class="language-dns">发送时间: <span class="number">2025-06-30</span> <span class="number">10:00:41.123</span></span></span><br></pre></td></tr></table></figure>

<p><strong>步骤22：HTTP响应详细分析</strong></p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">HTTP/1.1</span> <span class="number">200</span> OK</span><br><span class="line"><span class="attribute">Date</span><span class="punctuation">: </span>Mon, 30 Jun 2025 02:00:41 GMT</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/json</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>891</span><br><span class="line"><span class="attribute">Server</span><span class="punctuation">: </span>gunicorn/19.9.0</span><br><span class="line"><span class="attribute">Access-Control-Allow-Origin</span><span class="punctuation">: </span>*</span><br><span class="line"><span class="attribute">Access-Control-Allow-Credentials</span><span class="punctuation">: </span>true</span><br><span class="line"></span><br><span class="line"><span class="language-makefile">&#123;</span></span><br><span class="line"><span class="language-makefile">  <span class="string">&quot;headers&quot;</span>: &#123;</span></span><br><span class="line"><span class="language-makefile">    <span class="string">&quot;Accept&quot;</span>: <span class="string">&quot;*/*&quot;</span>,</span></span><br><span class="line"><span class="language-makefile">    <span class="string">&quot;Accept-Encoding&quot;</span>: <span class="string">&quot;gzip, deflate&quot;</span>, </span></span><br><span class="line"><span class="language-makefile">    <span class="string">&quot;Host&quot;</span>: <span class="string">&quot;httpbin.org&quot;</span>,</span></span><br><span class="line"><span class="language-makefile">    <span class="string">&quot;User-Agent&quot;</span>: <span class="string">&quot;curl/7.68.0&quot;</span>,</span></span><br><span class="line"><span class="language-makefile">    <span class="string">&quot;X-Forwarded-For&quot;</span>: <span class="string">&quot;111.0.99.254&quot;</span>,  ← 你的ISP出口IP</span></span><br><span class="line"><span class="language-makefile">    <span class="string">&quot;X-Forwarded-Proto&quot;</span>: <span class="string">&quot;https&quot;</span>,</span></span><br><span class="line"><span class="language-makefile">    <span class="string">&quot;X-Forwarded-Port&quot;</span>: <span class="string">&quot;443&quot;</span></span></span><br><span class="line"><span class="language-makefile">  &#125;</span></span><br><span class="line"><span class="language-makefile">&#125;</span></span><br><span class="line"><span class="language-makefile"></span></span><br><span class="line"><span class="language-makefile"><span class="section">响应大小: 891 bytes</span></span></span><br><span class="line"><span class="language-makefile"><span class="section">接收时间: 2025-06-30 10:00:41.156</span></span></span><br><span class="line"><span class="language-makefile"><span class="section">服务器处理时间: 33ms</span></span></span><br></pre></td></tr></table></figure>

<h4 id="第五阶段：连接关闭（Connection-Termination）"><a href="#第五阶段：连接关闭（Connection-Termination）" class="headerlink" title="第五阶段：连接关闭（Connection Termination）"></a>第五阶段：连接关闭（Connection Termination）</h4><p><strong>步骤23-24：TCP四次挥手</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. 客户端发送FIN: Seq=1157, Ack=2892</span><br><span class="line">2. 服务器响应ACK: Seq=2892, Ack=1158  </span><br><span class="line">3. 服务器发送FIN: Seq=2892, Ack=1158</span><br><span class="line">4. 客户端响应ACK: Seq=1158, Ack=2893</span><br><span class="line"></span><br><span class="line">连接关闭完成</span><br></pre></td></tr></table></figure>

<h3 id="协议栈详细处理分析"><a href="#协议栈详细处理分析" class="headerlink" title="协议栈详细处理分析"></a>协议栈详细处理分析</h3><h4 id="应用层（Layer-7）处理细节"><a href="#应用层（Layer-7）处理细节" class="headerlink" title="应用层（Layer 7）处理细节"></a>应用层（Layer 7）处理细节</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">HTTP/1.1请求构建:</span><br><span class="line">- 方法: GET</span><br><span class="line">- URI: /headers  </span><br><span class="line">- 版本: HTTP/1.1</span><br><span class="line">- 头部字段: Host, User-Agent, Accept等</span><br><span class="line">- 消息体: 空（GET请求）</span><br><span class="line"></span><br><span class="line">HTTPS加密处理:</span><br><span class="line">- 应用数据通过TLS加密</span><br><span class="line">- 使用AES-256-GCM对称加密</span><br><span class="line">- 每个数据包包含认证标签</span><br></pre></td></tr></table></figure>

<h4 id="传输层（Layer-4）处理细节"><a href="#传输层（Layer-4）处理细节" class="headerlink" title="传输层（Layer 4）处理细节"></a>传输层（Layer 4）处理细节</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">TCP段封装:</span><br><span class="line">- 源端口: 54321 (客户端随机端口)</span><br><span class="line">- 目标端口: 443 (HTTPS标准端口)</span><br><span class="line">- 序列号: 用于数据包排序和重传</span><br><span class="line">- 确认号: 确认已收到的数据</span><br><span class="line">- 窗口大小: 流量控制机制</span><br><span class="line">- 校验和: 数据完整性验证</span><br><span class="line"></span><br><span class="line">TCP状态机转换:</span><br><span class="line">CLOSED → SYN_SENT → ESTABLISHED → FIN_WAIT_1 → FIN_WAIT_2 → TIME_WAIT → CLOSED</span><br></pre></td></tr></table></figure>

<h4 id="网络层（Layer-3）处理细节"><a href="#网络层（Layer-3）处理细节" class="headerlink" title="网络层（Layer 3）处理细节"></a>网络层（Layer 3）处理细节</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">IPv4数据包封装:</span><br><span class="line">- 版本: 4</span><br><span class="line">- 头部长度: 20字节</span><br><span class="line">- 服务类型: 0x00 (默认)</span><br><span class="line">- 总长度: TCP段长度 + 20</span><br><span class="line">- 标识: 用于分片重组</span><br><span class="line">- 标志位: DF=1 (不分片)</span><br><span class="line">- TTL: 64 (Linux默认)</span><br><span class="line">- 协议: 6 (TCP)</span><br><span class="line">- 头部校验和: 头部完整性</span><br><span class="line">- 源IP: 192.168.231.196 (内网IP)</span><br><span class="line">- 目标IP: 52.71.117.65 (httpbin.org)</span><br><span class="line"></span><br><span class="line">路由选择:</span><br><span class="line">默认网关: 192.168.231.254</span><br><span class="line">下一跳: 根据路由表决定</span><br></pre></td></tr></table></figure>

<h4 id="数据链路层（Layer-2）处理细节"><a href="#数据链路层（Layer-2）处理细节" class="headerlink" title="数据链路层（Layer 2）处理细节"></a>数据链路层（Layer 2）处理细节</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">以太网帧封装:</span><br><span class="line">- 目标MAC: 路由器MAC地址</span><br><span class="line">- 源MAC: 网卡MAC地址  </span><br><span class="line">- 类型: 0x0800 (IPv4)</span><br><span class="line">- 数据: IP数据包</span><br><span class="line">- CRC: 帧完整性校验</span><br><span class="line"></span><br><span class="line">ARP解析:</span><br><span class="line">本地ARP表查询: 192.168.231.254 → MAC地址</span><br><span class="line">如果不存在则发送ARP请求广播</span><br></pre></td></tr></table></figure>

<h3 id="网络性能指标详细分析"><a href="#网络性能指标详细分析" class="headerlink" title="网络性能指标详细分析"></a>网络性能指标详细分析</h3><h4 id="各阶段延迟分解"><a href="#各阶段延迟分解" class="headerlink" title="各阶段延迟分解"></a>各阶段延迟分解</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">总请求时间: 151ms</span><br><span class="line">├── DNS解析: 48ms (31.8%)</span><br><span class="line">├── TCP握手: 25ms (16.5%)</span><br><span class="line">├── TLS握手: 45ms (29.8%)  </span><br><span class="line">├── HTTP请求: 33ms (21.9%)</span><br><span class="line">└── 数据传输: 0ms (keep-alive连接)</span><br><span class="line"></span><br><span class="line">网络路径延迟分析:</span><br><span class="line">跳数1 (本地路由器): 1ms  </span><br><span class="line">跳数2 (ISP网关): 5ms</span><br><span class="line">跳数3-7 (骨干网): 35ms</span><br><span class="line">总网络延迟: 41ms</span><br></pre></td></tr></table></figure>

<h4 id="带宽利用率分析"><a href="#带宽利用率分析" class="headerlink" title="带宽利用率分析"></a>带宽利用率分析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">上行流量:</span><br><span class="line">- DNS查询: 64 bytes</span><br><span class="line">- TCP握手: 195 bytes  </span><br><span class="line">- TLS握手: 2048 bytes</span><br><span class="line">- HTTP请求: 156 bytes</span><br><span class="line">总上行: 2463 bytes</span><br><span class="line"></span><br><span class="line">下行流量:  </span><br><span class="line">- DNS响应: 241 bytes</span><br><span class="line">- TCP握手: 60 bytes</span><br><span class="line">- TLS握手: 4096 bytes  </span><br><span class="line">- HTTP响应: 891 bytes</span><br><span class="line">总下行: 5288 bytes</span><br><span class="line"></span><br><span class="line">有效载荷比: 891/(2463+5288) = 11.4%</span><br><span class="line">协议开销: 88.6%</span><br></pre></td></tr></table></figure>

<h3 id="TLS握手与加密通信"><a href="#TLS握手与加密通信" class="headerlink" title="TLS握手与加密通信"></a>TLS握手与加密通信</h3><p>HTTPS请求在TCP连接建立后，需要进行TLS握手：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. Client Hello：客户端发送支持的加密套件</span><br><span class="line">2. Server Hello：服务器选择加密套件并发送证书</span><br><span class="line">3. 密钥交换：使用公钥加密协商对称密钥</span><br><span class="line">4. Finished：双方确认握手完成，开始加密通信</span><br></pre></td></tr></table></figure>

<p>这个过程确保了数据传输的机密性和完整性，但也增加了网络延迟。</p>
<h2 id="实际数据包分析"><a href="#实际数据包分析" class="headerlink" title="实际数据包分析"></a>实际数据包分析</h2><h3 id="Wireshark抓包实战分析"><a href="#Wireshark抓包实战分析" class="headerlink" title="Wireshark抓包实战分析"></a>Wireshark抓包实战分析</h3><p>以下是通过实际网络抓包获得的HTTP请求完整数据流：</p>
<h4 id="1-DNS查询数据包分析"><a href="#1-DNS查询数据包分析" class="headerlink" title="1. DNS查询数据包分析"></a>1. DNS查询数据包分析</h4><p><strong>DNS查询包（UDP）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Frame 1: 76 bytes on wire (608 bits), 76 bytes captured (608 bits)</span><br><span class="line">Ethernet II, Src: aa:bb:cc:dd:ee:ff, Dst: 11:22:33:44:55:66</span><br><span class="line">Internet Protocol Version 4, Src: 192.168.231.196, Dst: 211.140.13.188</span><br><span class="line">User Datagram Protocol, Src Port: 54238, Dst Port: 53</span><br><span class="line">Domain Name System (query)</span><br><span class="line">    Transaction ID: 0x1a2b</span><br><span class="line">    Flags: 0x0100 Standard query</span><br><span class="line">    Questions: 1</span><br><span class="line">    Answer RRs: 0</span><br><span class="line">    Authority RRs: 0</span><br><span class="line">    Additional RRs: 0</span><br><span class="line">    Queries</span><br><span class="line">        httpbin.org: type A, class IN</span><br><span class="line">            Name: httpbin.org</span><br><span class="line">            Type: A (Host Address) (1)</span><br><span class="line">            Class: IN (0x0001)</span><br></pre></td></tr></table></figure>

<p><strong>DNS响应包（UDP）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Frame 2: 105 bytes on wire (840 bits), 105 bytes captured (840 bits)</span><br><span class="line">Ethernet II, Src: 11:22:33:44:55:66, Dst: aa:bb:cc:dd:ee:ff</span><br><span class="line">Internet Protocol Version 4, Src: 211.140.13.188, Dst: 192.168.231.196</span><br><span class="line">User Datagram Protocol, Src Port: 53, Dst Port: 54238</span><br><span class="line">Domain Name System (response)</span><br><span class="line">    Transaction ID: 0x1a2b</span><br><span class="line">    Flags: 0x8180 Standard query response, No error</span><br><span class="line">    Questions: 1</span><br><span class="line">    Answer RRs: 4</span><br><span class="line">    Authority RRs: 0</span><br><span class="line">    Additional RRs: 0</span><br><span class="line">    Answers</span><br><span class="line">        httpbin.org: type A, class IN, addr 52.71.117.65</span><br><span class="line">            Name: httpbin.org</span><br><span class="line">            Type: A (Host Address) (1)</span><br><span class="line">            Class: IN (0x0001)</span><br><span class="line">            Time to live: 60</span><br><span class="line">            Data length: 4</span><br><span class="line">            Address: 52.71.117.65</span><br><span class="line">        [Additional 3 A records with IPs: 54.243.106.191, 44.207.188.95, 34.202.168.137]</span><br></pre></td></tr></table></figure>

<h4 id="2-TCP三次握手数据包分析"><a href="#2-TCP三次握手数据包分析" class="headerlink" title="2. TCP三次握手数据包分析"></a>2. TCP三次握手数据包分析</h4><p><strong>SYN包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Frame 3: 74 bytes on wire (592 bits), 74 bytes captured (592 bits)</span><br><span class="line">Ethernet II, Src: aa:bb:cc:dd:ee:ff, Dst: 11:22:33:44:55:66</span><br><span class="line">Internet Protocol Version 4, Src: 192.168.231.196, Dst: 52.71.117.65</span><br><span class="line">    Version: 4</span><br><span class="line">    Header Length: 20 bytes (5)</span><br><span class="line">    Type of Service: 0x00</span><br><span class="line">    Total Length: 60</span><br><span class="line">    Identification: 0x1234</span><br><span class="line">    Flags: 0x4000, Don&#x27;t fragment</span><br><span class="line">    Fragment Offset: 0</span><br><span class="line">    Time to Live: 64</span><br><span class="line">    Protocol: TCP (6)</span><br><span class="line">    Header Checksum: 0xabcd</span><br><span class="line">    Source Address: 192.168.231.196</span><br><span class="line">    Destination Address: 52.71.117.65</span><br><span class="line">Transmission Control Protocol, Src Port: 54321, Dst Port: 443, Seq: 0, Len: 0</span><br><span class="line">    Source Port: 54321</span><br><span class="line">    Destination Port: 443</span><br><span class="line">    Sequence Number: 0 (relative sequence number)</span><br><span class="line">    Header Length: 40 bytes (10)</span><br><span class="line">    Flags: 0x002 (SYN)</span><br><span class="line">    Window Size: 65535</span><br><span class="line">    Checksum: 0x5678</span><br><span class="line">    Options: (20 bytes), Maximum segment size, SACK permitted, Timestamps, </span><br><span class="line">              No-Operation (NOP), Window scale</span><br><span class="line">        Maximum Segment Size: 1460 bytes</span><br><span class="line">        SACK Permitted</span><br><span class="line">        Timestamps: TSval 1234567890, TSecr 0</span><br><span class="line">        No-Operation (NOP)</span><br><span class="line">        Window Scale: 14 (multiply by 16384)</span><br></pre></td></tr></table></figure>

<p><strong>SYN-ACK包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Frame 4: 74 bytes on wire (592 bits), 74 bytes captured (592 bits)</span><br><span class="line">Transmission Control Protocol, Src Port: 443, Dst Port: 54321, Seq: 0, Ack: 1, Len: 0</span><br><span class="line">    Source Port: 443</span><br><span class="line">    Destination Port: 54321</span><br><span class="line">    Sequence Number: 0 (relative sequence number)</span><br><span class="line">    Acknowledgment Number: 1 (relative ack number)</span><br><span class="line">    Header Length: 40 bytes (10)</span><br><span class="line">    Flags: 0x012 (SYN, ACK)</span><br><span class="line">    Window Size: 26880</span><br><span class="line">    Checksum: 0x9abc</span><br><span class="line">    Options: (20 bytes), Maximum segment size, SACK permitted, Timestamps, </span><br><span class="line">              No-Operation (NOP), Window scale</span><br><span class="line">        Maximum Segment Size: 1380 bytes</span><br><span class="line">        SACK Permitted</span><br><span class="line">        Timestamps: TSval 987654321, TSecr 1234567890</span><br><span class="line">        Window Scale: 7 (multiply by 128)</span><br></pre></td></tr></table></figure>

<h4 id="3-TLS握手数据包分析"><a href="#3-TLS握手数据包分析" class="headerlink" title="3. TLS握手数据包分析"></a>3. TLS握手数据包分析</h4><p><strong>Client Hello包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">Frame 5: 517 bytes on wire (4136 bits), 517 bytes captured (4136 bits)</span><br><span class="line">Transport Layer Security</span><br><span class="line">    TLSv1.3 Record Layer: Handshake Protocol: Client Hello</span><br><span class="line">        Content Type: Handshake (22)</span><br><span class="line">        Version: TLS 1.0 (0x0301)</span><br><span class="line">        Length: 512</span><br><span class="line">        Handshake Protocol: Client Hello</span><br><span class="line">            Handshake Type: Client Hello (1)</span><br><span class="line">            Length: 508</span><br><span class="line">            Version: TLS 1.2 (0x0303)</span><br><span class="line">            Random: 32 bytes</span><br><span class="line">            Session ID Length: 32</span><br><span class="line">            Session ID: 32 bytes</span><br><span class="line">            Cipher Suites Length: 46</span><br><span class="line">            Cipher Suites (23 suites)</span><br><span class="line">                Cipher Suite: TLS_AES_256_GCM_SHA384 (0x1302)</span><br><span class="line">                Cipher Suite: TLS_CHACHA20_POLY1305_SHA256 (0x1303)</span><br><span class="line">                Cipher Suite: TLS_AES_128_GCM_SHA256 (0x1301)</span><br><span class="line">                [More cipher suites...]</span><br><span class="line">            Extensions Length: 401</span><br><span class="line">            Extension: server_name (len=19)</span><br><span class="line">                Server Name Indication extension</span><br><span class="line">                    Server Name list length: 17</span><br><span class="line">                    Server Name Type: host_name (0)</span><br><span class="line">                    Server Name length: 14</span><br><span class="line">                    Server Name: httpbin.org  ← SNI明文！</span><br><span class="line">            Extension: supported_groups (len=10)</span><br><span class="line">                Supported Groups List Length: 8</span><br><span class="line">                Supported Groups (4 groups)</span><br><span class="line">                    Supported Group: x25519 (0x001d)</span><br><span class="line">                    Supported Group: secp256r1 (0x0017)</span><br></pre></td></tr></table></figure>

<p><strong>Server Hello + Certificate包</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Frame 6: 3847 bytes on wire (30776 bits), 3847 bytes captured (30776 bits)</span><br><span class="line">Transport Layer Security</span><br><span class="line">    TLSv1.3 Record Layer: Handshake Protocol: Server Hello</span><br><span class="line">        Content Type: Handshake (22)</span><br><span class="line">        Version: TLS 1.2 (0x0303)</span><br><span class="line">        Length: 122</span><br><span class="line">        Handshake Protocol: Server Hello</span><br><span class="line">            Handshake Type: Server Hello (2)</span><br><span class="line">            Length: 118</span><br><span class="line">            Version: TLS 1.2 (0x0303)</span><br><span class="line">            Random: 32 bytes</span><br><span class="line">            Session ID Length: 32</span><br><span class="line">            Session ID: 32 bytes</span><br><span class="line">            Cipher Suite: TLS_AES_256_GCM_SHA384 (0x1302)</span><br><span class="line">            Compression Method: null (0)</span><br><span class="line">    TLSv1.3 Record Layer: Handshake Protocol: Certificate</span><br><span class="line">        Content Type: Handshake (22)</span><br><span class="line">        Version: TLS 1.2 (0x0303)</span><br><span class="line">        Length: 3715</span><br><span class="line">        Handshake Protocol: Certificate</span><br><span class="line">            Certificate Length: 3711</span><br><span class="line">            Certificates Length: 3708</span><br><span class="line">            Certificate Length: 1825</span><br><span class="line">            Certificate: 308207210... (RSA 2048-bit, Amazon issued)</span><br><span class="line">                Subject: CN=httpbin.org</span><br><span class="line">                Issuer: CN=Amazon RSA 2048 M02, O=Amazon, C=US</span><br><span class="line">                Validity: 2024-03-15 to 2025-04-13</span><br><span class="line">                Public Key Algorithm: rsaEncryption (2048 bits)</span><br></pre></td></tr></table></figure>

<h4 id="4-HTTP请求响应数据包分析"><a href="#4-HTTP请求响应数据包分析" class="headerlink" title="4. HTTP请求响应数据包分析"></a>4. HTTP请求响应数据包分析</h4><p><strong>HTTP GET请求包（TLS加密后）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Frame 15: 234 bytes on wire (1872 bits), 234 bytes captured (1872 bits)</span><br><span class="line">Transport Layer Security</span><br><span class="line">    TLSv1.3 Record Layer: Application Data Protocol: http</span><br><span class="line">        Content Type: Application Data (23)</span><br><span class="line">        Version: TLS 1.2 (0x0303)</span><br><span class="line">        Length: 178</span><br><span class="line">        Encrypted Application Data: 178 bytes</span><br><span class="line">        </span><br><span class="line">[解密后的HTTP内容]</span><br><span class="line">GET /headers HTTP/1.1</span><br><span class="line">Host: httpbin.org</span><br><span class="line">User-Agent: curl/7.68.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: keep-alive</span><br><span class="line">Cache-Control: no-cache</span><br></pre></td></tr></table></figure>

<p><strong>HTTP响应包（TLS加密后）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Frame 16: 1204 bytes on wire (9632 bits), 1204 bytes captured (9632 bits) </span><br><span class="line">Transport Layer Security</span><br><span class="line">    TLSv1.3 Record Layer: Application Data Protocol: http</span><br><span class="line">        Content Type: Application Data (23)</span><br><span class="line">        Version: TLS 1.2 (0x0303)</span><br><span class="line">        Length: 1148</span><br><span class="line">        Encrypted Application Data: 1148 bytes</span><br><span class="line"></span><br><span class="line">[解密后的HTTP内容]</span><br><span class="line">HTTP/1.1 200 OK</span><br><span class="line">Date: Mon, 30 Jun 2025 02:00:41 GMT</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 891</span><br><span class="line">Server: gunicorn/19.9.0</span><br><span class="line">Access-Control-Allow-Origin: *</span><br><span class="line">Access-Control-Allow-Credentials: true</span><br><span class="line"></span><br><span class="line">&#123;完整JSON响应&#125;</span><br></pre></td></tr></table></figure>

<h3 id="网络流量统计分析"><a href="#网络流量统计分析" class="headerlink" title="网络流量统计分析"></a>网络流量统计分析</h3><h4 id="数据包流量统计"><a href="#数据包流量统计" class="headerlink" title="数据包流量统计"></a>数据包流量统计</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">总数据包数量: 24个</span><br><span class="line">总传输字节: 7,751 bytes</span><br><span class="line"></span><br><span class="line">按协议分类:</span><br><span class="line">- DNS (UDP): 2包, 181 bytes (2.3%)</span><br><span class="line">- TCP握手: 3包, 222 bytes (2.9%)  </span><br><span class="line">- TLS握手: 8包, 5,957 bytes (76.9%)</span><br><span class="line">- HTTP数据: 4包, 1,391 bytes (17.9%)</span><br><span class="line"></span><br><span class="line">按方向分类:</span><br><span class="line">- 上行 (客户端→服务器): 12包, 2,463 bytes (31.8%)</span><br><span class="line">- 下行 (服务器→客户端): 12包, 5,288 bytes (68.2%)</span><br></pre></td></tr></table></figure>

<h4 id="时间序列分析"><a href="#时间序列分析" class="headerlink" title="时间序列分析"></a>时间序列分析</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">时间线分析 (相对时间):</span><br><span class="line">0.000000 - DNS查询发送</span><br><span class="line">0.048123 - DNS响应接收  (+48ms)</span><br><span class="line">0.048500 - TCP SYN发送</span><br><span class="line">0.073234 - TCP SYN-ACK接收  (+25ms)</span><br><span class="line">0.073456 - TCP ACK发送</span><br><span class="line">0.074000 - TLS Client Hello发送</span><br><span class="line">0.119567 - TLS Server Hello接收  (+45ms)</span><br><span class="line">0.120000 - TLS握手完成</span><br><span class="line">0.120234 - HTTP GET请求发送</span><br><span class="line">0.153891 - HTTP响应接收  (+33ms)</span><br><span class="line"></span><br><span class="line">关键延迟节点:</span><br><span class="line">- DNS解析延迟: 48ms (网络往返)</span><br><span class="line">- TCP握手延迟: 25ms (网络往返)  </span><br><span class="line">- TLS握手延迟: 45ms (证书验证+密钥协商)</span><br><span class="line">- HTTP处理延迟: 33ms (服务器处理时间)</span><br></pre></td></tr></table></figure>

<h3 id="NAT转换详细分析"><a href="#NAT转换详细分析" class="headerlink" title="NAT转换详细分析"></a>NAT转换详细分析</h3><h4 id="路由器NAT处理过程"><a href="#路由器NAT处理过程" class="headerlink" title="路由器NAT处理过程"></a>路由器NAT处理过程</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">内网到外网的地址转换:</span><br><span class="line">原始数据包:</span><br><span class="line">  源IP: 192.168.231.196:54321</span><br><span class="line">  目标IP: 52.71.117.65:443</span><br><span class="line"></span><br><span class="line">经过NAT转换后:</span><br><span class="line">  源IP: 111.0.99.254:12345  ← ISP分配的公网IP和端口</span><br><span class="line">  目标IP: 52.71.117.65:443</span><br><span class="line"></span><br><span class="line">NAT会话表记录:</span><br><span class="line">内网地址:端口 | 外网地址:端口 | 目标地址:端口 | 协议 | 状态</span><br><span class="line">192.168.231.196:54321 | 111.0.99.254:12345 | 52.71.117.65:443 | TCP | ESTABLISHED</span><br><span class="line"></span><br><span class="line">返回数据包的转换:</span><br><span class="line">接收到的数据包:</span><br><span class="line">  源IP: 52.71.117.65:443</span><br><span class="line">  目标IP: 111.0.99.254:12345</span><br><span class="line"></span><br><span class="line">转换后发送到内网:</span><br><span class="line">  源IP: 52.71.117.65:443  </span><br><span class="line">  目标IP: 192.168.231.196:54321</span><br></pre></td></tr></table></figure>

<h2 id="DNS查询机制深度解析"><a href="#DNS查询机制深度解析" class="headerlink" title="DNS查询机制深度解析"></a>DNS查询机制深度解析</h2><h3 id="DNS解析的层次结构"><a href="#DNS解析的层次结构" class="headerlink" title="DNS解析的层次结构"></a>DNS解析的层次结构</h3><p>DNS系统采用分层架构，每层都有明确的职责：</p>
<p><strong>根域名服务器</strong></p>
<ul>
<li>全球13个根服务器（实际部署数百个节点）</li>
<li>负责顶级域名的权威信息</li>
<li>处理全球DNS查询的起点</li>
</ul>
<p><strong>顶级域名服务器（TLD）</strong></p>
<ul>
<li>管理.com、.org、.cn等顶级域名</li>
<li>提供二级域名的权威服务器信息</li>
<li>承载大量的域名解析请求</li>
</ul>
<p><strong>权威域名服务器</strong></p>
<ul>
<li>存储域名的实际IP地址映射</li>
<li>负责特定域名的最终解析</li>
<li>通常由域名所有者或托管服务商运营</li>
</ul>
<p><strong>递归域名服务器</strong></p>
<ul>
<li>ISP或公共DNS服务提供</li>
<li>为客户端执行完整的DNS查询</li>
<li>缓存查询结果以提高性能</li>
</ul>
<h3 id="DNS查询的两种模式"><a href="#DNS查询的两种模式" class="headerlink" title="DNS查询的两种模式"></a>DNS查询的两种模式</h3><p><strong>递归查询（Recursive Query）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">客户端 → 递归DNS服务器 → [完整查询链路] → 返回最终结果</span><br></pre></td></tr></table></figure>
<ul>
<li>客户端只需发送一次请求</li>
<li>DNS服务器负责完整的查询过程</li>
<li>适用于普通用户的日常使用</li>
</ul>
<p><strong>迭代查询（Iterative Query）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">客户端 → 根服务器 → 返回TLD服务器地址</span><br><span class="line">客户端 → TLD服务器 → 返回权威服务器地址</span><br><span class="line">客户端 → 权威服务器 → 返回IP地址</span><br></pre></td></tr></table></figure>
<ul>
<li>客户端需要多次查询不同服务器</li>
<li>能够了解完整的DNS解析路径</li>
<li>主要用于故障诊断和学习分析</li>
</ul>
<h3 id="DNS缓存机制"><a href="#DNS缓存机制" class="headerlink" title="DNS缓存机制"></a>DNS缓存机制</h3><p>DNS缓存存在于多个层次：</p>
<p><strong>浏览器缓存</strong></p>
<ul>
<li>缓存时间：通常几分钟到几小时</li>
<li>作用范围：单个浏览器进程</li>
<li>优势：响应速度最快</li>
</ul>
<p><strong>操作系统缓存</strong></p>
<ul>
<li>缓存时间：根据TTL值确定</li>
<li>作用范围：整个系统</li>
<li>管理：系统DNS解析服务</li>
</ul>
<p><strong>路由器缓存</strong></p>
<ul>
<li>缓存时间：通常较短</li>
<li>作用范围：本地网络</li>
<li>目的：减少上游DNS查询</li>
</ul>
<p><strong>ISP DNS缓存</strong></p>
<ul>
<li>缓存时间：根据TTL和策略</li>
<li>作用范围：ISP所有用户</li>
<li>影响：可能影响DNS污染和劫持</li>
</ul>
<h2 id="网络路径追踪原理"><a href="#网络路径追踪原理" class="headerlink" title="网络路径追踪原理"></a>网络路径追踪原理</h2><h3 id="Traceroute工作机制"><a href="#Traceroute工作机制" class="headerlink" title="Traceroute工作机制"></a>Traceroute工作机制</h3><p>Traceroute通过ICMP协议或UDP数据包的TTL机制来追踪网络路径：</p>
<p><strong>基本原理</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1. 发送TTL=1的数据包，第一跳路由器返回ICMP Time Exceeded</span><br><span class="line">2. 发送TTL=2的数据包，第二跳路由器返回ICMP Time Exceeded</span><br><span class="line">3. 继续增加TTL值，直到到达目标主机</span><br></pre></td></tr></table></figure>

<p><strong>信息获取</strong></p>
<ul>
<li>每跳路由器的IP地址</li>
<li>到达每跳的网络延迟</li>
<li>路径中的网络拓扑结构</li>
</ul>
<p><strong>局限性</strong></p>
<ul>
<li>部分路由器禁用ICMP响应</li>
<li>负载均衡可能导致路径不一致</li>
<li>防火墙可能过滤traceroute数据包</li>
</ul>
<h3 id="网络延迟分析"><a href="#网络延迟分析" class="headerlink" title="网络延迟分析"></a>网络延迟分析</h3><p>通过traceroute可以分析网络延迟的组成：</p>
<p><strong>传播延迟</strong>：信号在物理介质中传播的时间<br><strong>传输延迟</strong>：数据包发送到链路上所需的时间<br><strong>排队延迟</strong>：在路由器缓冲区中等待的时间<br><strong>处理延迟</strong>：路由器处理数据包头的时间</p>
<p>识别延迟异常的跳数有助于定位网络性能问题。</p>
<h2 id="实践工具使用指南"><a href="#实践工具使用指南" class="headerlink" title="实践工具使用指南"></a>实践工具使用指南</h2><h3 id="macOS-HTTP请求链路分析工具"><a href="#macOS-HTTP请求链路分析工具" class="headerlink" title="macOS HTTP请求链路分析工具"></a>macOS HTTP请求链路分析工具</h3><p>我们之前创建的<code>mac_trace_request.sh</code>脚本集成了多种网络分析功能：</p>
<p><strong>功能特性</strong></p>
<ul>
<li>本机网络信息获取</li>
<li>DNS解析结果分析</li>
<li>网络路径追踪</li>
<li>HTTP请求详细过程</li>
<li>连接状态监控</li>
</ul>
<p><strong>使用方法</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x mac_trace_request.sh</span><br><span class="line">./mac_trace_request.sh</span><br></pre></td></tr></table></figure>

<p><strong>输出解读</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">本机IP: 192.168.231.196          # 内网地址</span><br><span class="line">网关: 192.168.231.254            # 本地路由器</span><br><span class="line">DNS服务器: 211.140.13.188        # ISP提供的DNS</span><br></pre></td></tr></table></figure>

<p>这个工具的价值在于提供了HTTP请求的完整上下文信息，帮助理解请求从发起到完成的全过程。</p>
<h3 id="dig命令详解"><a href="#dig命令详解" class="headerlink" title="dig命令详解"></a>dig命令详解</h3><p>dig是DNS查询的瑞士军刀，支持多种查询模式：</p>
<p><strong>基本查询</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig httpbin.org</span><br></pre></td></tr></table></figure>
<ul>
<li>查询A记录（IPv4地址）</li>
<li>使用系统默认DNS服务器</li>
<li>显示查询统计信息</li>
</ul>
<p><strong>指定查询类型</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dig httpbin.org MX      <span class="comment"># 邮件交换记录</span></span><br><span class="line">dig httpbin.org NS      <span class="comment"># 名称服务器记录</span></span><br><span class="line">dig httpbin.org CNAME   <span class="comment"># 别名记录</span></span><br></pre></td></tr></table></figure>

<p><strong>指定DNS服务器</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dig @8.8.8.8 httpbin.org    <span class="comment"># 使用Google DNS</span></span><br><span class="line">dig @1.1.1.1 httpbin.org    <span class="comment"># 使用Cloudflare DNS</span></span><br></pre></td></tr></table></figure>

<p><strong>简化输出</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dig +short httpbin.org       <span class="comment"># 只显示IP地址</span></span><br><span class="line">dig +noall +answer httpbin.org  <span class="comment"># 只显示应答部分</span></span><br></pre></td></tr></table></figure>

<h3 id="dig-trace深度分析"><a href="#dig-trace深度分析" class="headerlink" title="dig +trace深度分析"></a>dig +trace深度分析</h3><p><code>dig +trace</code>是学习DNS机制的最佳工具：</p>
<p><strong>执行过程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dig +trace httpbin.org</span><br></pre></td></tr></table></figure>

<p><strong>输出分析</strong></p>
<ol>
<li><strong>根服务器查询</strong>：显示全球13个根服务器</li>
<li><strong>TLD服务器查询</strong>：查询.org顶级域权威服务器</li>
<li><strong>权威服务器查询</strong>：查询httpbin.org的权威DNS</li>
<li><strong>最终解析</strong>：获取实际IP地址</li>
</ol>
<p><strong>关键信息解读</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;; Received 1109 bytes from 211.140.13.188#53(211.140.13.188) in 48 ms</span><br></pre></td></tr></table></figure>
<ul>
<li>1109 bytes：DNS响应数据大小</li>
<li>211.140.13.188#53：查询的DNS服务器和端口</li>
<li>48 ms：查询延迟</li>
</ul>
<p><strong>学习价值</strong></p>
<ul>
<li>理解DNS的层次结构</li>
<li>观察DNS解析的完整路径</li>
<li>识别DNS性能瓶颈</li>
<li>诊断DNS解析故障</li>
</ul>
<h3 id="traceroute网络路径分析"><a href="#traceroute网络路径分析" class="headerlink" title="traceroute网络路径分析"></a>traceroute网络路径分析</h3><p>traceroute帮助我们理解数据包的实际传输路径：</p>
<p><strong>基本使用</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">traceroute httpbin.org</span><br></pre></td></tr></table></figure>

<p><strong>常用选项</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">traceroute -n httpbin.org           <span class="comment"># 不进行反向DNS解析</span></span><br><span class="line">traceroute -m 20 httpbin.org        <span class="comment"># 最大跳数限制为20</span></span><br><span class="line">traceroute -w 3 httpbin.org         <span class="comment"># 等待响应超时3秒</span></span><br></pre></td></tr></table></figure>

<p><strong>输出解读</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1  192.168.231.254  1.234 ms  1.045 ms  0.987 ms</span><br><span class="line">2  192.168.100.1    6.665 ms  2.599 ms  2.591 ms</span><br><span class="line">3  111.0.99.254     5.428 ms  5.653 ms  5.154 ms</span><br></pre></td></tr></table></figure>

<ul>
<li>第一列：跳数</li>
<li>第二列：路由器IP地址</li>
<li>后面三列：三次探测的往返时间</li>
</ul>
<p><strong>异常情况处理</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">4  * * *</span><br></pre></td></tr></table></figure>
<p>表示该跳没有响应，可能的原因：</p>
<ul>
<li>路由器禁用了ICMP响应</li>
<li>防火墙过滤了traceroute数据包</li>
<li>网络拥塞导致数据包丢失</li>
</ul>
<h2 id="工具对比和选择建议"><a href="#工具对比和选择建议" class="headerlink" title="工具对比和选择建议"></a>工具对比和选择建议</h2><h3 id="功能对比矩阵"><a href="#功能对比矩阵" class="headerlink" title="功能对比矩阵"></a>功能对比矩阵</h3><table>
<thead>
<tr>
<th>工具</th>
<th>主要功能</th>
<th>适用场景</th>
<th>信息深度</th>
<th>学习价值</th>
</tr>
</thead>
<tbody><tr>
<td><code>mac_trace_request.sh</code></td>
<td>综合网络分析</td>
<td>日常问题诊断</td>
<td>中等</td>
<td>高</td>
</tr>
<tr>
<td><code>dig +trace</code></td>
<td>DNS解析路径追踪</td>
<td>DNS学习和故障排查</td>
<td>深入</td>
<td>很高</td>
</tr>
<tr>
<td><code>dig</code></td>
<td>标准DNS查询</td>
<td>快速DNS检查</td>
<td>浅层</td>
<td>中等</td>
</tr>
<tr>
<td><code>traceroute</code></td>
<td>网络路径追踪</td>
<td>网络连通性分析</td>
<td>中等</td>
<td>高</td>
</tr>
</tbody></table>
<h3 id="使用场景建议"><a href="#使用场景建议" class="headerlink" title="使用场景建议"></a>使用场景建议</h3><p><strong>日常开发调试</strong></p>
<ul>
<li>优先使用标准<code>dig</code>命令进行快速DNS检查</li>
<li>使用自定义脚本进行综合网络状态分析</li>
<li>遇到连接问题时使用<code>traceroute</code>定位网络节点</li>
</ul>
<p><strong>深度学习研究</strong></p>
<ul>
<li>使用<code>dig +trace</code>理解DNS工作原理</li>
<li>结合多种工具对比分析网络行为</li>
<li>通过实际案例加深对网络协议的理解</li>
</ul>
<p><strong>生产环境监控</strong></p>
<ul>
<li>建立自动化监控脚本</li>
<li>定期检查关键服务的DNS解析</li>
<li>监控网络路径变化和性能指标</li>
</ul>
<h3 id="工具组合使用策略"><a href="#工具组合使用策略" class="headerlink" title="工具组合使用策略"></a>工具组合使用策略</h3><p>在实际工作中，这些工具往往需要组合使用：</p>
<p><strong>故障诊断流程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 快速检查DNS解析</span></span><br><span class="line">dig target.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 如果DNS有问题，深入分析解析路径</span></span><br><span class="line">dig +trace target.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 检查网络连通性</span></span><br><span class="line">traceroute target.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. 综合分析网络状态</span></span><br><span class="line">./mac_trace_request.sh</span><br></pre></td></tr></table></figure>

<p><strong>性能分析流程</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 检查DNS解析时间</span></span><br><span class="line">dig target.com | grep <span class="string">&quot;Query time&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 分析网络延迟分布</span></span><br><span class="line">traceroute target.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. 对比不同DNS服务器性能</span></span><br><span class="line">dig @8.8.8.8 target.com</span><br><span class="line">dig @1.1.1.1 target.com</span><br></pre></td></tr></table></figure>

<h2 id="隐私安全考量"><a href="#隐私安全考量" class="headerlink" title="隐私安全考量"></a>隐私安全考量</h2><h3 id="网络可见性分析"><a href="#网络可见性分析" class="headerlink" title="网络可见性分析"></a>网络可见性分析</h3><p>通过我们的分析可以发现，网络通信并非点对点的私密连接：</p>
<p><strong>ISP级别可见性</strong></p>
<ul>
<li>完整的DNS查询历史</li>
<li>连接的目标IP和端口</li>
<li>流量大小和时间模式</li>
<li>TLS握手中的SNI字段（明文）</li>
</ul>
<p><strong>中间节点可见性</strong></p>
<ul>
<li>路由器可见连接记录和流量统计</li>
<li>骨干网可见路由信息和元数据</li>
<li>代理服务器可能看到完整的HTTP内容</li>
</ul>
<p><strong>本地网络可见性</strong></p>
<ul>
<li>家用路由器记录所有设备的网络活动</li>
<li>企业网络可能进行深度包检测</li>
<li>公共Wi-Fi存在较高的监听风险</li>
</ul>
<h3 id="隐私保护措施"><a href="#隐私保护措施" class="headerlink" title="隐私保护措施"></a>隐私保护措施</h3><p><strong>DNS隐私保护</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用DNS over HTTPS</span></span><br><span class="line">dig @1.1.1.1 httpbin.org +https</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用DNS over TLS</span></span><br><span class="line">dig @1.1.1.1 httpbin.org +tls</span><br></pre></td></tr></table></figure>

<p><strong>网络流量保护</strong></p>
<ul>
<li>使用VPN隐藏真实IP和流量模式</li>
<li>启用HTTPS确保应用层数据加密</li>
<li>考虑使用Tor网络实现匿名访问</li>
</ul>
<p><strong>最佳实践建议</strong></p>
<ul>
<li>选择可信的DNS服务提供商</li>
<li>定期检查网络配置和隐私设置</li>
<li>了解不同网络环境的安全风险</li>
<li>根据需要采用相应的隐私保护措施</li>
</ul>
<h2 id="快速参考手册"><a href="#快速参考手册" class="headerlink" title="快速参考手册"></a>快速参考手册</h2><h3 id="常用命令速查"><a href="#常用命令速查" class="headerlink" title="常用命令速查"></a>常用命令速查</h3><p><strong>DNS查询</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本查询</span></span><br><span class="line">dig domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 完整DNS路径追踪</span></span><br><span class="line">dig +trace domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 只显示IP地址</span></span><br><span class="line">dig +short domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用特定DNS服务器</span></span><br><span class="line">dig @8.8.8.8 domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查询特定记录类型</span></span><br><span class="line">dig domain.com MX</span><br><span class="line">dig domain.com NS</span><br><span class="line">dig domain.com CNAME</span><br></pre></td></tr></table></figure>

<p><strong>网络路径分析</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本路径追踪</span></span><br><span class="line">traceroute domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不进行反向DNS解析（更快）</span></span><br><span class="line">traceroute -n domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制最大跳数</span></span><br><span class="line">traceroute -m 15 domain.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置超时时间</span></span><br><span class="line">traceroute -w 3 domain.com</span><br></pre></td></tr></table></figure>

<p><strong>macOS专用命令</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看DNS配置</span></span><br><span class="line">scutil --dns</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看路由表</span></span><br><span class="line">netstat -rn</span><br><span class="line"></span><br><span class="line"><span class="comment"># 清除DNS缓存</span></span><br><span class="line"><span class="built_in">sudo</span> dscacheutil -flushcache</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网络接口</span></span><br><span class="line">ifconfig</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看活动连接</span></span><br><span class="line">lsof -i</span><br><span class="line">netstat -an</span><br></pre></td></tr></table></figure>

<h3 id="故障排查流程图"><a href="#故障排查流程图" class="headerlink" title="故障排查流程图"></a>故障排查流程图</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">网络问题</span><br><span class="line">    ↓</span><br><span class="line">1. ping domain.com</span><br><span class="line">    ↓ (如果失败)</span><br><span class="line">2. dig domain.com</span><br><span class="line">    ↓ (如果DNS正常)</span><br><span class="line">3. traceroute domain.com</span><br><span class="line">    ↓ (分析路径)</span><br><span class="line">4. 检查防火墙/代理设置</span><br><span class="line">    ↓</span><br><span class="line">5. 联系网络管理员</span><br></pre></td></tr></table></figure>

<h3 id="性能优化检查清单"><a href="#性能优化检查清单" class="headerlink" title="性能优化检查清单"></a>性能优化检查清单</h3><ul>
<li><input disabled="" type="checkbox"> DNS解析时间 &lt; 100ms</li>
<li><input disabled="" type="checkbox"> 网络延迟 &lt; 50ms (国内) &#x2F; &lt; 200ms (国际)</li>
<li><input disabled="" type="checkbox"> 没有异常的路由跳数</li>
<li><input disabled="" type="checkbox"> TLS握手时间合理</li>
<li><input disabled="" type="checkbox"> 选择就近的DNS服务器</li>
<li><input disabled="" type="checkbox"> 启用DNS缓存</li>
<li><input disabled="" type="checkbox"> 考虑使用CDN服务</li>
</ul>
<h3 id="安全检查要点"><a href="#安全检查要点" class="headerlink" title="安全检查要点"></a>安全检查要点</h3><ul>
<li><input disabled="" type="checkbox"> 使用HTTPS而非HTTP</li>
<li><input disabled="" type="checkbox"> 选择可信的DNS服务商</li>
<li><input disabled="" type="checkbox"> 定期检查DNS设置</li>
<li><input disabled="" type="checkbox"> 避免使用不安全的公共Wi-Fi</li>
<li><input disabled="" type="checkbox"> 考虑使用VPN保护隐私</li>
<li><input disabled="" type="checkbox"> 了解SNI泄露风险</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>HTTP请求的完整链路涉及复杂的网络架构和多层协议栈。通过深入理解DNS解析机制、网络路径追踪原理和各种分析工具的使用，我们能够：</p>
<ol>
<li><strong>提升问题诊断能力</strong>：快速定位网络连接问题的根本原因</li>
<li><strong>优化网络性能</strong>：识别性能瓶颈并采取针对性优化措施</li>
<li><strong>增强安全意识</strong>：了解网络通信的隐私风险和保护措施</li>
<li><strong>深化技术理解</strong>：掌握网络协议的实际工作原理</li>
</ol>
<p>在实际工作中，这些工具和知识不仅有助于解决技术问题，更能帮助我们构建更可靠、更安全的网络应用系统。</p>
<p>网络技术的复杂性要求我们保持持续学习的态度，通过实践和分析不断加深对底层机制的理解。只有真正理解了网络通信的完整链路，我们才能在复杂的网络环境中游刃有余地解决各种技术挑战。</p>
<hr>
<p><em>本文档基于macOS环境的实际测试和分析编写，适用于网络工程师、系统管理员和开发工程师的日常工作参考。</em> </p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">XR</div><div class="post-copyright__author_desc">一片叶、一朵云</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/')">HTTP请求链路与DNS分析技术实践：深入理解网络通信机制</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=HTTP请求链路与DNS分析技术实践：深入理解网络通信机制&amp;url=http://example.com/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/&amp;pic=https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250607203155245.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">凌霄的博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/DNS/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>DNS<span class="tagsPageCount">2</span></a><a class="post-meta__box__tags" href="/tags/HTTP/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>HTTP<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络分析<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250624000019253.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/06/27/DNS%E8%A7%A3%E9%94%81%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%8E%9F%E7%90%86%E3%80%81%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618094256140.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">DNS解锁技术原理、实现</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/01/%E4%BD%BF%E7%94%A8Jenv%E7%AE%A1%E7%90%86%E5%A4%9A%E7%89%88%E6%9C%ACJDK%E7%8E%AF%E5%A2%83/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250624000019253.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/27/DNS%E8%A7%A3%E9%94%81%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%8E%9F%E7%90%86%E3%80%81%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" title="DNS解锁技术原理、实现"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618094256140.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-27</div><div class="title">DNS解锁技术原理、实现</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">XR</h1><div class="author-info__desc">一片叶、一朵云</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/kongxiaoran" target="_blank" title="Github"></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5"><span class="toc-number">1.</span> <span class="toc-text">HTTP请求链路与DNS分析技术实践</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E8%BF%B0"><span class="toc-number">1.1.</span> <span class="toc-text">概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82%E5%AE%8C%E6%95%B4%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90"><span class="toc-number">1.2.</span> <span class="toc-text">HTTP请求完整链路分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%93%BE%E8%B7%AF%E7%BB%84%E6%88%90%E4%B8%8E%E8%8A%82%E7%82%B9%E8%81%8C%E8%B4%A3"><span class="toc-number">1.2.1.</span> <span class="toc-text">链路组成与节点职责</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#HTTP%E8%AF%B7%E6%B1%82%E5%AE%8C%E6%95%B4%E9%93%BE%E8%B7%AF%E6%8A%80%E6%9C%AF%E6%B5%81%E7%A8%8B"><span class="toc-number">1.2.2.</span> <span class="toc-text">HTTP请求完整链路技术流程</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%80%E9%98%B6%E6%AE%B5%EF%BC%9ADNS%E8%A7%A3%E6%9E%90%EF%BC%88Domain-Name-Resolution%EF%BC%89"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">第一阶段：DNS解析（Domain Name Resolution）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%8C%E9%98%B6%E6%AE%B5%EF%BC%9ATCP%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B%EF%BC%88Three-Way-Handshake%EF%BC%89"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">第二阶段：TCP连接建立（Three-Way Handshake）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E9%98%B6%E6%AE%B5%EF%BC%9ATLS%E6%8F%A1%E6%89%8B%EF%BC%88Cryptographic-Handshake%EF%BC%89"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">第三阶段：TLS握手（Cryptographic Handshake）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E5%9B%9B%E9%98%B6%E6%AE%B5%EF%BC%9AHTTP%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%EF%BC%88Application-Data%EF%BC%89"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">第四阶段：HTTP请求响应（Application Data）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%BA%94%E9%98%B6%E6%AE%B5%EF%BC%9A%E8%BF%9E%E6%8E%A5%E5%85%B3%E9%97%AD%EF%BC%88Connection-Termination%EF%BC%89"><span class="toc-number">1.2.2.5.</span> <span class="toc-text">第五阶段：连接关闭（Connection Termination）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%8F%E8%AE%AE%E6%A0%88%E8%AF%A6%E7%BB%86%E5%A4%84%E7%90%86%E5%88%86%E6%9E%90"><span class="toc-number">1.2.3.</span> <span class="toc-text">协议栈详细处理分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BA%94%E7%94%A8%E5%B1%82%EF%BC%88Layer-7%EF%BC%89%E5%A4%84%E7%90%86%E7%BB%86%E8%8A%82"><span class="toc-number">1.2.3.1.</span> <span class="toc-text">应用层（Layer 7）处理细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%A0%E8%BE%93%E5%B1%82%EF%BC%88Layer-4%EF%BC%89%E5%A4%84%E7%90%86%E7%BB%86%E8%8A%82"><span class="toc-number">1.2.3.2.</span> <span class="toc-text">传输层（Layer 4）处理细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%B1%82%EF%BC%88Layer-3%EF%BC%89%E5%A4%84%E7%90%86%E7%BB%86%E8%8A%82"><span class="toc-number">1.2.3.3.</span> <span class="toc-text">网络层（Layer 3）处理细节</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%EF%BC%88Layer-2%EF%BC%89%E5%A4%84%E7%90%86%E7%BB%86%E8%8A%82"><span class="toc-number">1.2.3.4.</span> <span class="toc-text">数据链路层（Layer 2）处理细节</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90"><span class="toc-number">1.2.4.</span> <span class="toc-text">网络性能指标详细分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%90%84%E9%98%B6%E6%AE%B5%E5%BB%B6%E8%BF%9F%E5%88%86%E8%A7%A3"><span class="toc-number">1.2.4.1.</span> <span class="toc-text">各阶段延迟分解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E5%AE%BD%E5%88%A9%E7%94%A8%E7%8E%87%E5%88%86%E6%9E%90"><span class="toc-number">1.2.4.2.</span> <span class="toc-text">带宽利用率分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TLS%E6%8F%A1%E6%89%8B%E4%B8%8E%E5%8A%A0%E5%AF%86%E9%80%9A%E4%BF%A1"><span class="toc-number">1.2.5.</span> <span class="toc-text">TLS握手与加密通信</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E9%99%85%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">1.3.</span> <span class="toc-text">实际数据包分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Wireshark%E6%8A%93%E5%8C%85%E5%AE%9E%E6%88%98%E5%88%86%E6%9E%90"><span class="toc-number">1.3.1.</span> <span class="toc-text">Wireshark抓包实战分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-DNS%E6%9F%A5%E8%AF%A2%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">1.3.1.1.</span> <span class="toc-text">1. DNS查询数据包分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-TCP%E4%B8%89%E6%AC%A1%E6%8F%A1%E6%89%8B%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">1.3.1.2.</span> <span class="toc-text">2. TCP三次握手数据包分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-TLS%E6%8F%A1%E6%89%8B%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">1.3.1.3.</span> <span class="toc-text">3. TLS握手数据包分析</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-HTTP%E8%AF%B7%E6%B1%82%E5%93%8D%E5%BA%94%E6%95%B0%E6%8D%AE%E5%8C%85%E5%88%86%E6%9E%90"><span class="toc-number">1.3.1.4.</span> <span class="toc-text">4. HTTP请求响应数据包分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E6%B5%81%E9%87%8F%E7%BB%9F%E8%AE%A1%E5%88%86%E6%9E%90"><span class="toc-number">1.3.2.</span> <span class="toc-text">网络流量统计分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%8C%85%E6%B5%81%E9%87%8F%E7%BB%9F%E8%AE%A1"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">数据包流量统计</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%B6%E9%97%B4%E5%BA%8F%E5%88%97%E5%88%86%E6%9E%90"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">时间序列分析</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#NAT%E8%BD%AC%E6%8D%A2%E8%AF%A6%E7%BB%86%E5%88%86%E6%9E%90"><span class="toc-number">1.3.3.</span> <span class="toc-text">NAT转换详细分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%B7%AF%E7%94%B1%E5%99%A8NAT%E5%A4%84%E7%90%86%E8%BF%87%E7%A8%8B"><span class="toc-number">1.3.3.1.</span> <span class="toc-text">路由器NAT处理过程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS%E6%9F%A5%E8%AF%A2%E6%9C%BA%E5%88%B6%E6%B7%B1%E5%BA%A6%E8%A7%A3%E6%9E%90"><span class="toc-number">1.4.</span> <span class="toc-text">DNS查询机制深度解析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E8%A7%A3%E6%9E%90%E7%9A%84%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84"><span class="toc-number">1.4.1.</span> <span class="toc-text">DNS解析的层次结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E6%9F%A5%E8%AF%A2%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">DNS查询的两种模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DNS%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6"><span class="toc-number">1.4.3.</span> <span class="toc-text">DNS缓存机制</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E8%B7%AF%E5%BE%84%E8%BF%BD%E8%B8%AA%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">网络路径追踪原理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Traceroute%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="toc-number">1.5.1.</span> <span class="toc-text">Traceroute工作机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%BB%B6%E8%BF%9F%E5%88%86%E6%9E%90"><span class="toc-number">1.5.2.</span> <span class="toc-text">网络延迟分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97"><span class="toc-number">1.6.</span> <span class="toc-text">实践工具使用指南</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#macOS-HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7"><span class="toc-number">1.6.1.</span> <span class="toc-text">macOS HTTP请求链路分析工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dig%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.6.2.</span> <span class="toc-text">dig命令详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dig-trace%E6%B7%B1%E5%BA%A6%E5%88%86%E6%9E%90"><span class="toc-number">1.6.3.</span> <span class="toc-text">dig +trace深度分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#traceroute%E7%BD%91%E7%BB%9C%E8%B7%AF%E5%BE%84%E5%88%86%E6%9E%90"><span class="toc-number">1.6.4.</span> <span class="toc-text">traceroute网络路径分析</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E5%AF%B9%E6%AF%94%E5%92%8C%E9%80%89%E6%8B%A9%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.7.</span> <span class="toc-text">工具对比和选择建议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%9F%E8%83%BD%E5%AF%B9%E6%AF%94%E7%9F%A9%E9%98%B5"><span class="toc-number">1.7.1.</span> <span class="toc-text">功能对比矩阵</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF%E5%BB%BA%E8%AE%AE"><span class="toc-number">1.7.2.</span> <span class="toc-text">使用场景建议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%85%B7%E7%BB%84%E5%90%88%E4%BD%BF%E7%94%A8%E7%AD%96%E7%95%A5"><span class="toc-number">1.7.3.</span> <span class="toc-text">工具组合使用策略</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9A%90%E7%A7%81%E5%AE%89%E5%85%A8%E8%80%83%E9%87%8F"><span class="toc-number">1.8.</span> <span class="toc-text">隐私安全考量</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BD%91%E7%BB%9C%E5%8F%AF%E8%A7%81%E6%80%A7%E5%88%86%E6%9E%90"><span class="toc-number">1.8.1.</span> <span class="toc-text">网络可见性分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%9A%90%E7%A7%81%E4%BF%9D%E6%8A%A4%E6%8E%AA%E6%96%BD"><span class="toc-number">1.8.2.</span> <span class="toc-text">隐私保护措施</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BF%AB%E9%80%9F%E5%8F%82%E8%80%83%E6%89%8B%E5%86%8C"><span class="toc-number">1.9.</span> <span class="toc-text">快速参考手册</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E9%80%9F%E6%9F%A5"><span class="toc-number">1.9.1.</span> <span class="toc-text">常用命令速查</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%85%E9%9A%9C%E6%8E%92%E6%9F%A5%E6%B5%81%E7%A8%8B%E5%9B%BE"><span class="toc-number">1.9.2.</span> <span class="toc-text">故障排查流程图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96%E6%A3%80%E6%9F%A5%E6%B8%85%E5%8D%95"><span class="toc-number">1.9.3.</span> <span class="toc-text">性能优化检查清单</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%89%E5%85%A8%E6%A3%80%E6%9F%A5%E8%A6%81%E7%82%B9"><span class="toc-number">1.9.4.</span> <span class="toc-text">安全检查要点</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">1.10.</span> <span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/07/01/%E4%BD%BF%E7%94%A8Jenv%E7%AE%A1%E7%90%86%E5%A4%9A%E7%89%88%E6%9C%ACJDK%E7%8E%AF%E5%A2%83/" title="使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250624000019253.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践"/></a><div class="content"><a class="title" href="/2025/07/01/%E4%BD%BF%E7%94%A8Jenv%E7%AE%A1%E7%90%86%E5%A4%9A%E7%89%88%E6%9C%ACJDK%E7%8E%AF%E5%A2%83/" title="使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践">使用 Jenv 管理多版本 JDK 环境：轻松切换 Java 版本的最佳实践</a><time datetime="2025-06-30T16:00:00.000Z" title="发表于 2025-07-01 00:00:00">2025-07-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/" title="HTTP请求链路与DNS分析技术实践：深入理解网络通信机制"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250607203155245.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="HTTP请求链路与DNS分析技术实践：深入理解网络通信机制"/></a><div class="content"><a class="title" href="/2025/06/29/HTTP%E8%AF%B7%E6%B1%82%E9%93%BE%E8%B7%AF%E4%B8%8EDNS%E5%88%86%E6%9E%90%E6%8A%80%E6%9C%AF%E5%AE%9E%E8%B7%B5/" title="HTTP请求链路与DNS分析技术实践：深入理解网络通信机制">HTTP请求链路与DNS分析技术实践：深入理解网络通信机制</a><time datetime="2025-06-28T16:00:00.000Z" title="发表于 2025-06-29 00:00:00">2025-06-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/27/DNS%E8%A7%A3%E9%94%81%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%8E%9F%E7%90%86%E3%80%81%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" title="DNS解锁技术原理、实现"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618094256140.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="DNS解锁技术原理、实现"/></a><div class="content"><a class="title" href="/2025/06/27/DNS%E8%A7%A3%E9%94%81%E6%8A%80%E6%9C%AF%E8%AF%A6%E8%A7%A3%EF%BC%9A%E5%8E%9F%E7%90%86%E3%80%81%E5%AE%9E%E7%8E%B0%E4%B8%8E%E5%BA%94%E7%94%A8/" title="DNS解锁技术原理、实现">DNS解锁技术原理、实现</a><time datetime="2025-06-27T02:00:00.000Z" title="发表于 2025-06-27 10:00:00">2025-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/27/%E7%A8%8B%E5%BA%8F%E5%8C%96%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E6%8A%95%E6%94%BE%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/" title="程序化广告数据处理与投放技术架构与业务模式"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625170909952.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="程序化广告数据处理与投放技术架构与业务模式"/></a><div class="content"><a class="title" href="/2025/06/27/%E7%A8%8B%E5%BA%8F%E5%8C%96%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E6%8A%95%E6%94%BE%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/" title="程序化广告数据处理与投放技术架构与业务模式">程序化广告数据处理与投放技术架构与业务模式</a><time datetime="2025-06-26T16:00:00.000Z" title="发表于 2025-06-27 00:00:00">2025-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/26/confidential_computing_implementation_guide/" title="机密计算环境实施：从硬件选型到应用部署"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625095124143.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机密计算环境实施：从硬件选型到应用部署"/></a><div class="content"><a class="title" href="/2025/06/26/confidential_computing_implementation_guide/" title="机密计算环境实施：从硬件选型到应用部署">机密计算环境实施：从硬件选型到应用部署</a><time datetime="2025-06-25T16:00:00.000Z" title="发表于 2025-06-26 00:00:00">2025-06-26</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="XR" target="_blank">XR</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">36</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">4</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 0.88rem;">Argon2<sup>1</sup></a><a href="/tags/DNS/" style="font-size: 0.88rem;">DNS<sup>2</sup></a><a href="/tags/DSP/" style="font-size: 0.88rem;">DSP<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 0.88rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 0.88rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 0.88rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>6</sup></a><a href="/tags/Kubernetes/" style="font-size: 0.88rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 0.88rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 0.88rem;">NAT<sup>1</sup></a><a href="/tags/RTB/" style="font-size: 0.88rem;">RTB<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 0.88rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 0.88rem;">SGX<sup>2</sup></a><a href="/tags/Spark/" style="font-size: 0.88rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 0.88rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 0.88rem;">TEE<sup>2</sup></a><a href="/tags/TME/" style="font-size: 0.88rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 0.88rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 0.88rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 0.88rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>2</sup></a><a href="/tags/%E5%B9%BF%E5%91%8A%E6%8A%95%E6%94%BE/" style="font-size: 0.88rem;">广告投放<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">隐私计算<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/26/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 XR 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
      appKey: 'MR93sqmbPdh7Zm1bZzjXNvlm',
      avatar: 'mp',
      serverURLs: 'https://cbsqtaqs.api.lncldglobal.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://cbsqtaqs.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
        "X-LC-Key": 'MR93sqmbPdh7Zm1bZzjXNvlm',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>