<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Linux 网络基础概念详解：从硬件到应用 | 凌霄的博客</title><meta name="keywords" content="Java,Linux,网络,系统"><meta name="author" content="XR"><meta name="copyright" content="XR"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Linux 网络基础概念详解：从硬件到应用"><meta name="application-name" content="Linux 网络基础概念详解：从硬件到应用"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="Linux 网络基础概念详解：从硬件到应用"><meta property="og:url" content="http://example.com/2025/06/13/linux-network-basics/index.html"><meta property="og:site_name" content="凌霄的博客"><meta property="og:description" content="深入理解 Linux 网络基础概念，包括网卡、网络接口、端口、网络驱动、防火墙等，以及完整的数据包处理流程"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg"><meta property="article:author" content="XR"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg"><meta name="description" content="深入理解 Linux 网络基础概念，包括网卡、网络接口、端口、网络驱动、防火墙等，以及完整的数据包处理流程"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="http://example.com/2025/06/13/linux-network-basics/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走！再看看嘛！","backTitle":"♪(^∇^*)欢迎肥来！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🧱 团队小组发动机"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: XR","link":"链接: ","source":"来源: 凌霄的博客","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: '凌霄的博客',
  title: 'Linux 网络基础概念详解：从硬件到应用',
  postAI: '',
  pageFillDescription: 'Linux 网络基础概念详解：从硬件到应用, 1. 网络硬件基础, 1.1 网卡（Network Interface CardNIC）, 1.1.1 网卡类型, 1.1.2 网卡工作原理, 1.1.3 网卡寄存器, 1.2 网卡驱动, 1.2.1 驱动架构, 1.2.2 驱动功能详解, 1.2.3 驱动工作流程, 2. 网络接口, 2.1 物理接口, 2.1.1 单端口网卡, 2.1.2 多端口网卡, 2.2 虚拟接口, 2.2.1 VLAN 接口, 2.2.2 子接口, 2.2.3 网桥接口, 2.2.4 绑定接口（Bond）, 3. 网络协议栈, 3.1 协议层次, 3.2 关键协议详解, 3.2.1 TCPx2FIP 协议族, 3.2.2 应用层协议, 4. 网络端口, 4.1 端口概念详解, 4.2 常见端口及服务, 5. 防火墙, 5.1 iptables 详解, 5.1.1 表（Tables）, 5.1.2 链（Chains）, 5.1.3 匹配条件, 5.2 防火墙规则示例, 6. 完整数据流程, 6.1 数据包发送流程, 6.2 数据包接收流程, 6.3 详细处理流程, 7. 网络性能优化, 7.1 系统层面, 7.1.1 网卡优化, 7.1.2 协议栈优化, 7.2 应用层面, 7.2.1 Java 网络优化, 7.2.2 监控指标, 8. 常见问题排查, 8.1 网络连接问题, 8.1.1 物理层, 8.1.2 网络层, 8.1.3 应用层, 8.2 性能问题, 8.2.1 系统资源, 8.2.2 应用资源, 9. 总结, 参考资料网络基础概念详解从硬件到应用网络硬件基础网卡网卡是计算机与网络之间的物理接口负责网络数据的收发它是网络通信的物理基础网卡类型按接口类型接口最常见的以太网接口光纤接口支持更高速率和更长距离无线接口支持连接接口便携式网卡按速率分类早期以太网快速以太网千兆以太网万兆以太网高速数据中心按功能分类普通网卡基本网络连接服务器网卡支持多队列智能网卡支持硬件卸载虚拟化网卡支持网卡工作原理网卡物理层数据链路层网络层信号处理时钟同步编码解码地址帧处理错误检测数据包处理协议支持流量控制网卡寄存器控制寄存器命令寄存器控制网卡操作状态寄存器反映网卡状态中断寄存器管理中断数据寄存器发送缓冲区接收缓冲区控制配置寄存器地址工作模式速率设置网卡驱动网卡驱动是操作系统与网卡硬件之间的桥梁负责管理网卡硬件资源实现数据包的收发驱动架构应用层网络协议栈网卡驱动网卡硬件初始化模块数据收发模块中断处理模块状态管理模块驱动功能详解初始化功能硬件检测和识别寄存器初始化中断设置配置缓冲区分配数据收发功能数据包封装校验和计算传输错误处理流量控制中断处理功能接收中断发送完成中断错误中断状态变化中断状态管理功能链路状态监控错误统计性能统计电源管理驱动工作流程应用程序内核网卡驱动网卡硬件系统调用驱动接口调用写寄存器中断通知中断处理返回结果网络接口物理接口单端口网卡基本特性单个物理接口标准地址基本网络功能适用于普通工作站使用场景个人电脑普通服务器网络终端设备多端口网卡类型双端口网卡四端口网卡八端口网卡高级特性链路聚合负载均衡故障转移多队列支持应用场景服务器网络设备存储设备虚拟接口接口工作原理基于协议在数据帧中添加标签实现虚拟局域网隔离配置示例创建接口配置地址启用接口查看信息使用场景网络隔离安全区域划分流量控制子接口特性基于物理接口创建支持多个地址独立的路由表独立的防火墙规则配置示例创建子接口配置路由查看子接口应用场景多网段配置网络隔离负载均衡网桥接口工作原理二层交换功能学习地址转发数据帧支持协议配置示例创建网桥添加接口启用网桥配置地址查看网桥信息使用场景虚拟化环境容器网络网络隔离绑定接口绑定模式轮询模式主备模式模式广播模式模式适配器传输负载均衡适配器适应性负载均衡配置示例创建绑定接口配置绑定模式添加从属接口启用绑定接口配置地址查看绑定状态应用场景高可用性负载均衡带宽聚合网络协议栈协议层次应用层传输层网络层数据链路层物理层以太网网卡驱动物理介质关键协议详解协议族协议版本功能路由和寻址特点无连接不可靠数据包格式版本头长度服务类型总长度标识标志片偏移协议校验和源地址目标地址选项数据协议特点面向连接可靠传输功能流量控制拥塞控制数据包格式源端口目标端口序列号确认号标志位窗口大小校验和紧急指针选项数据协议特点无连接不可靠功能简单高效数据包格式源端口目标端口长度校验和数据协议功能网络诊断类型请求应答常见消息应用层协议协议版本特点无状态可扩展请求方法状态码等协议模式主动模式被动模式功能文件传输命令安全协议功能域名解析记录类型查询类型递归迭代端口协议功能邮件传输命令安全端口网络端口端口概念详解端口范围知名端口注册端口动态端口端口状态监听状态已建立连接等待关闭等待关闭等待结束端口复用多进程监听负载均衡常见端口及服务服务代理服务器代理数据库服务邮件服务文件服务远程管理防火墙详解表表默认表用于包过滤链表用于地址转换链表用于数据包修改链表用于连接跟踪链链链处理入站数据包目标地址为本机常用规则允许已建立的连接允许特定端口允许特定链处理出站数据包源地址为本机常用规则允许所有出站流量限制特定端口链处理转发数据包经过本机的数据包常用规则允许转发限制特定网段链数据包进入路由表之前用于常用规则端口转发链数据包离开路由表之后用于常用规则源地址转换匹配条件基本匹配源地址目标地址协议接口扩展匹配状态多端口连接限制字符串目标动作接受丢弃拒绝记录目标地址转换源地址转换防火墙规则示例基本防护清除现有规则设置默认策略允许本地回环允许已建立的连接允许允许配置启用转发配置配置高级规则限制连接数防止洪水攻击记录特定流量完整数据流程数据包发送流程应用层层网卡驱动网卡硬件网络调用数据复制到内核缓冲区数据封装添加头计算校验和添加头添加头计算校验和路由查找数据包发送传输数据包发送添加帧头计算物理发送数据包接收流程网络网卡硬件网卡驱动层层应用接收数据包校验去除帧头触发中断中断处理传输数据包接收校验头去除头数据包传递校验头去除头重组数据包数据就绪通知应用调用返回数据详细处理流程客户端发送请求网络数据包到达网卡触发中断网卡驱动传输内核缓冲区软中断网络协议栈协议解析层数据就绪事件通知应用处理请求业务逻辑硬件校验帧校验校验通过校验失败丢弃数据包层处理路由查找找到路由未找到路由错误层处理连接跟踪新连接创建连接已有连接更新连接处理缓冲区管理缓冲区满流量控制缓冲区空等待数据处理事件循环读事件数据读取写事件数据发送应用处理请求解析业务处理响应生成数据发送响应返回网络性能优化系统层面网卡优化中断合并减少中断提高吞吐量配置示例查看中断合并设置设置中断合并多队列支持多处理负载均衡配置示例查看队列数设置队列数大页内存减少缺失提高性能配置示例分配大页挂载大页文件系统协议栈优化参数调优缓冲区大小超时设置拥塞控制配置示例设置缓冲区设置超时设置拥塞控制连接跟踪优化连接表超时设置配置示例设置连接跟踪表大小设置超时时间应用层面网络优化使用非阻塞事件驱动示例代码创建创建事件循环处理连接处理读取处理写入连接池管理连接复用超时控制示例配置创建连接池创建超时设置连接超时读取超时写入超时示例代码设置超时监控指标网络吞吐量带宽使用率数据包速率错误率监控工具使用监控带宽使用监控进程使用测试带宽延迟统计往返时间连接延迟处理延迟监控工具使用测试延迟使用测试延迟错误计数丢包率重传率错误率监控工具查看网卡统计查看统计常见问题排查网络连接问题物理层网线连接检查网线检查接口检查指示灯排查步骤查看网卡状态查看接口信息测试网线网卡状态驱动加载中断配置设置排查步骤查看驱动信息查看中断查看驱动问题驱动版本兼容性配置参数排查步骤更新驱动查看驱动参数设置驱动参数网络层配置地址设置子网掩码网关配置排查步骤查看配置配置地址配置网关路由表路由条目默认路由策略路由排查步骤查看路由表添加路由删除路由防火墙规则规则配置链设置策略配置排查步骤查看规则添加规则保存规则应用层端口监听服务状态端口占用访问权限排查步骤查看端口查看进程测试端口服务状态进程状态日志信息配置检查排查步骤查看服务状态查看日志检查配置日志分析错误日志访问日志系统日志排查步骤查看系统日志查看应用日志分析日志性能问题系统资源使用率进程中断处理上下文切换排查步骤查看使用查看中断查看上下文切换内存使用物理内存虚拟内存缓冲区排查步骤查看内存使用查看虚拟内存查看缓冲区网络带宽带宽使用数据包大小协议分布排查步骤查看带宽使用查看数据包查看协议分布应用资源连接数活动连接等待连接连接限制排查步骤查看连接数查看等待连接查看连接限制线程数活动线程线程池线程限制排查步骤查看线程数查看线程池查看线程限制缓冲区大小发送缓冲区接收缓冲区缓冲区限制排查步骤查看缓冲区设置缓冲区查看限制总结网络是一个复杂的系统涉及从硬件到应用的多个层次理解这些基础概念和完整的数据流程对于网络问题排查和性能优化都至关重要通过本文的详细介绍读者可以理解网络硬件和驱动的工作原理掌握网络接口的配置和管理了解网络协议栈的工作机制熟悉防火墙的配置和使用掌握网络性能优化的方法学会网络问题的排查技巧参考资料内核网络子系统文档协议详解编程指南网络性能调优指南官方文档网络故障排查手册',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-06-13 11:40:55',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">凌霄的博客</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 1.05rem;">Argon2<sup>1</sup></a><a href="/tags/DSP/" style="font-size: 1.05rem;">DSP<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 1.05rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 1.05rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 1.05rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 1.05rem;">Java<sup>5</sup></a><a href="/tags/Kubernetes/" style="font-size: 1.05rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 1.05rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 1.05rem;">NAT<sup>1</sup></a><a href="/tags/RTB/" style="font-size: 1.05rem;">RTB<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 1.05rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 1.05rem;">SGX<sup>2</sup></a><a href="/tags/Spark/" style="font-size: 1.05rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 1.05rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 1.05rem;">TEE<sup>2</sup></a><a href="/tags/TME/" style="font-size: 1.05rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 1.05rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 1.05rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 1.05rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 1.05rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 1.05rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 1.05rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 1.05rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 1.05rem;">并发<sup>2</sup></a><a href="/tags/%E5%B9%BF%E5%91%8A%E6%8A%95%E6%94%BE/" style="font-size: 1.05rem;">广告投放<sup>1</sup></a><a href="/tags/%E7%A8%8B%E5%BA%8F%E5%8C%96%E5%B9%BF%E5%91%8A/" style="font-size: 1.05rem;">程序化广告<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 1.05rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 1.05rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 1.05rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 1.05rem;">隐私计算<sup>2</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">29</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">十一月 2023</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Java/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Java</span></a><a class="article-meta__tags" href="/tags/Linux/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Linux</span></a><a class="article-meta__tags" href="/tags/%E7%BD%91%E7%BB%9C/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>网络</span></a><a class="article-meta__tags" href="/tags/%E7%B3%BB%E7%BB%9F/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>系统</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Linux 网络基础概念详解：从硬件到应用</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-12T16:00:00.000Z" title="发表于 2025-06-13 00:00:00">2025-06-13</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-06-13T03:40:55.967Z" title="更新于 2025-06-13 11:40:55">2025-06-13</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="Linux 网络基础概念详解：从硬件到应用"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为杭州"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>杭州</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/06/13/linux-network-basics/"><header><a class="post-meta-categories" href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="url">后端</a><a href="/tags/Java/" tabindex="-1" itemprop="url">Java</a><a href="/tags/Linux/" tabindex="-1" itemprop="url">Linux</a><a href="/tags/%E7%BD%91%E7%BB%9C/" tabindex="-1" itemprop="url">网络</a><a href="/tags/%E7%B3%BB%E7%BB%9F/" tabindex="-1" itemprop="url">系统</a><h1 id="CrawlerTitle" itemprop="name headline">Linux 网络基础概念详解：从硬件到应用</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">XR</span><time itemprop="dateCreated datePublished" datetime="2025-06-12T16:00:00.000Z" title="发表于 2025-06-13 00:00:00">2025-06-13</time><time itemprop="dateCreated datePublished" datetime="2025-06-13T03:40:55.967Z" title="更新于 2025-06-13 11:40:55">2025-06-13</time></header><h1 id="Linux-网络基础概念详解：从硬件到应用"><a href="#Linux-网络基础概念详解：从硬件到应用" class="headerlink" title="Linux 网络基础概念详解：从硬件到应用"></a>Linux 网络基础概念详解：从硬件到应用</h1><h2 id="1-网络硬件基础"><a href="#1-网络硬件基础" class="headerlink" title="1. 网络硬件基础"></a>1. 网络硬件基础</h2><h3 id="1-1-网卡（Network-Interface-Card，NIC）"><a href="#1-1-网卡（Network-Interface-Card，NIC）" class="headerlink" title="1.1 网卡（Network Interface Card，NIC）"></a>1.1 网卡（Network Interface Card，NIC）</h3><p>网卡是计算机与网络之间的物理接口，负责网络数据的收发。它是网络通信的物理基础。</p>
<h4 id="1-1-1-网卡类型"><a href="#1-1-1-网卡类型" class="headerlink" title="1.1.1 网卡类型"></a>1.1.1 网卡类型</h4><ol>
<li><p><strong>按接口类型</strong></p>
<ul>
<li>RJ45 接口：最常见的以太网接口</li>
<li>光纤接口：支持更高速率和更长距离</li>
<li>无线接口：支持 WiFi 连接</li>
<li>USB 接口：便携式网卡</li>
</ul>
</li>
<li><p><strong>按速率分类</strong></p>
<ul>
<li>10Mbps：早期以太网</li>
<li>100Mbps：快速以太网</li>
<li>1Gbps：千兆以太网</li>
<li>10Gbps：万兆以太网</li>
<li>40Gbps&#x2F;100Gbps：高速数据中心</li>
</ul>
</li>
<li><p><strong>按功能分类</strong></p>
<ul>
<li>普通网卡：基本网络连接</li>
<li>服务器网卡：支持多队列、TOE</li>
<li>智能网卡：支持硬件卸载</li>
<li>虚拟化网卡：支持 SR-IOV</li>
</ul>
</li>
</ol>
<h4 id="1-1-2-网卡工作原理"><a href="#1-1-2-网卡工作原理" class="headerlink" title="1.1.2 网卡工作原理"></a>1.1.2 网卡工作原理</h4><div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  graph TD
    A[网卡] --&gt; B[物理层]
    B --&gt; C[数据链路层]
    C --&gt; D[网络层]
    
    B --&gt; E[信号处理]
    B --&gt; F[时钟同步]
    B --&gt; G[编码解码]
    
    C --&gt; H[MAC地址]
    C --&gt; I[帧处理]
    C --&gt; J[错误检测]
    
    D --&gt; K[数据包处理]
    D --&gt; L[协议支持]
    D --&gt; M[流量控制]
  </pre></div>

<h4 id="1-1-3-网卡寄存器"><a href="#1-1-3-网卡寄存器" class="headerlink" title="1.1.3 网卡寄存器"></a>1.1.3 网卡寄存器</h4><ol>
<li><p><strong>控制寄存器</strong></p>
<ul>
<li>命令寄存器：控制网卡操作</li>
<li>状态寄存器：反映网卡状态</li>
<li>中断寄存器：管理中断</li>
</ul>
</li>
<li><p><strong>数据寄存器</strong></p>
<ul>
<li>发送缓冲区</li>
<li>接收缓冲区</li>
<li>DMA 控制</li>
</ul>
</li>
<li><p><strong>配置寄存器</strong></p>
<ul>
<li>MAC 地址</li>
<li>工作模式</li>
<li>速率设置</li>
</ul>
</li>
</ol>
<h3 id="1-2-网卡驱动"><a href="#1-2-网卡驱动" class="headerlink" title="1.2 网卡驱动"></a>1.2 网卡驱动</h3><p>网卡驱动是操作系统与网卡硬件之间的桥梁，负责管理网卡硬件资源，实现数据包的收发。</p>
<h4 id="1-2-1-驱动架构"><a href="#1-2-1-驱动架构" class="headerlink" title="1.2.1 驱动架构"></a>1.2.1 驱动架构</h4><div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  graph TD
    A[应用层] --&gt; B[Socket API]
    B --&gt; C[网络协议栈]
    C --&gt; D[网卡驱动]
    D --&gt; E[网卡硬件]
    
    D --&gt; F[初始化模块]
    D --&gt; G[数据收发模块]
    D --&gt; H[中断处理模块]
    D --&gt; I[状态管理模块]
  </pre></div>

<h4 id="1-2-2-驱动功能详解"><a href="#1-2-2-驱动功能详解" class="headerlink" title="1.2.2 驱动功能详解"></a>1.2.2 驱动功能详解</h4><ol>
<li><p><strong>初始化功能</strong></p>
<ul>
<li>硬件检测和识别</li>
<li>寄存器初始化</li>
<li>中断设置</li>
<li>DMA 配置</li>
<li>缓冲区分配</li>
</ul>
</li>
<li><p><strong>数据收发功能</strong></p>
<ul>
<li>数据包封装</li>
<li>校验和计算</li>
<li>DMA 传输</li>
<li>错误处理</li>
<li>流量控制</li>
</ul>
</li>
<li><p><strong>中断处理功能</strong></p>
<ul>
<li>接收中断</li>
<li>发送完成中断</li>
<li>错误中断</li>
<li>状态变化中断</li>
</ul>
</li>
<li><p><strong>状态管理功能</strong></p>
<ul>
<li>链路状态监控</li>
<li>错误统计</li>
<li>性能统计</li>
<li>电源管理</li>
</ul>
</li>
</ol>
<h4 id="1-2-3-驱动工作流程"><a href="#1-2-3-驱动工作流程" class="headerlink" title="1.2.3 驱动工作流程"></a>1.2.3 驱动工作流程</h4><div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  sequenceDiagram
    participant App as 应用程序
    participant Kernel as 内核
    participant Driver as 网卡驱动
    participant NIC as 网卡硬件
    
    App-&gt;&gt;Kernel: 系统调用
    Kernel-&gt;&gt;Driver: 驱动接口调用
    Driver-&gt;&gt;NIC: 写寄存器
    NIC-&gt;&gt;Driver: 中断通知
    Driver-&gt;&gt;Kernel: 中断处理
    Kernel-&gt;&gt;App: 返回结果
  </pre></div>

<h2 id="2-网络接口"><a href="#2-网络接口" class="headerlink" title="2. 网络接口"></a>2. 网络接口</h2><h3 id="2-1-物理接口"><a href="#2-1-物理接口" class="headerlink" title="2.1 物理接口"></a>2.1 物理接口</h3><h4 id="2-1-1-单端口网卡"><a href="#2-1-1-单端口网卡" class="headerlink" title="2.1.1 单端口网卡"></a>2.1.1 单端口网卡</h4><ol>
<li><p><strong>基本特性</strong></p>
<ul>
<li>单个物理接口</li>
<li>标准 MAC 地址</li>
<li>基本网络功能</li>
<li>适用于普通工作站</li>
</ul>
</li>
<li><p><strong>使用场景</strong></p>
<ul>
<li>个人电脑</li>
<li>普通服务器</li>
<li>网络终端设备</li>
</ul>
</li>
</ol>
<h4 id="2-1-2-多端口网卡"><a href="#2-1-2-多端口网卡" class="headerlink" title="2.1.2 多端口网卡"></a>2.1.2 多端口网卡</h4><ol>
<li><p><strong>类型</strong></p>
<ul>
<li>双端口网卡</li>
<li>四端口网卡</li>
<li>八端口网卡</li>
</ul>
</li>
<li><p><strong>高级特性</strong></p>
<ul>
<li>链路聚合</li>
<li>负载均衡</li>
<li>故障转移</li>
<li>多队列支持</li>
</ul>
</li>
<li><p><strong>应用场景</strong></p>
<ul>
<li>服务器</li>
<li>网络设备</li>
<li>存储设备</li>
</ul>
</li>
</ol>
<h3 id="2-2-虚拟接口"><a href="#2-2-虚拟接口" class="headerlink" title="2.2 虚拟接口"></a>2.2 虚拟接口</h3><h4 id="2-2-1-VLAN-接口"><a href="#2-2-1-VLAN-接口" class="headerlink" title="2.2.1 VLAN 接口"></a>2.2.1 VLAN 接口</h4><ol>
<li><p><strong>工作原理</strong></p>
<ul>
<li>基于 802.1Q 协议</li>
<li>在数据帧中添加 VLAN 标签</li>
<li>实现虚拟局域网隔离</li>
</ul>
</li>
<li><p><strong>配置示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建 VLAN 接口</span></span><br><span class="line">ip <span class="built_in">link</span> add <span class="built_in">link</span> eth0 name eth0.100 <span class="built_in">type</span> vlan <span class="built_in">id</span> 100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 IP 地址</span></span><br><span class="line">ip addr add 192.168.100.1/24 dev eth0.100</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用接口</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0.100 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 VLAN 信息</span></span><br><span class="line">ip -d <span class="built_in">link</span> show eth0.100</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用场景</strong></p>
<ul>
<li>网络隔离</li>
<li>安全区域划分</li>
<li>流量控制</li>
</ul>
</li>
</ol>
<h4 id="2-2-2-子接口"><a href="#2-2-2-子接口" class="headerlink" title="2.2.2 子接口"></a>2.2.2 子接口</h4><ol>
<li><p><strong>特性</strong></p>
<ul>
<li>基于物理接口创建</li>
<li>支持多个 IP 地址</li>
<li>独立的路由表</li>
<li>独立的防火墙规则</li>
</ul>
</li>
<li><p><strong>配置示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建子接口</span></span><br><span class="line">ip addr add 192.168.1.100/24 dev eth0:0</span><br><span class="line">ip addr add 192.168.2.100/24 dev eth0:1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置路由</span></span><br><span class="line">ip route add 192.168.1.0/24 dev eth0:0</span><br><span class="line">ip route add 192.168.2.0/24 dev eth0:1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看子接口</span></span><br><span class="line">ip addr show eth0:0</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>应用场景</strong></p>
<ul>
<li>多网段配置</li>
<li>网络隔离</li>
<li>负载均衡</li>
</ul>
</li>
</ol>
<h4 id="2-2-3-网桥接口"><a href="#2-2-3-网桥接口" class="headerlink" title="2.2.3 网桥接口"></a>2.2.3 网桥接口</h4><ol>
<li><p><strong>工作原理</strong></p>
<ul>
<li>二层交换功能</li>
<li>学习 MAC 地址</li>
<li>转发数据帧</li>
<li>支持 STP 协议</li>
</ul>
</li>
<li><p><strong>配置示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建网桥</span></span><br><span class="line">brctl addbr br0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加接口</span></span><br><span class="line">brctl addif br0 eth0</span><br><span class="line">brctl addif br0 eth1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用网桥</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> br0 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 IP 地址</span></span><br><span class="line">ip addr add 192.168.1.1/24 dev br0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网桥信息</span></span><br><span class="line">brctl show</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>使用场景</strong></p>
<ul>
<li>虚拟化环境</li>
<li>容器网络</li>
<li>网络隔离</li>
</ul>
</li>
</ol>
<h4 id="2-2-4-绑定接口（Bond）"><a href="#2-2-4-绑定接口（Bond）" class="headerlink" title="2.2.4 绑定接口（Bond）"></a>2.2.4 绑定接口（Bond）</h4><ol>
<li><p><strong>绑定模式</strong></p>
<ul>
<li>mode&#x3D;0：轮询模式</li>
<li>mode&#x3D;1：主备模式</li>
<li>mode&#x3D;2：XOR 模式</li>
<li>mode&#x3D;3：广播模式</li>
<li>mode&#x3D;4：802.3ad 模式</li>
<li>mode&#x3D;5：适配器传输负载均衡</li>
<li>mode&#x3D;6：适配器适应性负载均衡</li>
</ul>
</li>
<li><p><strong>配置示例</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建绑定接口</span></span><br><span class="line">ip <span class="built_in">link</span> add bond0 <span class="built_in">type</span> bond</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置绑定模式</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /sys/class/net/bond0/bonding/mode</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加从属接口</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth0 master bond0</span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> eth1 master bond0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启用绑定接口</span></span><br><span class="line">ip <span class="built_in">link</span> <span class="built_in">set</span> bond0 up</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 IP 地址</span></span><br><span class="line">ip addr add 192.168.1.100/24 dev bond0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看绑定状态</span></span><br><span class="line"><span class="built_in">cat</span> /proc/net/bonding/bond0</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>应用场景</strong></p>
<ul>
<li>高可用性</li>
<li>负载均衡</li>
<li>带宽聚合</li>
</ul>
</li>
</ol>
<h2 id="3-网络协议栈"><a href="#3-网络协议栈" class="headerlink" title="3. 网络协议栈"></a>3. 网络协议栈</h2><h3 id="3-1-协议层次"><a href="#3-1-协议层次" class="headerlink" title="3.1 协议层次"></a>3.1 协议层次</h3><div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  graph TD
    A[应用层] --&gt; B[传输层]
    B --&gt; C[网络层]
    C --&gt; D[数据链路层]
    D --&gt; E[物理层]
    
    A --&gt; F[HTTP&#x2F;FTP&#x2F;DNS]
    A --&gt; G[SMTP&#x2F;POP3]
    A --&gt; H[SSH&#x2F;TELNET]
    
    B --&gt; I[TCP]
    B --&gt; J[UDP]
    
    C --&gt; K[IP]
    C --&gt; L[ICMP]
    C --&gt; M[IGMP]
    
    D --&gt; N[以太网]
    D --&gt; O[ARP]
    D --&gt; P[RARP]
    
    E --&gt; Q[网卡驱动]
    E --&gt; R[物理介质]
  </pre></div>

<h3 id="3-2-关键协议详解"><a href="#3-2-关键协议详解" class="headerlink" title="3.2 关键协议详解"></a>3.2 关键协议详解</h3><h4 id="3-2-1-TCP-IP-协议族"><a href="#3-2-1-TCP-IP-协议族" class="headerlink" title="3.2.1 TCP&#x2F;IP 协议族"></a>3.2.1 TCP&#x2F;IP 协议族</h4><ol>
<li><p><strong>IP 协议</strong></p>
<ul>
<li>版本：IPv4&#x2F;IPv6</li>
<li>功能：路由和寻址</li>
<li>特点：无连接、不可靠</li>
<li>数据包格式：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">+------------------+</span><br><span class="line">|    版本/头长度    |</span><br><span class="line">+------------------+</span><br><span class="line">|    服务类型      |</span><br><span class="line">+------------------+</span><br><span class="line">|    总长度        |</span><br><span class="line">+------------------+</span><br><span class="line">|    标识          |</span><br><span class="line">+------------------+</span><br><span class="line">|    标志/片偏移    |</span><br><span class="line">+------------------+</span><br><span class="line">|    TTL          |</span><br><span class="line">+------------------+</span><br><span class="line">|    协议          |</span><br><span class="line">+------------------+</span><br><span class="line">|    校验和        |</span><br><span class="line">+------------------+</span><br><span class="line">|    源IP地址      |</span><br><span class="line">+------------------+</span><br><span class="line">|    目标IP地址    |</span><br><span class="line">+------------------+</span><br><span class="line">|    选项          |</span><br><span class="line">+------------------+</span><br><span class="line">|    数据          |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>TCP 协议</strong></p>
<ul>
<li>特点：面向连接、可靠传输</li>
<li>功能：流量控制、拥塞控制</li>
<li>数据包格式：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">+------------------+</span><br><span class="line">|    源端口        |</span><br><span class="line">+------------------+</span><br><span class="line">|    目标端口      |</span><br><span class="line">+------------------+</span><br><span class="line">|    序列号        |</span><br><span class="line">+------------------+</span><br><span class="line">|    确认号        |</span><br><span class="line">+------------------+</span><br><span class="line">|    标志位        |</span><br><span class="line">+------------------+</span><br><span class="line">|    窗口大小      |</span><br><span class="line">+------------------+</span><br><span class="line">|    校验和        |</span><br><span class="line">+------------------+</span><br><span class="line">|    紧急指针      |</span><br><span class="line">+------------------+</span><br><span class="line">|    选项          |</span><br><span class="line">+------------------+</span><br><span class="line">|    数据          |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>UDP 协议</strong></p>
<ul>
<li>特点：无连接、不可靠</li>
<li>功能：简单高效</li>
<li>数据包格式：<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">+------------------+</span><br><span class="line">|    源端口        |</span><br><span class="line">+------------------+</span><br><span class="line">|    目标端口      |</span><br><span class="line">+------------------+</span><br><span class="line">|    长度          |</span><br><span class="line">+------------------+</span><br><span class="line">|    校验和        |</span><br><span class="line">+------------------+</span><br><span class="line">|    数据          |</span><br><span class="line">+------------------+</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>ICMP 协议</strong></p>
<ul>
<li>功能：网络诊断</li>
<li>类型：请求&#x2F;应答</li>
<li>常见消息：<ul>
<li>Echo Request&#x2F;Reply</li>
<li>Destination Unreachable</li>
<li>Time Exceeded</li>
<li>Parameter Problem</li>
</ul>
</li>
</ul>
</li>
</ol>
<h4 id="3-2-2-应用层协议"><a href="#3-2-2-应用层协议" class="headerlink" title="3.2.2 应用层协议"></a>3.2.2 应用层协议</h4><ol>
<li><p><strong>HTTP 协议</strong></p>
<ul>
<li>版本：HTTP&#x2F;1.0、HTTP&#x2F;1.1、HTTP&#x2F;2</li>
<li>特点：无状态、可扩展</li>
<li>请求方法：GET、POST、PUT、DELETE</li>
<li>状态码：200、404、500 等</li>
</ul>
</li>
<li><p><strong>FTP 协议</strong></p>
<ul>
<li>模式：主动模式、被动模式</li>
<li>功能：文件传输</li>
<li>命令：PUT、GET、LIST</li>
<li>安全：FTPS、SFTP</li>
</ul>
</li>
<li><p><strong>DNS 协议</strong></p>
<ul>
<li>功能：域名解析</li>
<li>记录类型：A、AAAA、CNAME、MX</li>
<li>查询类型：递归、迭代</li>
<li>端口：53</li>
</ul>
</li>
<li><p><strong>SMTP 协议</strong></p>
<ul>
<li>功能：邮件传输</li>
<li>命令：HELO、MAIL、RCPT、DATA</li>
<li>安全：STARTTLS、SMTPS</li>
<li>端口：25、465</li>
</ul>
</li>
</ol>
<h2 id="4-网络端口"><a href="#4-网络端口" class="headerlink" title="4. 网络端口"></a>4. 网络端口</h2><h3 id="4-1-端口概念详解"><a href="#4-1-端口概念详解" class="headerlink" title="4.1 端口概念详解"></a>4.1 端口概念详解</h3><ol>
<li><p><strong>端口范围</strong></p>
<ul>
<li>0-1023：知名端口</li>
<li>1024-49151：注册端口</li>
<li>49152-65535：动态端口</li>
</ul>
</li>
<li><p><strong>端口状态</strong></p>
<ul>
<li>LISTEN：监听状态</li>
<li>ESTABLISHED：已建立连接</li>
<li>TIME_WAIT：等待关闭</li>
<li>CLOSE_WAIT：等待关闭</li>
<li>FIN_WAIT：等待结束</li>
</ul>
</li>
<li><p><strong>端口复用</strong></p>
<ul>
<li>SO_REUSEADDR</li>
<li>SO_REUSEPORT</li>
<li>多进程监听</li>
<li>负载均衡</li>
</ul>
</li>
</ol>
<h3 id="4-2-常见端口及服务"><a href="#4-2-常见端口及服务" class="headerlink" title="4.2 常见端口及服务"></a>4.2 常见端口及服务</h3><ol>
<li><p><strong>Web 服务</strong></p>
<ul>
<li>80：HTTP</li>
<li>443：HTTPS</li>
<li>8080：代理服务器</li>
<li>8443：HTTPS 代理</li>
</ul>
</li>
<li><p><strong>数据库服务</strong></p>
<ul>
<li>3306：MySQL</li>
<li>5432：PostgreSQL</li>
<li>6379：Redis</li>
<li>27017：MongoDB</li>
</ul>
</li>
<li><p><strong>邮件服务</strong></p>
<ul>
<li>25：SMTP</li>
<li>110：POP3</li>
<li>143：IMAP</li>
<li>465：SMTPS</li>
</ul>
</li>
<li><p><strong>文件服务</strong></p>
<ul>
<li>21：FTP</li>
<li>22：SFTP</li>
<li>445：SMB</li>
<li>2049：NFS</li>
</ul>
</li>
<li><p><strong>远程管理</strong></p>
<ul>
<li>22：SSH</li>
<li>23：Telnet</li>
<li>3389：RDP</li>
<li>5900：VNC</li>
</ul>
</li>
</ol>
<h2 id="5-防火墙"><a href="#5-防火墙" class="headerlink" title="5. 防火墙"></a>5. 防火墙</h2><h3 id="5-1-iptables-详解"><a href="#5-1-iptables-详解" class="headerlink" title="5.1 iptables 详解"></a>5.1 iptables 详解</h3><h4 id="5-1-1-表（Tables）"><a href="#5-1-1-表（Tables）" class="headerlink" title="5.1.1 表（Tables）"></a>5.1.1 表（Tables）</h4><ol>
<li><p><strong>filter 表</strong></p>
<ul>
<li>默认表</li>
<li>用于包过滤</li>
<li>链：INPUT、OUTPUT、FORWARD</li>
</ul>
</li>
<li><p><strong>nat 表</strong></p>
<ul>
<li>用于地址转换</li>
<li>链：PREROUTING、POSTROUTING、OUTPUT</li>
</ul>
</li>
<li><p><strong>mangle 表</strong></p>
<ul>
<li>用于数据包修改</li>
<li>链：PREROUTING、INPUT、FORWARD、OUTPUT、POSTROUTING</li>
</ul>
</li>
<li><p><strong>raw 表</strong></p>
<ul>
<li>用于连接跟踪</li>
<li>链：PREROUTING、OUTPUT</li>
</ul>
</li>
</ol>
<h4 id="5-1-2-链（Chains）"><a href="#5-1-2-链（Chains）" class="headerlink" title="5.1.2 链（Chains）"></a>5.1.2 链（Chains）</h4><ol>
<li><p><strong>INPUT 链</strong></p>
<ul>
<li>处理入站数据包</li>
<li>目标地址为本机</li>
<li>常用规则：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许已建立的连接</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许特定端口</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许特定 IP</span></span><br><span class="line">iptables -A INPUT -s 192.168.1.100 -j ACCEPT</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>OUTPUT 链</strong></p>
<ul>
<li>处理出站数据包</li>
<li>源地址为本机</li>
<li>常用规则：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许所有出站流量</span></span><br><span class="line">iptables -A OUTPUT -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制特定端口</span></span><br><span class="line">iptables -A OUTPUT -p tcp --dport 25 -j DROP</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>FORWARD 链</strong></p>
<ul>
<li>处理转发数据包</li>
<li>经过本机的数据包</li>
<li>常用规则：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 允许转发</span></span><br><span class="line">iptables -A FORWARD -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 限制特定网段</span></span><br><span class="line">iptables -A FORWARD -s 192.168.1.0/24 -j DROP</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>PREROUTING 链</strong></p>
<ul>
<li>数据包进入路由表之前</li>
<li>用于 DNAT</li>
<li>常用规则：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 端口转发</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>POSTROUTING 链</strong></p>
<ul>
<li>数据包离开路由表之后</li>
<li>用于 SNAT</li>
<li>常用规则：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 源地址转换</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j SNAT --to-source 203.0.113.1</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="5-1-3-匹配条件"><a href="#5-1-3-匹配条件" class="headerlink" title="5.1.3 匹配条件"></a>5.1.3 匹配条件</h4><ol>
<li><p><strong>基本匹配</strong></p>
<ul>
<li>源地址：-s</li>
<li>目标地址：-d</li>
<li>协议：-p</li>
<li>接口：-i&#x2F;-o</li>
</ul>
</li>
<li><p><strong>扩展匹配</strong></p>
<ul>
<li>状态：-m state</li>
<li>多端口：-m multiport</li>
<li>连接限制：-m limit</li>
<li>字符串：-m string</li>
</ul>
</li>
<li><p><strong>目标动作</strong></p>
<ul>
<li>ACCEPT：接受</li>
<li>DROP：丢弃</li>
<li>REJECT：拒绝</li>
<li>LOG：记录</li>
<li>DNAT：目标地址转换</li>
<li>SNAT：源地址转换</li>
</ul>
</li>
</ol>
<h3 id="5-2-防火墙规则示例"><a href="#5-2-防火墙规则示例" class="headerlink" title="5.2 防火墙规则示例"></a>5.2 防火墙规则示例</h3><ol>
<li><p><strong>基本防护</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 清除现有规则</span></span><br><span class="line">iptables -F</span><br><span class="line">iptables -X</span><br><span class="line">iptables -Z</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置默认策略</span></span><br><span class="line">iptables -P INPUT DROP</span><br><span class="line">iptables -P FORWARD DROP</span><br><span class="line">iptables -P OUTPUT ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许本地回环</span></span><br><span class="line">iptables -A INPUT -i lo -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许已建立的连接</span></span><br><span class="line">iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许 SSH</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 22 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 允许 HTTP/HTTPS</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -A INPUT -p tcp --dport 443 -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>NAT 配置</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启用 IP 转发</span></span><br><span class="line"><span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 SNAT</span></span><br><span class="line">iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -j SNAT --to-source 203.0.113.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 DNAT</span></span><br><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.100:8080</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>高级规则</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 限制连接数</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 25/minute --limit-burst 100 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 防止 SYN 洪水攻击</span></span><br><span class="line">iptables -A INPUT -p tcp --syn -m <span class="built_in">limit</span> --<span class="built_in">limit</span> 1/s --limit-burst 3 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 记录特定流量</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j LOG --log-prefix <span class="string">&quot;HTTP: &quot;</span></span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="6-完整数据流程"><a href="#6-完整数据流程" class="headerlink" title="6. 完整数据流程"></a>6. 完整数据流程</h2><h3 id="6-1-数据包发送流程"><a href="#6-1-数据包发送流程" class="headerlink" title="6.1 数据包发送流程"></a>6.1 数据包发送流程</h3><div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  sequenceDiagram
    participant App as Java应用
    participant Socket as Socket API
    participant TCP as TCP层
    participant IP as IP层
    participant NIC as 网卡驱动
    participant HW as 网卡硬件
    participant Net as 网络

    App-&gt;&gt;Socket: 调用write()
    Socket-&gt;&gt;Socket: 数据复制到内核缓冲区
    Socket-&gt;&gt;TCP: 数据封装
    TCP-&gt;&gt;TCP: 添加TCP头
    TCP-&gt;&gt;TCP: 计算校验和
    TCP-&gt;&gt;IP: 添加TCP头
    IP-&gt;&gt;IP: 添加IP头
    IP-&gt;&gt;IP: 计算校验和
    IP-&gt;&gt;IP: 路由查找
    IP-&gt;&gt;NIC: 数据包发送
    NIC-&gt;&gt;NIC: DMA传输
    NIC-&gt;&gt;HW: 数据包发送
    HW-&gt;&gt;HW: 添加帧头
    HW-&gt;&gt;HW: 计算FCS
    HW-&gt;&gt;Net: 物理发送
  </pre></div>

<h3 id="6-2-数据包接收流程"><a href="#6-2-数据包接收流程" class="headerlink" title="6.2 数据包接收流程"></a>6.2 数据包接收流程</h3><div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  sequenceDiagram
    participant Net as 网络
    participant HW as 网卡硬件
    participant NIC as 网卡驱动
    participant IP as IP层
    participant TCP as TCP层
    participant Socket as Socket API
    participant App as Java应用

    Net-&gt;&gt;HW: 接收数据包
    HW-&gt;&gt;HW: 校验FCS
    HW-&gt;&gt;HW: 去除帧头
    HW-&gt;&gt;NIC: 触发中断
    NIC-&gt;&gt;NIC: 中断处理
    NIC-&gt;&gt;NIC: DMA传输
    NIC-&gt;&gt;IP: 数据包接收
    IP-&gt;&gt;IP: 校验IP头
    IP-&gt;&gt;IP: 去除IP头
    IP-&gt;&gt;TCP: 数据包传递
    TCP-&gt;&gt;TCP: 校验TCP头
    TCP-&gt;&gt;TCP: 去除TCP头
    TCP-&gt;&gt;TCP: 重组数据包
    TCP-&gt;&gt;Socket: 数据就绪
    Socket-&gt;&gt;App: 通知应用
    App-&gt;&gt;Socket: 调用read()
    Socket-&gt;&gt;App: 返回数据
  </pre></div>

<h3 id="6-3-详细处理流程"><a href="#6-3-详细处理流程" class="headerlink" title="6.3 详细处理流程"></a>6.3 详细处理流程</h3><div class="mermaid-wrap"><pre class="mermaid-src" hidden>
  graph TD
    A[客户端] --&gt;|发送请求| B[网络]
    B --&gt;|数据包到达| C[网卡]
    C --&gt;|触发中断| D[网卡驱动]
    D --&gt;|DMA传输| E[内核缓冲区]
    E --&gt;|软中断| F[网络协议栈]
    F --&gt;|协议解析| G[Socket层]
    G --&gt;|数据就绪| H[Java NIO]
    H --&gt;|事件通知| I[Java应用]
    I --&gt;|处理请求| J[业务逻辑]
    
    C --&gt;|硬件校验| K[帧校验]
    K --&gt;|校验通过| D
    K --&gt;|校验失败| L[丢弃数据包]
    
    F --&gt;|IP层处理| M[路由查找]
    M --&gt;|找到路由| F
    M --&gt;|未找到路由| N[ICMP错误]
    
    F --&gt;|TCP层处理| O[连接跟踪]
    O --&gt;|新连接| P[创建连接]
    O --&gt;|已有连接| Q[更新连接]
    
    G --&gt;|Socket处理| R[缓冲区管理]
    R --&gt;|缓冲区满| S[流量控制]
    R --&gt;|缓冲区空| T[等待数据]
    
    H --&gt;|NIO处理| U[事件循环]
    U --&gt;|读事件| V[数据读取]
    U --&gt;|写事件| W[数据发送]
    
    I --&gt;|应用处理| X[请求解析]
    X --&gt;|业务处理| Y[响应生成]
    Y --&gt;|数据发送| Z[响应返回]
  </pre></div>

<h2 id="7-网络性能优化"><a href="#7-网络性能优化" class="headerlink" title="7. 网络性能优化"></a>7. 网络性能优化</h2><h3 id="7-1-系统层面"><a href="#7-1-系统层面" class="headerlink" title="7.1 系统层面"></a>7.1 系统层面</h3><h4 id="7-1-1-网卡优化"><a href="#7-1-1-网卡优化" class="headerlink" title="7.1.1 网卡优化"></a>7.1.1 网卡优化</h4><ol>
<li><p><strong>中断合并</strong></p>
<ul>
<li>减少 CPU 中断</li>
<li>提高吞吐量</li>
<li>配置示例：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看中断合并设置</span></span><br><span class="line">ethtool -c eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置中断合并</span></span><br><span class="line">ethtool -C eth0 rx-usecs 100 tx-usecs 100</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>多队列支持</strong></p>
<ul>
<li>多 CPU 处理</li>
<li>负载均衡</li>
<li>配置示例：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看队列数</span></span><br><span class="line">ethtool -l eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置队列数</span></span><br><span class="line">ethtool -L eth0 combined 8</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>大页内存</strong></p>
<ul>
<li>减少 TLB 缺失</li>
<li>提高性能</li>
<li>配置示例：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 分配大页</span></span><br><span class="line"><span class="built_in">echo</span> 1024 &gt; /proc/sys/vm/nr_hugepages</span><br><span class="line"></span><br><span class="line"><span class="comment"># 挂载大页文件系统</span></span><br><span class="line">mount -t hugetlbfs none /dev/hugepages</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="7-1-2-协议栈优化"><a href="#7-1-2-协议栈优化" class="headerlink" title="7.1.2 协议栈优化"></a>7.1.2 协议栈优化</h4><ol>
<li><p><strong>TCP 参数调优</strong></p>
<ul>
<li>缓冲区大小</li>
<li>超时设置</li>
<li>拥塞控制</li>
<li>配置示例：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置 TCP 缓冲区</span></span><br><span class="line">sysctl -w net.core.rmem_max=16777216</span><br><span class="line">sysctl -w net.core.wmem_max=16777216</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置 TCP 超时</span></span><br><span class="line">sysctl -w net.ipv4.tcp_keepalive_time=300</span><br><span class="line">sysctl -w net.ipv4.tcp_keepalive_intvl=15</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置拥塞控制</span></span><br><span class="line">sysctl -w net.ipv4.tcp_congestion_control=cubic</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>连接跟踪</strong></p>
<ul>
<li>优化连接表</li>
<li>超时设置</li>
<li>配置示例：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置连接跟踪表大小</span></span><br><span class="line">sysctl -w net.netfilter.nf_conntrack_max=1000000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置超时时间</span></span><br><span class="line">sysctl -w net.netfilter.nf_conntrack_tcp_timeout_established=3600</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="7-2-应用层面"><a href="#7-2-应用层面" class="headerlink" title="7.2 应用层面"></a>7.2 应用层面</h3><h4 id="7-2-1-Java-网络优化"><a href="#7-2-1-Java-网络优化" class="headerlink" title="7.2.1 Java 网络优化"></a>7.2.1 Java 网络优化</h4><ol>
<li><p><strong>NIO 使用</strong></p>
<ul>
<li>非阻塞 IO</li>
<li>事件驱动</li>
<li>示例代码：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 Selector</span></span><br><span class="line"><span class="type">Selector</span> <span class="variable">selector</span> <span class="operator">=</span> Selector.open();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 ServerSocketChannel</span></span><br><span class="line"><span class="type">ServerSocketChannel</span> <span class="variable">serverChannel</span> <span class="operator">=</span> ServerSocketChannel.open();</span><br><span class="line">serverChannel.configureBlocking(<span class="literal">false</span>);</span><br><span class="line">serverChannel.socket().bind(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(<span class="number">8080</span>));</span><br><span class="line">serverChannel.register(selector, SelectionKey.OP_ACCEPT);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 事件循环</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    selector.select();</span><br><span class="line">    Set&lt;SelectionKey&gt; keys = selector.selectedKeys();</span><br><span class="line">    Iterator&lt;SelectionKey&gt; it = keys.iterator();</span><br><span class="line">    <span class="keyword">while</span> (it.hasNext()) &#123;</span><br><span class="line">        <span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> it.next();</span><br><span class="line">        it.remove();</span><br><span class="line">        <span class="keyword">if</span> (key.isAcceptable()) &#123;</span><br><span class="line">            <span class="comment">// 处理连接</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isReadable()) &#123;</span><br><span class="line">            <span class="comment">// 处理读取</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key.isWritable()) &#123;</span><br><span class="line">            <span class="comment">// 处理写入</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>连接池管理</strong></p>
<ul>
<li>连接复用</li>
<li>超时控制</li>
<li>示例配置：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建连接池</span></span><br><span class="line"><span class="type">PoolingHttpClientConnectionManager</span> <span class="variable">cm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PoolingHttpClientConnectionManager</span>();</span><br><span class="line">cm.setMaxTotal(<span class="number">100</span>);</span><br><span class="line">cm.setDefaultMaxPerRoute(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建 HttpClient</span></span><br><span class="line"><span class="type">CloseableHttpClient</span> <span class="variable">httpClient</span> <span class="operator">=</span> HttpClients.custom()</span><br><span class="line">    .setConnectionManager(cm)</span><br><span class="line">    .setDefaultRequestConfig(RequestConfig.custom()</span><br><span class="line">        .setConnectTimeout(<span class="number">5000</span>)</span><br><span class="line">        .setSocketTimeout(<span class="number">5000</span>)</span><br><span class="line">        .build())</span><br><span class="line">    .build();</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>超时设置</strong></p>
<ul>
<li>连接超时</li>
<li>读取超时</li>
<li>写入超时</li>
<li>示例代码：<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置超时</span></span><br><span class="line"><span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Socket</span>();</span><br><span class="line">socket.connect(<span class="keyword">new</span> <span class="title class_">InetSocketAddress</span>(host, port), <span class="number">5000</span>);</span><br><span class="line">socket.setSoTimeout(<span class="number">5000</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="7-2-2-监控指标"><a href="#7-2-2-监控指标" class="headerlink" title="7.2.2 监控指标"></a>7.2.2 监控指标</h4><ol>
<li><p><strong>网络吞吐量</strong></p>
<ul>
<li>带宽使用率</li>
<li>数据包速率</li>
<li>错误率</li>
<li>监控工具：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 iftop 监控带宽</span></span><br><span class="line">iftop -i eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 nethogs 监控进程</span></span><br><span class="line">nethogs eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 iperf 测试带宽</span></span><br><span class="line">iperf -s</span><br><span class="line">iperf -c server</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>延迟统计</strong></p>
<ul>
<li>往返时间</li>
<li>连接延迟</li>
<li>处理延迟</li>
<li>监控工具：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 ping 测试延迟</span></span><br><span class="line">ping -c 100 server</span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 tcpping 测试 TCP 延迟</span></span><br><span class="line">tcpping -c 100 server 80</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>错误计数</strong></p>
<ul>
<li>丢包率</li>
<li>重传率</li>
<li>错误率</li>
<li>监控工具：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网卡统计</span></span><br><span class="line">ethtool -S eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 TCP 统计</span></span><br><span class="line">netstat -s</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h2 id="8-常见问题排查"><a href="#8-常见问题排查" class="headerlink" title="8. 常见问题排查"></a>8. 常见问题排查</h2><h3 id="8-1-网络连接问题"><a href="#8-1-网络连接问题" class="headerlink" title="8.1 网络连接问题"></a>8.1 网络连接问题</h3><h4 id="8-1-1-物理层"><a href="#8-1-1-物理层" class="headerlink" title="8.1.1 物理层"></a>8.1.1 物理层</h4><ol>
<li><p><strong>网线连接</strong></p>
<ul>
<li>检查网线</li>
<li>检查接口</li>
<li>检查指示灯</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网卡状态</span></span><br><span class="line">ethtool eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看接口信息</span></span><br><span class="line">ip <span class="built_in">link</span> show eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试网线</span></span><br><span class="line">mii-tool eth0</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>网卡状态</strong></p>
<ul>
<li>驱动加载</li>
<li>中断配置</li>
<li>DMA 设置</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看驱动信息</span></span><br><span class="line">lsmod | grep e1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看中断</span></span><br><span class="line"><span class="built_in">cat</span> /proc/interrupts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 DMA</span></span><br><span class="line">dmesg | grep DMA</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>驱动问题</strong></p>
<ul>
<li>驱动版本</li>
<li>兼容性</li>
<li>配置参数</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 更新驱动</span></span><br><span class="line">modprobe -r e1000</span><br><span class="line">modprobe e1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看驱动参数</span></span><br><span class="line">modinfo e1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置驱动参数</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;options e1000 debug=1&quot;</span> &gt; /etc/modprobe.d/e1000.conf</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="8-1-2-网络层"><a href="#8-1-2-网络层" class="headerlink" title="8.1.2 网络层"></a>8.1.2 网络层</h4><ol>
<li><p><strong>IP 配置</strong></p>
<ul>
<li>地址设置</li>
<li>子网掩码</li>
<li>网关配置</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 IP 配置</span></span><br><span class="line">ip addr show</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置 IP 地址</span></span><br><span class="line">ip addr add 192.168.1.100/24 dev eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置网关</span></span><br><span class="line">ip route add default via 192.168.1.1</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>路由表</strong></p>
<ul>
<li>路由条目</li>
<li>默认路由</li>
<li>策略路由</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看路由表</span></span><br><span class="line">ip route show</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加路由</span></span><br><span class="line">ip route add 192.168.2.0/24 via 192.168.1.1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除路由</span></span><br><span class="line">ip route del 192.168.2.0/24</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>防火墙规则</strong></p>
<ul>
<li>规则配置</li>
<li>链设置</li>
<li>策略配置</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看规则</span></span><br><span class="line">iptables -L -n -v</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加规则</span></span><br><span class="line">iptables -A INPUT -p tcp --dport 80 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="comment"># 保存规则</span></span><br><span class="line">iptables-save &gt; /etc/iptables/rules.v4</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="8-1-3-应用层"><a href="#8-1-3-应用层" class="headerlink" title="8.1.3 应用层"></a>8.1.3 应用层</h4><ol>
<li><p><strong>端口监听</strong></p>
<ul>
<li>服务状态</li>
<li>端口占用</li>
<li>访问权限</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看端口</span></span><br><span class="line">netstat -tuln</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看进程</span></span><br><span class="line">lsof -i :80</span><br><span class="line"></span><br><span class="line"><span class="comment"># 测试端口</span></span><br><span class="line">telnet localhost 80</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>服务状态</strong></p>
<ul>
<li>进程状态</li>
<li>日志信息</li>
<li>配置检查</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看服务状态</span></span><br><span class="line">systemctl status nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看日志</span></span><br><span class="line">journalctl -u nginx</span><br><span class="line"></span><br><span class="line"><span class="comment"># 检查配置</span></span><br><span class="line">nginx -t</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>日志分析</strong></p>
<ul>
<li>错误日志</li>
<li>访问日志</li>
<li>系统日志</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看系统日志</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/syslog</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看应用日志</span></span><br><span class="line"><span class="built_in">tail</span> -f /var/log/nginx/error.log</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分析日志</span></span><br><span class="line">grep <span class="string">&quot;error&quot;</span> /var/log/nginx/error.log</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h3 id="8-2-性能问题"><a href="#8-2-性能问题" class="headerlink" title="8.2 性能问题"></a>8.2 性能问题</h3><h4 id="8-2-1-系统资源"><a href="#8-2-1-系统资源" class="headerlink" title="8.2.1 系统资源"></a>8.2.1 系统资源</h4><ol>
<li><p><strong>CPU 使用率</strong></p>
<ul>
<li>进程 CPU</li>
<li>中断处理</li>
<li>上下文切换</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看 CPU 使用</span></span><br><span class="line">top</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看中断</span></span><br><span class="line"><span class="built_in">cat</span> /proc/interrupts</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看上下文切换</span></span><br><span class="line">vmstat 1</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>内存使用</strong></p>
<ul>
<li>物理内存</li>
<li>虚拟内存</li>
<li>缓冲区</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看内存使用</span></span><br><span class="line">free -m</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看虚拟内存</span></span><br><span class="line">vmstat 1</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看缓冲区</span></span><br><span class="line"><span class="built_in">cat</span> /proc/meminfo</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>网络带宽</strong></p>
<ul>
<li>带宽使用</li>
<li>数据包大小</li>
<li>协议分布</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看带宽使用</span></span><br><span class="line">iftop -i eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看数据包</span></span><br><span class="line">tcpdump -i eth0</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看协议分布</span></span><br><span class="line">nethogs eth0</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h4 id="8-2-2-应用资源"><a href="#8-2-2-应用资源" class="headerlink" title="8.2.2 应用资源"></a>8.2.2 应用资源</h4><ol>
<li><p><strong>连接数</strong></p>
<ul>
<li>活动连接</li>
<li>等待连接</li>
<li>连接限制</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看连接数</span></span><br><span class="line">netstat -an | grep ESTABLISHED | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看等待连接</span></span><br><span class="line">netstat -an | grep LISTEN | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看连接限制</span></span><br><span class="line"><span class="built_in">ulimit</span> -n</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>线程数</strong></p>
<ul>
<li>活动线程</li>
<li>线程池</li>
<li>线程限制</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看线程数</span></span><br><span class="line">ps -eLf | <span class="built_in">wc</span> -l</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看线程池</span></span><br><span class="line">jstack &lt;pid&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看线程限制</span></span><br><span class="line"><span class="built_in">ulimit</span> -u</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>缓冲区大小</strong></p>
<ul>
<li>发送缓冲区</li>
<li>接收缓冲区</li>
<li>缓冲区限制</li>
<li>排查步骤：<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看缓冲区</span></span><br><span class="line">sysctl -a | grep mem</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置缓冲区</span></span><br><span class="line">sysctl -w net.core.rmem_max=16777216</span><br><span class="line">sysctl -w net.core.wmem_max=16777216</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看限制</span></span><br><span class="line"><span class="built_in">ulimit</span> -a</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ol>
<h2 id="9-总结"><a href="#9-总结" class="headerlink" title="9. 总结"></a>9. 总结</h2><p>Linux 网络是一个复杂的系统，涉及从硬件到应用的多个层次。理解这些基础概念和完整的数据流程，对于网络问题排查和性能优化都至关重要。通过本文的详细介绍，读者可以：</p>
<ol>
<li>理解网络硬件和驱动的工作原理</li>
<li>掌握网络接口的配置和管理</li>
<li>了解网络协议栈的工作机制</li>
<li>熟悉防火墙的配置和使用</li>
<li>掌握网络性能优化的方法</li>
<li>学会网络问题的排查技巧</li>
</ol>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ol>
<li>Linux 内核网络子系统文档</li>
<li>TCP&#x2F;IP 协议详解</li>
<li>Java NIO 编程指南</li>
<li>Linux 网络性能调优指南</li>
<li>iptables 官方文档</li>
<li>网络故障排查手册</li>
</ol>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">XR</div><div class="post-copyright__author_desc">一片叶、一朵云</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/06/13/linux-network-basics/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/06/13/linux-network-basics/')">Linux 网络基础概念详解：从硬件到应用</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你赐予我前进的力量</span><ul class="reward-group"><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231130275.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226231143327.png" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/06/13/linux-network-basics/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Linux 网络基础概念详解：从硬件到应用&amp;url=http://example.com/2025/06/13/linux-network-basics/&amp;pic=https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">凌霄的博客</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Java/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Java<span class="tagsPageCount">5</span></a><a class="post-meta__box__tags" href="/tags/Linux/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Linux<span class="tagsPageCount">4</span></a><a class="post-meta__box__tags" href="/tags/%E7%BD%91%E7%BB%9C/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>网络<span class="tagsPageCount">4</span></a><a class="post-meta__box__tags" href="/tags/%E7%B3%BB%E7%BB%9F/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>系统<span class="tagsPageCount">2</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/06/13/network-interfaces-ports-nics/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">深入理解网络接口、端口与网卡：关系与工作流程</div></div></a></div><div class="next-post pull-right"><a href="/2025/06/13/iptables-rule-chains/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">深入理解 iptables 规则链：原理与实践</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/06/13/network-interfaces-ports-nics/" title="深入理解网络接口、端口与网卡：关系与工作流程"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-13</div><div class="title">深入理解网络接口、端口与网卡：关系与工作流程</div></div></a></div><div><a href="/2025/06/13/iptables-nat-dnat-snat/" title="深入理解 iptables NAT：DNAT 与 SNAT 详解"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-13</div><div class="title">深入理解 iptables NAT：DNAT 与 SNAT 详解</div></div></a></div><div><a href="/2025/06/13/iptables-rule-chains/" title="深入理解 iptables 规则链：原理与实践"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://cdn.jsdelivr.net/gh/kongxiaoran/image-repo/blog20241226224350520.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-13</div><div class="title">深入理解 iptables 规则链：原理与实践</div></div></a></div><div><a href="/2025/06/17/Spring%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E4%B8%8EAOP/" title="Spring AOP 与循环依赖：揭秘提前暴露代理的底层原理"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618094256140.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-17</div><div class="title">Spring AOP 与循环依赖：揭秘提前暴露代理的底层原理</div></div></a></div><div><a href="/2025/06/17/%E8%AF%A6%E7%BB%86%E8%AF%B4%E8%AF%B4%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%E5%AE%9A/" title="聊聊双重检查锁定（Double-Checked Locking）这点事"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618110852735.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-17</div><div class="title">聊聊双重检查锁定（Double-Checked Locking）这点事</div></div></a></div><div><a href="/2025/06/17/%E8%A7%A3%E5%AF%86%20Spring%20MVC%EF%BC%9A%E4%BB%8E%20Tomcat%20%E5%88%B0%20Controller%20%E7%9A%84%E4%B8%80%E6%AC%A1%E5%AE%8C%E6%95%B4%E8%AF%B7%E6%B1%82%E4%B9%8B%E6%97%85/" title="解密 Spring MVC：从 Tomcat 到 Controller 的一次完整请求之旅"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250618094256140.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-17</div><div class="title">解密 Spring MVC：从 Tomcat 到 Controller 的一次完整请求之旅</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/04/27/64496e511b09c.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description"></div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">XR</h1><div class="author-info__desc">一片叶、一朵云</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/kongxiaoran" target="_blank" title="Github"></a></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Linux-%E7%BD%91%E7%BB%9C%E5%9F%BA%E7%A1%80%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3%EF%BC%9A%E4%BB%8E%E7%A1%AC%E4%BB%B6%E5%88%B0%E5%BA%94%E7%94%A8"><span class="toc-number">1.</span> <span class="toc-text">Linux 网络基础概念详解：从硬件到应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E7%BD%91%E7%BB%9C%E7%A1%AC%E4%BB%B6%E5%9F%BA%E7%A1%80"><span class="toc-number">1.1.</span> <span class="toc-text">1. 网络硬件基础</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-%E7%BD%91%E5%8D%A1%EF%BC%88Network-Interface-Card%EF%BC%8CNIC%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">1.1 网卡（Network Interface Card，NIC）</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-1-%E7%BD%91%E5%8D%A1%E7%B1%BB%E5%9E%8B"><span class="toc-number">1.1.1.1.</span> <span class="toc-text">1.1.1 网卡类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-2-%E7%BD%91%E5%8D%A1%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="toc-number">1.1.1.2.</span> <span class="toc-text">1.1.2 网卡工作原理</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-3-%E7%BD%91%E5%8D%A1%E5%AF%84%E5%AD%98%E5%99%A8"><span class="toc-number">1.1.1.3.</span> <span class="toc-text">1.1.3 网卡寄存器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-%E7%BD%91%E5%8D%A1%E9%A9%B1%E5%8A%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">1.2 网卡驱动</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-1-%E9%A9%B1%E5%8A%A8%E6%9E%B6%E6%9E%84"><span class="toc-number">1.1.2.1.</span> <span class="toc-text">1.2.1 驱动架构</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-2-%E9%A9%B1%E5%8A%A8%E5%8A%9F%E8%83%BD%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.1.2.2.</span> <span class="toc-text">1.2.2 驱动功能详解</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-3-%E9%A9%B1%E5%8A%A8%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B"><span class="toc-number">1.1.2.3.</span> <span class="toc-text">1.2.3 驱动工作流程</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E7%BD%91%E7%BB%9C%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.</span> <span class="toc-text">2. 网络接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E7%89%A9%E7%90%86%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.1 物理接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-%E5%8D%95%E7%AB%AF%E5%8F%A3%E7%BD%91%E5%8D%A1"><span class="toc-number">1.2.1.1.</span> <span class="toc-text">2.1.1 单端口网卡</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-%E5%A4%9A%E7%AB%AF%E5%8F%A3%E7%BD%91%E5%8D%A1"><span class="toc-number">1.2.1.2.</span> <span class="toc-text">2.1.2 多端口网卡</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E8%99%9A%E6%8B%9F%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.2.</span> <span class="toc-text">2.2 虚拟接口</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-1-VLAN-%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.2.1.</span> <span class="toc-text">2.2.1 VLAN 接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-2-%E5%AD%90%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.2.2.</span> <span class="toc-text">2.2.2 子接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-3-%E7%BD%91%E6%A1%A5%E6%8E%A5%E5%8F%A3"><span class="toc-number">1.2.2.3.</span> <span class="toc-text">2.2.3 网桥接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-4-%E7%BB%91%E5%AE%9A%E6%8E%A5%E5%8F%A3%EF%BC%88Bond%EF%BC%89"><span class="toc-number">1.2.2.4.</span> <span class="toc-text">2.2.4 绑定接口（Bond）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE%E6%A0%88"><span class="toc-number">1.3.</span> <span class="toc-text">3. 网络协议栈</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-1-%E5%8D%8F%E8%AE%AE%E5%B1%82%E6%AC%A1"><span class="toc-number">1.3.1.</span> <span class="toc-text">3.1 协议层次</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-%E5%85%B3%E9%94%AE%E5%8D%8F%E8%AE%AE%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.3.2.</span> <span class="toc-text">3.2 关键协议详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-1-TCP-IP-%E5%8D%8F%E8%AE%AE%E6%97%8F"><span class="toc-number">1.3.2.1.</span> <span class="toc-text">3.2.1 TCP&#x2F;IP 协议族</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-2-%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.3.2.2.</span> <span class="toc-text">3.2.2 应用层协议</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E7%BD%91%E7%BB%9C%E7%AB%AF%E5%8F%A3"><span class="toc-number">1.4.</span> <span class="toc-text">4. 网络端口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E7%AB%AF%E5%8F%A3%E6%A6%82%E5%BF%B5%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.4.1.</span> <span class="toc-text">4.1 端口概念详解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%B8%B8%E8%A7%81%E7%AB%AF%E5%8F%A3%E5%8F%8A%E6%9C%8D%E5%8A%A1"><span class="toc-number">1.4.2.</span> <span class="toc-text">4.2 常见端口及服务</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E9%98%B2%E7%81%AB%E5%A2%99"><span class="toc-number">1.5.</span> <span class="toc-text">5. 防火墙</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-iptables-%E8%AF%A6%E8%A7%A3"><span class="toc-number">1.5.1.</span> <span class="toc-text">5.1 iptables 详解</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-1-%E8%A1%A8%EF%BC%88Tables%EF%BC%89"><span class="toc-number">1.5.1.1.</span> <span class="toc-text">5.1.1 表（Tables）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-2-%E9%93%BE%EF%BC%88Chains%EF%BC%89"><span class="toc-number">1.5.1.2.</span> <span class="toc-text">5.1.2 链（Chains）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-3-%E5%8C%B9%E9%85%8D%E6%9D%A1%E4%BB%B6"><span class="toc-number">1.5.1.3.</span> <span class="toc-text">5.1.3 匹配条件</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E9%98%B2%E7%81%AB%E5%A2%99%E8%A7%84%E5%88%99%E7%A4%BA%E4%BE%8B"><span class="toc-number">1.5.2.</span> <span class="toc-text">5.2 防火墙规则示例</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E5%AE%8C%E6%95%B4%E6%95%B0%E6%8D%AE%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.</span> <span class="toc-text">6. 完整数据流程</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-%E6%95%B0%E6%8D%AE%E5%8C%85%E5%8F%91%E9%80%81%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 数据包发送流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-%E6%95%B0%E6%8D%AE%E5%8C%85%E6%8E%A5%E6%94%B6%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 数据包接收流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-%E8%AF%A6%E7%BB%86%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 详细处理流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-%E7%BD%91%E7%BB%9C%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96"><span class="toc-number">1.7.</span> <span class="toc-text">7. 网络性能优化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E7%B3%BB%E7%BB%9F%E5%B1%82%E9%9D%A2"><span class="toc-number">1.7.1.</span> <span class="toc-text">7.1 系统层面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-1-%E7%BD%91%E5%8D%A1%E4%BC%98%E5%8C%96"><span class="toc-number">1.7.1.1.</span> <span class="toc-text">7.1.1 网卡优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-2-%E5%8D%8F%E8%AE%AE%E6%A0%88%E4%BC%98%E5%8C%96"><span class="toc-number">1.7.1.2.</span> <span class="toc-text">7.1.2 协议栈优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E5%BA%94%E7%94%A8%E5%B1%82%E9%9D%A2"><span class="toc-number">1.7.2.</span> <span class="toc-text">7.2 应用层面</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-1-Java-%E7%BD%91%E7%BB%9C%E4%BC%98%E5%8C%96"><span class="toc-number">1.7.2.1.</span> <span class="toc-text">7.2.1 Java 网络优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-2-%E7%9B%91%E6%8E%A7%E6%8C%87%E6%A0%87"><span class="toc-number">1.7.2.2.</span> <span class="toc-text">7.2.2 监控指标</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5"><span class="toc-number">1.8.</span> <span class="toc-text">8. 常见问题排查</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E7%BD%91%E7%BB%9C%E8%BF%9E%E6%8E%A5%E9%97%AE%E9%A2%98"><span class="toc-number">1.8.1.</span> <span class="toc-text">8.1 网络连接问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-1-%E7%89%A9%E7%90%86%E5%B1%82"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">8.1.1 物理层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-2-%E7%BD%91%E7%BB%9C%E5%B1%82"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">8.1.2 网络层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-3-%E5%BA%94%E7%94%A8%E5%B1%82"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">8.1.3 应用层</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98"><span class="toc-number">1.8.2.</span> <span class="toc-text">8.2 性能问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-1-%E7%B3%BB%E7%BB%9F%E8%B5%84%E6%BA%90"><span class="toc-number">1.8.2.1.</span> <span class="toc-text">8.2.1 系统资源</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-2-%E5%BA%94%E7%94%A8%E8%B5%84%E6%BA%90"><span class="toc-number">1.8.2.2.</span> <span class="toc-text">8.2.2 应用资源</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E6%80%BB%E7%BB%93"><span class="toc-number">1.9.</span> <span class="toc-text">9. 总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99"><span class="toc-number">1.10.</span> <span class="toc-text">参考资料</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/27/%E7%A8%8B%E5%BA%8F%E5%8C%96%E5%B9%BF%E5%91%8A%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E4%B8%8E%E6%8A%95%E6%94%BE%E4%B8%9A%E5%8A%A1%E6%A8%A1%E5%BC%8F%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%9E%B6%E6%9E%84/" title="程序化广告数据处理与投放技术详解：从RTB到DSP的完整实现方案">程序化广告数据处理与投放技术详解：从RTB到DSP的完整实现方案</a><time datetime="2025-06-26T16:00:00.000Z" title="发表于 2025-06-27 00:00:00">2025-06-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/26/confidential_computing_implementation_guide/" title="机密计算环境实施：从硬件选型到应用部署"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625095124143.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="机密计算环境实施：从硬件选型到应用部署"/></a><div class="content"><a class="title" href="/2025/06/26/confidential_computing_implementation_guide/" title="机密计算环境实施：从硬件选型到应用部署">机密计算环境实施：从硬件选型到应用部署</a><time datetime="2025-06-25T16:00:00.000Z" title="发表于 2025-06-26 00:00:00">2025-06-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/24/confidential_computing_overview/" title="从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250625095124143.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈"/></a><div class="content"><a class="title" href="/2025/06/24/confidential_computing_overview/" title="从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈">从物理攻击到云端信任：让我们一起了解可信执行环境与机密计算技术栈</a><time datetime="2025-06-23T16:00:00.000Z" title="发表于 2025-06-24 00:00:00">2025-06-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/24/redo%20log%E3%80%81undo%20log%20%E5%A6%82%E4%BD%95%E4%BF%9D%E9%9A%9C%20InnoDB%20%E4%BA%8B%E5%8A%A1/" title="谁来保证InnoDB的原子性、一致性与持久性的？"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250607204936123.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="谁来保证InnoDB的原子性、一致性与持久性的？"/></a><div class="content"><a class="title" href="/2025/06/24/redo%20log%E3%80%81undo%20log%20%E5%A6%82%E4%BD%95%E4%BF%9D%E9%9A%9C%20InnoDB%20%E4%BA%8B%E5%8A%A1/" title="谁来保证InnoDB的原子性、一致性与持久性的？">谁来保证InnoDB的原子性、一致性与持久性的？</a><time datetime="2025-06-23T16:00:00.000Z" title="发表于 2025-06-24 00:00:00">2025-06-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/06/23/Kubernetes%E5%88%86%E4%BA%AB/" title="Kubernetes笔记【历史学习文档】"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://raw.githubusercontent.com/kongxiaoran/image-repo/main/blog/20250623235029260.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Kubernetes笔记【历史学习文档】"/></a><div class="content"><a class="title" href="/2025/06/23/Kubernetes%E5%88%86%E4%BA%AB/" title="Kubernetes笔记【历史学习文档】">Kubernetes笔记【历史学习文档】</a><time datetime="2025-06-23T14:00:00.000Z" title="发表于 2025-06-23 22:00:00">2025-06-23</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2024 - 2025 By <a class="footer-bar-link" href="/" title="XR" target="_blank">XR</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">33</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">40</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">4</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://blog.anheyu.com/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/Argon2/" style="font-size: 0.88rem;">Argon2<sup>1</sup></a><a href="/tags/DSP/" style="font-size: 0.88rem;">DSP<sup>1</sup></a><a href="/tags/HBase/" style="font-size: 0.88rem;">HBase<sup>1</sup></a><a href="/tags/HDFS/" style="font-size: 0.88rem;">HDFS<sup>2</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>1</sup></a><a href="/tags/Hive/" style="font-size: 0.88rem;">Hive<sup>1</sup></a><a href="/tags/Java/" style="font-size: 0.88rem;">Java<sup>5</sup></a><a href="/tags/Kubernetes/" style="font-size: 0.88rem;">Kubernetes<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>4</sup></a><a href="/tags/MinIO/" style="font-size: 0.88rem;">MinIO<sup>1</sup></a><a href="/tags/NAT/" style="font-size: 0.88rem;">NAT<sup>1</sup></a><a href="/tags/RTB/" style="font-size: 0.88rem;">RTB<sup>1</sup></a><a href="/tags/S3%E5%85%BC%E5%AE%B9/" style="font-size: 0.88rem;">S3兼容<sup>1</sup></a><a href="/tags/SGX/" style="font-size: 0.88rem;">SGX<sup>2</sup></a><a href="/tags/Spark/" style="font-size: 0.88rem;">Spark<sup>2</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>2</sup></a><a href="/tags/TDX/" style="font-size: 0.88rem;">TDX<sup>2</sup></a><a href="/tags/TEE/" style="font-size: 0.88rem;">TEE<sup>2</sup></a><a href="/tags/TME/" style="font-size: 0.88rem;">TME<sup>2</sup></a><a href="/tags/YARN/" style="font-size: 0.88rem;">YARN<sup>1</sup></a><a href="/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/" style="font-size: 0.88rem;">云原生<sup>1</sup></a><a href="/tags/%E5%86%85%E5%AD%98%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">内存计算<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%A4%84%E7%90%86/" style="font-size: 0.88rem;">分布式处理<sup>1</sup></a><a href="/tags/%E5%88%86%E5%B8%83%E5%BC%8F%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">分布式存储<sup>2</sup></a><a href="/tags/%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">哈希<sup>1</sup></a><a href="/tags/%E5%93%88%E5%B8%8C%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">哈希算法<sup>1</sup></a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" style="font-size: 0.88rem;">大数据<sup>1</sup></a><a href="/tags/%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">安全<sup>2</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%93%88%E5%B8%8C/" style="font-size: 0.88rem;">密码哈希<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">密码存储<sup>1</sup></a><a href="/tags/%E5%AF%86%E7%A0%81%E5%AD%A6/" style="font-size: 0.88rem;">密码学<sup>1</sup></a><a href="/tags/%E5%AF%B9%E8%B1%A1%E5%AD%98%E5%82%A8/" style="font-size: 0.88rem;">对象存储<sup>1</sup></a><a href="/tags/%E5%B9%B6%E5%8F%91/" style="font-size: 0.88rem;">并发<sup>2</sup></a><a href="/tags/%E5%B9%BF%E5%91%8A%E6%8A%95%E6%94%BE/" style="font-size: 0.88rem;">广告投放<sup>1</sup></a><a href="/tags/%E7%A8%8B%E5%BA%8F%E5%8C%96%E5%B9%BF%E5%91%8A/" style="font-size: 0.88rem;">程序化广告<sup>1</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">系统<sup>2</sup></a><a href="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8/" style="font-size: 0.88rem;">系统安全<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C/" style="font-size: 0.88rem;">网络<sup>4</sup></a><a href="/tags/%E9%98%B2%E7%81%AB%E5%A2%99/" style="font-size: 0.88rem;">防火墙<sup>2</sup></a><a href="/tags/%E9%9A%90%E7%A7%81%E8%AE%A1%E7%AE%97/" style="font-size: 0.88rem;">隐私计算<sup>2</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("12/26/2024 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2024 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 XR 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.cbd.int/mermaid@10.2.4/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
      appKey: 'MR93sqmbPdh7Zm1bZzjXNvlm',
      avatar: 'mp',
      serverURLs: 'https://cbsqtaqs.api.lncldglobal.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.cbd.int/blueimp-md5@2.19.0/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://cbsqtaqs.api.lncldglobal.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'cbSQtAqs68yENzUQ5wpQK826-MdYXbMMI',
        "X-LC-Key": 'MR93sqmbPdh7Zm1bZzjXNvlm',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>